'use strict';var URL,require,WeakMap,module,exports,define;(function(b,a){"function"===typeof define&&define.amd?define("seriously",function(){var c=a(b);b.Seriously||(b.Seriously=c);return c}):"object"===typeof exports?module.exports=a(b):"function"!==typeof b.Seriously&&(b.Seriously=a(b))})(this,function(b){function a(a,b){var c,d;if("string"===typeof a)c=v.querySelector(a);else if(!a)return!1;a.tagName&&(c=a);if(!c)return a;d=c.tagName.toLowerCase();return b&&0>b.indexOf(d)?a:c}function c(a,b){var d,e;a.prototype&&b.prototype&&a.prototype!==b.prototype&&
c(a.prototype,b.prototype);for(d in b)b.hasOwnProperty(d)&&(e=Object.getOwnPropertyDescriptor(b,d),e.get||e.set?Object.defineProperty(a,d,{configurable:!0,enumerable:!0,get:e.get,set:e.set}):a[d]=b[d]);return a}function d(a){var b;if(!x)return O;if("function"===typeof x[a])b=x[a];else if("function"===typeof x.log)b=x.log;else return O;return b.bind?b.bind(x):function(){b.apply(x,arguments)}}function e(a,b,c,d,e){function k(a,b,c){c%=1;0>c&&(c+=1);return c<1/6?a+(b-a)*c*6:0.5>c?b:c<2/3?a+(b-a)*(2/
3-c)*6:a}b=0.5>c?c*(b+1):c+b-c*b;c=2*c-b;e||(e=[]);e[0]=k(c,b,a+1/3);e[1]=k(c,b,a);e[2]=k(c,b,a-1/3);e[3]=d;return e}function f(a){var b,c,d,e="#",k=1>a[3]?4:3;for(b=0;b<k;b++)c=Math.min(255,Math.round(255*a[b]||0)),d=c.toString(16),16>c&&(d="0"+d),e+=d;return e}function k(a){return Array.isArray(a)||a&&a.BYTES_PER_ELEMENT&&"length"in a}function g(a){function c(){t.length&&t.shift()()}if("function"!==typeof a)throw Error("setTimeoutZero argument is not a function");t.push(a);"file:"===b.location.protocol?
setTimeout(c,0):b.postMessage("seriously-timeout-message",b.location)}function l(a,c){var d;try{d=b.WebGLDebugUtils&&c&&c.debugContext?b.WebGLDebugUtils.makeDebugContext(a.getContext("webgl",c)):a.getContext("webgl",c)}catch(e){}if(!d)try{d=a.getContext("experimental-webgl",c)}catch(k){}return d}function m(){var a;w&&w.getError()===w.CONTEXT_LOST_WEBGL&&(w=void 0);if(w||!b.WebGLRenderingContext||L)return w;a=v.createElement("canvas");(w=l(a))?a.addEventListener("webglcontextlost",function q(b){b.preventDefault();
w&&w.canvas===this&&(w=void 0,a.removeEventListener("webglcontextlost",q,!1))},!1):p.logger.warn("Unable to access WebGL.");return w}function h(a){function b(a,c){var u,q;k(a)?(u=a[0],q=a[1]||u):u=a;"string"===typeof u?u=u.toLowerCase():"number"===typeof u?u=String(u):u||(u="");e[u]=q;c||(d.firstValue=u)}function c(a){return a}var d,e,h;for(h in a.inputs)if(a.inputs.hasOwnProperty(h)){if(0<=a.reserved.indexOf(h)||Object.prototype[h])throw Error("Reserved input name: "+h);d=a.inputs[h];d.name=h;isNaN(d.min)&&
(d.min=-Infinity);isNaN(d.max)&&(d.max=Infinity);isNaN(d.minCount)&&(d.minCount=-Infinity);isNaN(d.maxCount)&&(d.maxCount=Infinity);isNaN(d.step)&&(d.step=0);"enum"===d.type&&d.options&&k(d.options)&&d.options.length&&(e={},d.options.forEach(b),d.options=e);"vector"===d.type?2>d.dimensions?d.dimensions=2:4<d.dimensions?d.dimensions=4:!d.dimensions||isNaN(d.dimensions)?d.dimensions=4:d.dimensions=Math.round(d.dimensions):d.dimensions=1;d.shaderDirty=!!d.shaderDirty;"function"!==typeof d.validate&&
(d.validate=p.inputValidators[d.type]||c);a.defaultImageInput||"image"!==d.type||(a.defaultImageInput=h)}}function n(a,b,c,d){var e,h;this.type=a.UNSIGNED_BYTE;e=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,e);d&&d.texture?(this.texture=d.texture,a.bindTexture(a.TEXTURE_2D,this.texture),this.ownTexture=!1):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),
a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),this.ownTexture=!0);try{this.type===a.FLOAT?(h=new Float32Array(b*c*4),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,b,c,0,a.RGBA,a.FLOAT,h)):(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,b,c,0,a.RGBA,a.UNSIGNED_BYTE,null),this.type=a.UNSIGNED_BYTE)}catch(k){this.type=a.UNSIGNED_BYTE,h=new Uint8Array(b*c*4),a.texImage2D(a.TEXTURE_2D,0,
a.RGBA,b,c,0,a.RGBA,a.UNSIGNED_BYTE,h)}d=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,d);a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,b,c);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,d);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.texture,0);h=a.checkFramebufferStatus(a.FRAMEBUFFER);if(h===a.FRAMEBUFFER_INCOMPLETE_ATTACHMENT)throw Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");if(h===a.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT)throw Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");
if(h===a.FRAMEBUFFER_INCOMPLETE_DIMENSIONS)throw Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");if(h===a.FRAMEBUFFER_UNSUPPORTED)throw Error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");if(h!==a.FRAMEBUFFER_COMPLETE)throw Error("Incomplete framebuffer: "+h);a.bindTexture(a.TEXTURE_2D,null);a.bindRenderbuffer(a.RENDERBUFFER,null);a.bindFramebuffer(a.FRAMEBUFFER,null);this.gl=a;this.frameBuffer=e;this.renderBuffer=d;this.width=b;this.height=c}function r(a,b,c){function d(b,
c){var e,q;e=c?a.createShader(a.FRAGMENT_SHADER):a.createShader(a.VERTEX_SHADER);a.shaderSource(e,b);a.compileShader(e);if(!a.getShaderParameter(e,a.COMPILE_STATUS)){b=b.split(/[\n\r]/);for(q=0;q<b.length;q++)b[q]=q+1+":\t"+b[q];b.unshift("Error compiling "+(c?"fragment":"vertex")+" shader:");p.logger.error(b.join("\n"));throw Error("Shader error: "+a.getShaderInfoLog(e));}return e}function e(b,c){if(b.type===a.SAMPLER_2D)return function(d){b.glTexture=a["TEXTURE"+d];a.uniform1i(c,d)};if(b.type===
a.BOOL||b.type===a.INT)return 1<b.size?function(b){a.uniform1iv(c,b)}:function(b){a.uniform1i(c,b)};if(b.type===a.FLOAT)return 1<b.size?function(b){a.uniform1fv(c,b)}:function(b){a.uniform1f(c,b)};if(b.type===a.FLOAT_VEC2)return function(b){a.uniform2f(c,b[0],b[1])};if(b.type===a.FLOAT_VEC3)return function(b){a.uniform3f(c,b[0],b[1],b[2])};if(b.type===a.FLOAT_VEC4)return function(b){a.uniform4f(c,b[0],b[1],b[2],b[3])};if(b.type===a.FLOAT_MAT3)return function(b){a.uniformMatrix3fv(c,!1,b)};if(b.type===
a.FLOAT_MAT4)return function(b){a.uniformMatrix4fv(c,!1,b)};throw Error("Unknown shader uniform type: "+b.type);}function h(b){return function(){return a.getUniform(k,b)}}var k,f,n,g="";f=d(b);n=d(c,!0);k=a.createProgram();a.attachShader(k,f);(b=a.getShaderInfoLog(f))&&(g+="Vertex shader error: "+b+"\n");a.attachShader(k,n);(b=a.getShaderInfoLog(n))&&(g+="Fragment shader error: "+b+"\n");a.linkProgram(k);if(!a.getProgramParameter(k,a.LINK_STATUS))throw g+=a.getProgramInfoLog(k),a.deleteProgram(k),
a.deleteShader(f),a.deleteShader(n),Error("Could not initialise shader: "+g);a.useProgram(k);this.uniforms={};b=a.getProgramParameter(k,a.ACTIVE_UNIFORMS);for(g=0;g<b;++g)c={info:a.getActiveUniform(k,g)},c.name=c.info.name,c.loc=a.getUniformLocation(k,c.name),c.set=e(c.info,c.loc),c.get=h(c.loc),this.uniforms[c.name]=c,this[c.name]||(this[c.name]=c);this.attributes={};this.location={};b=a.getProgramParameter(k,a.ACTIVE_ATTRIBUTES);for(g=0;g<b;++g)c={info:a.getActiveAttrib(k,g)},c.name=c.info.name,
c.location=a.getAttribLocation(k,c.name),this.attributes[c.name]=c,this.location[c.name]=c.location;this.gl=a;this.program=k;this.destroy=function(){var b;a&&(a.deleteProgram(k),a.deleteShader(f),a.deleteShader(n));for(b in this)this.hasOwnProperty(b)&&delete this[b];n=f=k=null}}function p(d){function e(a,b){var c,d,q;if(!b)return!1;c=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,c);b.bufferData(b.ARRAY_BUFFER,a.vertices,b.STATIC_DRAW);c.size=3;d=b.createBuffer();b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,
d);b.bufferData(b.ELEMENT_ARRAY_BUFFER,a.indices,b.STATIC_DRAW);q=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,q);b.bufferData(b.ARRAY_BUFFER,a.coords,b.STATIC_DRAW);q.size=2;return{vertex:c,index:d,texCoord:q,length:a.indices.length,mode:a.mode||b.TRIANGLES}}function q(a){var b={};b.vertices=new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,1,0]);b.indices=new Uint16Array([0,1,2,0,2,3]);b.coords=new Float32Array([0,0,1,0,1,1,0,1]);return e(b,a)}function k(a){var b;if(!s)if(a.canvas.addEventListener("webglcontextlost",
t,!1),a.canvas.addEventListener("webglcontextrestored",m,!1),a.isContextLost())p.logger.warn("Unable to attach lost WebGL context. Will try again when context is restored.");else{s=a;R=a.canvas;V=q(s);X=new r(s,Y,ka);for(a=0;a<la.length;a++)b=la[a],b.gl=s,b.initialize(),b.buildShader();for(a=0;a<Z.length;a++)b=Z[a],b.initialize();for(a=0;a<W.length;a++)b=W[a],b.model||(b.model=V,b.shader=X)}}function m(){var a,b;if(N&&!s)if(a=N.target,a instanceof WebGLFramebuffer)p.logger.error("Unable to restore target built on WebGLFramebuffer");
else if(a=l(a,{alpha:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!0,stencil:!0,debugContext:N.debugContext}))if(a.isContextLost())p.logger.error("Unable to restore WebGL Context");else{k(a);N.frameBuffer=N.renderToTexture?new n(s,N.width,N.height,!1):{frameBuffer:null};for(a=0;a<fa.length;a++)b=fa[a],b.setDirty(),b.emit("webglcontextrestored");p.logger.log("WebGL context restored")}}function t(a){var b,c;a&&(p.logger.warn("WebGL context lost"),a.preventDefault());$&&(sa($),$=0);R&&R.removeEventListener("webglcontextlost",
t,!1);for(b=0;b<la.length;b++)c=la[b],c.gl=null,c.initialized=!1,c.baseShader=null,c.model=null,c.frameBuffer=null,c.texture=null,c.shader&&c.shader.destroy&&c.shader.destroy(),c.shaderDirty=!0,c.shader=null,c.effect.lostContext&&c.effect.lostContext.call(c),a&&c.emit("webglcontextlost");for(b=0;b<Z.length;b++)c=Z[b],c.texture=null,c.initialized=!1,c.allowRefresh=!1,a&&c.emit("webglcontextlost");for(b=0;b<F.length;b++)c=F[b],c.frameBuffer=null,c.texture=null,a&&c.emit("webglcontextlost");for(b=0;b<
W.length;b++)c=W[b],c.model=!1,c.frameBuffer=null,a&&c.emit("webglcontextlost");X&&X.destroy&&X.destroy();s&&(s.deleteBuffer(V.vertex),s.deleteBuffer(V.texCoord),s.deleteBuffer(V.index));V&&(delete V.vertex,delete V.texCoord,delete V.index);R=s=X=V=null}function x(a){var b,c=!1;$=0;if(ma.length)for(c=!0,b=0;b<ma.length;b++)ma[b].call(C,a);if(Z&&Z.length)for(c=!0,b=0;b<Z.length;b++)if(a=Z[b],a.dirty||a.checkDirty&&a.checkDirty())a.dirty=!1,a.setDirty();for(b=0;b<W.length;b++)a=W[b],a.auto&&a.dirty&&
a.render();if(na.length)for(c=!0,b=0;b<na.length;b++)na[b].call(C);c&&!$&&($=ta(x))}function ha(a,b,c,d,e,q){var u=0,k,h,f=e&&e.gl||s,g;if(f){e?(h=q&&q.width||e.width||f.canvas.width,e=q&&q.height||e.height||f.canvas.height):(h=q&&q.width||f.canvas.width,e=q&&q.height||f.canvas.height);a.use();f.viewport(0,0,h,e);f.bindFramebuffer(f.FRAMEBUFFER,d);f.enableVertexAttribArray(a.location.position);f.enableVertexAttribArray(a.location.texCoord);b.texCoord&&(f.bindBuffer(f.ARRAY_BUFFER,b.texCoord),f.vertexAttribPointer(a.location.texCoord,
b.texCoord.size,f.FLOAT,!1,0,0));f.bindBuffer(f.ARRAY_BUFFER,b.vertex);f.vertexAttribPointer(a.location.position,b.vertex.size,f.FLOAT,!1,0,0);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,b.index);q&&q.depth?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST);q?void 0===q.blend||q.blend?(s.enable(s.BLEND),d=void 0===q.srcRGB?s.ONE:q.srcRGB,e=q.dstRGB||s.ZERO,h=void 0===q.srcAlpha?d:q.srcAlpha,g=void 0===q.dstAlpha?e:q.dstAlpha,s.blendFuncSeparate(d,e,h,g),s.blendEquation(q.blendEquation||s.FUNC_ADD)):s.disable(s.BLEND):
(s.enable(s.BLEND),s.blendFunc(s.ONE,s.ZERO),s.blendEquation(s.FUNC_ADD));for(k in c)c.hasOwnProperty(k)&&(d=c[k],h=a.uniforms[k])&&(d instanceof WebGLTexture?(f.activeTexture(f.TEXTURE0+u),f.bindTexture(f.TEXTURE_2D,d),h.set(u),u++):d instanceof aa||d instanceof P||d instanceof Q?d.texture&&(f.activeTexture(f.TEXTURE0+u),f.bindTexture(f.TEXTURE_2D,d.texture),h.set(u),u++):void 0!==d&&null!==d&&h.set(d));if(!q||void 0===q.clear||q.clear)f.clearColor(0,0,0,0),f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT);
f.drawElements(b.mode,b.length,f.UNSIGNED_SHORT,0);s.enable(s.DEPTH_TEST)}}function w(b,c,d){var e,q;if("string"!==typeof b||!c&&0!==c)d&&"object"===typeof d||(d=c),c=b;"string"===typeof b&&A[b]||(b=null);if(c instanceof aa||c instanceof P||c instanceof Q)e=c;else if(c instanceof pa||c instanceof qa||c instanceof ra){if(e=oa[c.id],!e)throw Error("Cannot connect a foreign node");}else{"string"===typeof c&&isNaN(c)&&(c=a(c,["canvas","img","video"]));for(q=0;q<Z.length;q++)if(e=Z[q],(!b||b===e.hook)&&
e.compare&&e.compare(c,d))return e;e=new aa(b,c,d)}return e}function B(a,b){var c,d,e;if(!(a instanceof P||a instanceof Q))return!1;if(a===b)return!0;e=a.sources;for(c in e)if(e.hasOwnProperty(c)&&(d=e[c],d===b||B(d,b)))return!0;return!1}if(b===this||!(this instanceof p)||void 0!==this.id)return new p(d);var L=++T,C=this,fa=[],oa={},ia=0,Z=[],W=[],F=[],la=[],ga={},ma=[],na=[],M={},R,s,N,V,ja={},X,I,aa,P,Q,ba,pa,qa,ra,ua,xa=!1,ya=!1,$;I=function(){this.ready=!1;this.height=this.width=1;this.gl=s;this.uniforms=
{resolution:[this.width,this.height],transform:null};this.dirty=!0;this.isDestroyed=!1;this.seriously=C;this.listeners={};this.id=ia;ia++};I.prototype.setReady=function(){var a;if(!this.ready&&(this.ready=!0,this.emit("ready"),this.targets))for(a=0;a<this.targets.length;a++)this.targets[a].setReady()};I.prototype.setUnready=function(){var a;if(this.ready&&(this.ready=!1,this.emit("unready"),this.targets))for(a=0;a<this.targets.length;a++)this.targets[a].setUnready()};I.prototype.setDirty=function(){var a;
if(!this.dirty&&(this.emit("dirty"),this.dirty=!0,this.targets))for(a=0;a<this.targets.length;a++)this.targets[a].setDirty()};I.prototype.initFrameBuffer=function(a){s&&(this.frameBuffer=new n(s,this.width,this.height,a))};I.prototype.readPixels=function(a,b,c,d,e){var q=this.gl||s;if(!s)throw Error("Cannot read pixels until a canvas is connected");this.frameBuffer||(this.initFrameBuffer(),this.setDirty());this.render();if(void 0===e)e=new Uint8Array(c*d*4);else if(!e instanceof Uint8Array)throw Error("Incompatible array type");
q.bindFramebuffer(s.FRAMEBUFFER,this.frameBuffer.frameBuffer);q.readPixels(a,b,c,d,s.RGBA,s.UNSIGNED_BYTE,e);return e};I.prototype.resize=function(){var a,b;this.source?(a=this.source.width,b=this.source.height):this.sources&&this.sources.source?(a=this.sources.source.width,b=this.sources.source.height):this.inputs&&this.inputs.width?(a=this.inputs.width,b=this.inputs.height||a):this.inputs&&this.inputs.height?a=b=this.inputs.height:b=a=1;a=Math.floor(a);b=Math.floor(b);if(this.width!==a||this.height!==
b)this.width=a,this.height=b,this.emit("resize"),this.setDirty();this.uniforms&&this.uniforms.resolution&&(this.uniforms.resolution[0]=a,this.uniforms.resolution[1]=b);this.frameBuffer&&this.frameBuffer.resize&&this.frameBuffer.resize(a,b)};I.prototype.on=function(a,b){var c,d=-1;a&&"function"===typeof b&&((c=this.listeners[a])?d=c.indexOf(b):c=this.listeners[a]=[],0>d&&c.push(b))};I.prototype.off=function(a,b){var c,d=-1;a&&"function"===typeof b&&(c=this.listeners[a])&&(d=c.indexOf(b),0<=d&&c.splice(d,
1))};I.prototype.emit=function(a){var b=this.listeners[a];if(b&&b.length)for(a=0;a<b.length;a++)g(b[a])};I.prototype.destroy=function(){var a,b;delete this.gl;delete this.seriously;for(b in this.listeners)this.listeners.hasOwnProperty(b)&&delete this.listeners[b];for(a in this.uniforms)this.uniforms.hasOwnProperty(a)&&delete this.uniforms[a];this.targets&&delete this.targets;this.frameBuffer&&this.frameBuffer.destroy&&(this.frameBuffer.destroy(),delete this.frameBuffer);a=fa.indexOf(this);0<=a&&fa.splice(a,
1);delete oa[this.id];this.isDestroyed=!0};pa=function(b){function d(b,c){var y,e,q;q=g.effect.inputs[b];y=g.inputElements[b];"string"===typeof c&&isNaN(c)&&("enum"===q.type?q.options.hasOwnProperty(c)||(c=a(c,["select"])):"number"===q.type||"boolean"===q.type?c=a(c,["input","select"]):"image"===q.type&&(c=a(c,["canvas","img","video"])));c instanceof HTMLInputElement||c instanceof HTMLSelectElement?(e=c.value,y&&y.element!==c&&(y.element.removeEventListener("change",y.listener,!0),y.element.removeEventListener("input",
y.listener,!0),delete g.inputElements[b],y=null),y||(y={element:c,listener:function(a,b){return function(){var d,y;d="checkbox"===c.type?c.checked:b.value;y=g.setInput(a,d);"color"===q.type&&(y=f(y).substr(0,7));y!==d&&(b.value=y)}}(b,c)},g.inputElements[b]=y,"range"===c.type&&c.addEventListener("input",y.listener,!0),c.addEventListener("change",y.listener,!0)),y&&"checkbox"===c.type&&(e=c.checked)):(y&&(y.element.removeEventListener("change",y.listener,!0),y.element.removeEventListener("input",y.listener,
!0),delete g.inputElements[b]),e=c);g.setInput(b,e);return g.inputs[b]}function e(a){return function(b){return(b=d(a,b))&&b.pub}}function q(a){return function(){var b=g.inputs[a];return b&&b.pub}}function u(a){return function(b){return d(a,b)}}function k(a){return function(){return g.inputs[a]}}var h,g=b;for(h in g.effect.inputs)if(g.effect.inputs.hasOwnProperty(h))if(void 0===this[h])"image"===g.effect.inputs[h].type?Object.defineProperty(this,h,{configurable:!0,enumerable:!0,get:q(h),set:e(h)}):
Object.defineProperty(this,h,{configurable:!0,enumerable:!0,get:k(h),set:u(h)});else throw Error("Cannot overwrite Seriously."+h);Object.defineProperties(this,{effect:{enumerable:!0,configurable:!0,get:function(){return g.hook}},title:{enumerable:!0,configurable:!0,get:function(){return g.effect.title||g.hook}},width:{enumerable:!0,configurable:!0,get:function(){return g.width}},height:{enumerable:!0,configurable:!0,get:function(){return g.height}},id:{enumerable:!0,configurable:!0,get:function(){return g.id}}});
this.render=function(){g.render();return this};this.readPixels=function(a,b,c,d,y){return g.readPixels(a,b,c,d,y)};this.on=function(a,b){g.on(a,b)};this.off=function(a,b){g.off(a,b)};this.inputs=function(a){var b,d;b=g.effect.inputs;if(a){b=b[a];if(!b)return null;a={type:b.type,defaultValue:b.defaultValue,title:b.title||a};"number"===b.type?(a.min=b.min,a.max=b.max,a.step=b.step):"enum"===b.type?a.options=c({},b.options):"vector"===b.type&&(a.dimensions=b.dimensions);b.description&&(a.description=
b.description);return a}a={};for(d in b)b.hasOwnProperty(d)&&(a[d]=this.inputs(d));return a};this.alias=function(a,b){g.alias(a,b);return this};this.matte=function(a){g.matte(a)};this.destroy=function(){var a,b;g.destroy();for(a in this)this.hasOwnProperty(a)&&"isDestroyed"!==a&&"id"!==a&&(b=Object.getOwnPropertyDescriptor(this,a),b.get||b.set||"function"!==typeof this[a]?delete this[a]:this[a]=O)};this.isDestroyed=function(){return g.isDestroyed};this.isReady=function(){return g.ready}};P=function(a,
b){var d,e,q,u,k={};I.call(this,b);this.gl=s;this.effectRef=G[a];this.sources={};this.targets=[];this.inputElements={};this.shaderDirty=this.dirty=!0;this.hook=a;this.options=b;this.transform=null;this.effect=c({},this.effectRef);this.effectRef.definition&&c(this.effect,this.effectRef.definition.call(this,b));h(this.effect);this.uniforms.transform=E;this.inputs={};u=M[a];for(d in this.effect.inputs)if(this.effect.inputs.hasOwnProperty(d)){e=this.effect.inputs[d];if(void 0===e.defaultValue||null===
e.defaultValue)"number"===e.type?e.defaultValue=Math.min(Math.max(0,e.min),e.max):"color"===e.type?e.defaultValue=[0,0,0,0]:"boolean"===e.type?e.defaultValue=!1:"string"===e.type?e.defaultValue="":"enum"===e.type&&(e.defaultValue=e.firstValue);q=e.validate.call(this,e.defaultValue,e);u&&void 0!==u[d]&&(q=e.validate.call(this,u[d],e,e.defaultValue,q),u[d]=q,"image"===e.type&&(k[d]=q));this.inputs[d]=q;e.uniform&&(this.uniforms[e.uniform]=e.defaultValue)}s&&(this.initialize(),this.effect.commonShader&&
this.buildShader());this.updateReady();this.inPlace=this.effect.inPlace;this.pub=new pa(this);fa.push(this);oa[this.id]=this;la.push(this);D[a].push(this);for(d in k)k.hasOwnProperty(d)&&this.setInput(d,k[d])};P.prototype=Object.create(I.prototype);P.prototype.initialize=function(){if(!this.initialized){var a=this;this.baseShader=X;this.model=this.shape?e(this.shape,this.gl):V;"function"===typeof this.effect.initialize?this.effect.initialize.call(this,function(){a.initFrameBuffer(!0)},s):this.initFrameBuffer(!0);
this.frameBuffer&&(this.texture=this.frameBuffer.texture);this.initialized=!0}};P.prototype.resize=function(){var a;I.prototype.resize.call(this);this.effect.resize&&this.effect.resize.call(this);for(a=0;a<this.targets.length;a++)this.targets[a].resize()};P.prototype.updateReady=function(){var a,b,c,d=!0;c=this.effect;for(b in c.inputs)if(c.inputs.hasOwnProperty(b)&&(a=this.effect.inputs[b],"image"===a.type&&!(this.sources[b]&&this.sources[b].ready||c.requires&&!c.requires.call(this,b,this.inputs)))){d=
!1;break}if(this.ready!==d&&(this.ready=d,this.emit(d?"ready":"unready"),b=d?"setReady":"setUnready",this.targets))for(a=0;a<this.targets.length;a++)this.targets[a][b]()};P.prototype.setReady=P.prototype.updateReady;P.prototype.setUnready=P.prototype.updateReady;P.prototype.addTarget=function(a){var b;for(b=0;b<this.targets.length;b++)if(this.targets[b]===a)return;this.targets.push(a)};P.prototype.removeTarget=function(a){a=this.targets&&this.targets.indexOf(a);0<=a&&this.targets.splice(a,1)};P.prototype.removeSource=
function(a){var b,c=a&&a.pub;for(b in this.inputs)!this.inputs.hasOwnProperty(b)||this.inputs[b]!==a&&this.inputs[b]!==c||(this.inputs[b]=null);for(b in this.sources)!this.sources.hasOwnProperty(b)||this.sources[b]!==a&&this.sources[b]!==c||(this.sources[b]=null)};P.prototype.buildShader=function(){var a,b=this.effect;this.shaderDirty&&(b.commonShader&&ja[this.hook]?(this.shader||ja[this.hook].count++,this.shader=ja[this.hook].shader):b.shader?(this.shader&&!b.commonShader&&this.shader.destroy(),
a=b.shader.call(this,this.inputs,{vertex:Y,fragment:ka},p.util),this.shader=a instanceof r?a:a&&a.vertex&&a.fragment?new r(s,a.vertex,a.fragment):X,b.commonShader&&(ja[this.hook]={count:1,shader:this.shader})):this.shader=X,this.shaderDirty=!1)};P.prototype.render=function(){function a(b,c,d,y,q,u){ha(b,c,d,y,q||e,u)}var b,c,d=this.effect,e=this,q;if(s){this.initialized||this.initialize();this.shaderDirty&&this.buildShader();if(this.dirty&&this.ready){for(b in this.sources)!this.sources.hasOwnProperty(b)||
d.requires&&!d.requires.call(this,b,this.inputs)||(q="function"===typeof this.inPlace?this.inPlace(b):this.inPlace,this.sources[b].render(!q));this.frameBuffer&&(c=this.frameBuffer.frameBuffer);"function"===typeof d.draw?(d.draw.call(this,this.shader,this.model,this.uniforms,c,a),this.emit("render")):c&&(ha(this.shader,this.model,this.uniforms,c,this),this.emit("render"));this.dirty=!1}return this.texture}};P.prototype.setInput=function(a,b){var c,d,e;if(this.effect.inputs.hasOwnProperty(a)){c=this.effect.inputs[a];
if("image"===c.type){if(b){if(b=w(b),b!==this.sources[a]){a:if(d=this.sources[a]){for(e in this.sources)if(e!==a&&this.sources.hasOwnProperty(e)&&this.sources[e]===d)break a;d.removeTarget(this)}if(B(b,this))throw Error("Attempt to make cyclical connection.");this.sources[a]=b;b.addTarget(this)}}else delete this.sources[a],b=!1;d=this.sources[a];e=Object.keys(this.sources);!0===this.inPlace&&1===e.length?(e=this.sources[e[0]],this.uniforms.transform=e&&e.cumulativeMatrix||E):this.uniforms.transform=
E}else d=M[this.hook]&&void 0!==M[this.hook][a]?M[this.hook][a]:c.defaultValue,d=b=c.validate.call(this,b,c,d,this.inputs[a]);if(this.inputs[a]===b&&"color"!==c.type&&"vector"!==c.type)return b;this.inputs[a]=b;c.uniform&&(this.uniforms[c.uniform]=d);"image"===c.type?(this.resize(),this.updateReady()):c.updateSources&&this.updateReady();c.shaderDirty&&(this.shaderDirty=!0);this.setDirty();c.update&&c.update.call(this,b);return b}};P.prototype.alias=function(a,b){var c=this;if(0<=za.indexOf(b))throw Error("'"+
b+"' is a reserved name and cannot be used as an alias.");this.effect.inputs.hasOwnProperty(a)&&(b||(b=a),C.removeAlias(b),ga[b]={node:this,input:a},Object.defineProperty(C,b,{configurable:!0,enumerable:!0,get:function(){return c.inputs[a]},set:function(b){return c.setInput(a,b)}}));return this};P.prototype.matte=function(a){function b(a){var c,d,e,y,q,h=[],f;if(!a.simple){for(c=0;c<a.edges.length;c++)for(e=a.edges[c],d=c+1;d<a.edges.length;d++){y=a.edges[d];a:{q=e[0];f=e[1];var g=y[0],n=y[1],p=void 0,
U=void 0,r=void 0,U=p=void 0,p=(n.x-g.x)*(q.y-g.y)-(n.y-g.y)*(q.x-g.x),U=(f.x-q.x)*(q.y-g.y)-(f.y-q.y)*(q.x-g.x);if(r=(n.y-g.y)*(f.x-q.x)-(n.x-g.x)*(f.y-q.y))if(p/=r,U/=r,0<p&&1>=p&&0<U&&1>=U){q={x:q.x+p*(f.x-q.x),y:q.y+p*(f.y-q.y)};break a}q=!1}q&&(q.edge1=e,q.edge2=y,h.push(q))}if(h.length){d=[];for(c=0;c<h.length;c++)q=h[c],e=q.edge1,y=q.edge2,f={x:q.x,y:q.y,prev:e[0],next:y[1],id:k.length},a.vertices.push(f),k.push(f),e={x:q.x,y:q.y,prev:y[0],next:e[1],id:k.length},a.vertices.push(e),k.push(f),
f.prev.next=f,f.next.prev=f,e.prev.next=e,e.next.prev=e;do{h={edges:[],vertices:[],simple:!0};d.push(h);e=y=a.vertices[0];do c=a.vertices.indexOf(y),a.vertices.splice(c,1),h.edges.push([y,y.next]),h.vertices.push(y),y=y.next;while(y!==e)}while(a.vertices.length);c=u.indexOf(a);u.splice(c,1);for(c=0;c<d.length;c++)u.push(d[c])}else a.simple=!0}}function c(a){var b,d,e=a.vertices.length,y,q=0;b=e-1;for(d=0;d<e;b=d,d++)b=a.vertices[b],y=a.vertices[d],q+=b.x*y.y-y.x*b.y;return 0<q}function d(a){var b,
c=a.vertices,e,y=[],q=[],f,u,k,g;e=c.length;if(a.clockWise)for(b=0;b<e;b++)y[b]=b;else for(b=0;b<e;b++)y[b]=e-1-b;f=2*e;u=0;for(b=e-1;2<e;){if(0>=f--)return q;k=b;e<=k&&(k=0);b=k+1;e<=b&&(b=0);g=b+1;e<g&&(g=0);var n;a:{var p=n=void 0,U=void 0,r=void 0,m=void 0,p=c[y[k]],U=c[y[b]],r=c[y[g]];if(0>(U.x-p.x)*(r.y-p.y)-(U.y-p.y)*(r.x-p.x))n=!1;else{for(n=0;n<e;n++)if(n!==k&&n!==b&&n!==g){var m=c[y[n]],K=void 0,l=void 0,v=void 0,wa=void 0,s=void 0,z=void 0,t=void 0,G=void 0,x=void 0,va=void 0,ia=void 0,
ha=void 0,K=v=s=void 0,K=r.x-U.x,l=r.y-U.y,v=p.x-r.x,wa=p.y-r.y,s=U.x-p.x,z=U.y-p.y,t=m.x-p.x,G=m.y-p.y,x=m.x-U.x,va=m.y-U.y,ia=m.x-r.x,ha=m.y-r.y,K=K*va-l*x,s=s*G-z*t,v=v*ha-wa*ia;if(0<=K&&0<=v&&0<=s){n=!1;break a}}n=!0}}if(n){f=y[k];k=y[b];g=y[g];a.clockWise?(q.push(c[f]),q.push(c[k]),q.push(c[g])):(q.push(c[g]),q.push(c[k]),q.push(c[f]));u++;g=b;for(f=b+1;f<e;g++,f++)y[g]=y[f];e--;f=2*e}}h.indices=q}var q,u=[],h,k=[],f,g,n,p,m,r={};q=function(a){return a&&a.length&&Array.isArray(a)?!Array.isArray(a[0])||
Array.isArray(a[0])&&!isNaN(a[0][0])?[a]:a:[]}(a);for(f=0;f<q.length;f++){a=q[f];m=null;h={vertices:[],edges:[]};for(g=0;g<a.length;g++)n=a[g],"object"!==typeof n||isNaN(n.x)||isNaN(n.y)?2<=n.length&&!isNaN(n[0])&&!isNaN(n[1])&&(p={x:n[0],y:n[1],id:k.length}):p={x:n.x,y:n.y,id:k.length},p&&(m?(m.next=p,p.prev=m,p.next=h.vertices[0],h.vertices[0].prev=p):(h.head=p,p.next=p,p.prev=p),k.push(p),h.vertices.push(p),m=p);if(2<h.vertices.length)for(3===h.vertices.length&&(h.simple=!0),u.push(h),g=0;g<h.vertices.length;g++)p=
h.vertices[g],h.edges.push([p,p.next])}for(f=u.length-1;0<=f;f--)h=u[f],b(h);for(f=0;f<u.length;f++)h=u[f],h.clockWise=c(h),d(h);r.vertices=[];r.coords=[];for(f=0;f<k.length;f++)n=k[f],r.vertices.push(2*n.x-1),r.vertices.push(-2*n.y+1),r.vertices.push(-1),r.coords.push(n.x),r.coords.push(-1*n.y+1);r.vertices=new Float32Array(r.vertices);r.coords=new Float32Array(r.coords);r.indices=[];for(f=0;f<u.length;f++)for(h=u[f],g=0;g<h.indices.length;g++)n=h.indices[g],r.indices.push(n.id);r.indices=new Uint16Array(r.indices);
this.shape=r;this.gl&&e(r,this.gl)};P.prototype.destroy=function(){var a,b,c=this.hook;this.effect.destroy&&"function"===typeof this.effect.destroy&&this.effect.destroy.call(this);delete this.effect;ja[c]&&(ja[c].count--,ja[c].count||delete ja[c]);this.shader&&this.shader.destroy&&this.shader!==X&&!ja[c]&&this.shader.destroy();delete this.shader;for(a in this.inputElements)this.inputElements.hasOwnProperty(a)&&(b=this.inputElements[a],b.element.removeEventListener("change",b.listener,!0),b.element.removeEventListener("input",
b.listener,!0));for(a in this.sources)this.sources.hasOwnProperty(a)&&((b=this.sources[a])&&b.removeTarget&&b.removeTarget(this),delete this.sources[a]);for(;this.targets.length;)(b=this.targets.pop())&&b.removeSource&&b.removeSource(this);for(a in this)this.hasOwnProperty(a)&&"id"!==a&&delete this[a];for(a in ga)ga.hasOwnProperty(a)&&(b=ga[a],b.node===this&&C.removeAlias(a));a=la.indexOf(this);0<=a&&la.splice(a,1);a=D[c].indexOf(this);0<=a&&D[c].splice(a,1);I.prototype.destroy.call(this)};qa=function(a){Object.defineProperties(this,
{original:{enumerable:!0,configurable:!0,get:function(){return a.source}},id:{enumerable:!0,configurable:!0,get:function(){return a.id}},width:{enumerable:!0,configurable:!0,get:function(){return a.width}},height:{enumerable:!0,configurable:!0,get:function(){return a.height}}});this.render=function(){a.render()};this.update=function(){a.setDirty()};this.readPixels=function(b,c,d,e,q){return a.readPixels(b,c,d,e,q)};this.on=function(b,c){a.on(b,c)};this.off=function(b,c){a.off(b,c)};this.destroy=function(){var b,
c;a.destroy();for(b in this)this.hasOwnProperty(b)&&"isDestroyed"!==b&&"id"!==b&&(c=Object.getOwnPropertyDescriptor(this,b),c.get||c.set||"function"!==typeof this[b]?delete this[b]:this[b]=O)};this.isDestroyed=function(){return a.isDestroyed};this.isReady=function(){return a.ready}};aa=function(b,d,e){function q(a,b,d,e){var y=A[a];if(y.definition)if(y=y.definition.call(p,b,d,e))y=c(c({},A[a]),y);else return null;return y}function h(a){return p.source===a}var f=e||{},u=void 0===f.flip?!0:f.flip,k=
f.width,g=f.height,n=!1,p=this,r=!1,m,K;I.call(this);if(b&&"string"!==typeof b||!d&&0!==d)e&&"object"===typeof e||(e=d),d=b;"string"===typeof d&&isNaN(d)&&(d=a(d,["canvas","img","video"]));"string"===typeof b&&A[b]&&(K=q(b,d,e,!0))&&(this.hook=b,r=!0,n=K.deferTexture,this.plugin=K,this.compare=K.compare,this.checkDirty=K.checkDirty,K.source&&(d=K.source));if(!K&&d instanceof HTMLElement)"CANVAS"===d.tagName?(this.width=d.width,this.height=d.height,this.render=this.renderImageCanvas,r=!0,this.hook=
"canvas",this.compare=h):"IMG"===d.tagName&&(this.width=d.naturalWidth||1,this.height=d.naturalHeight||1,d.complete&&d.naturalWidth||(n=!0),d.addEventListener("load",function(){if(!p.isDestroyed){if(p.width!==d.naturalWidth||p.height!==d.naturalHeight)p.width=d.naturalWidth,p.height=d.naturalHeight,p.resize();p.setDirty();p.setReady()}},!0),this.render=this.renderImageCanvas,r=!0,this.hook="image",this.compare=h);else if(!K&&d instanceof WebGLTexture){if(s&&!s.isTexture(d))throw Error("Not a valid WebGL texture.");
isNaN(k)?isNaN(g)||(k=g):isNaN(g)&&(g=k);this.width=k;this.height=g;void 0===f.flip&&(u=!1);r=!0;this.texture=d;this.initialized=!0;this.hook="texture";this.compare=h;this.render=function(){}}if(!r&&!K)for(m in A)if(A.hasOwnProperty(m)&&A[m]&&(K=q(m,d,e,!1))){this.hook=m;r=!0;n=K.deferTexture;this.plugin=K;this.compare=K.compare;this.checkDirty=K.checkDirty;K.source&&(d=K.source);break}if(!r)throw Error("Unknown source type");this.source=d;void 0===this.flip&&(this.flip=u);this.targets=[];n||p.setReady();
this.pub=new qa(this);fa.push(this);oa[this.id]=this;Z.push(this);S[this.hook].push(this);Z.length&&!$&&x()};aa.prototype=Object.create(I.prototype);aa.prototype.initialize=function(){var a;s&&!this.texture&&this.ready&&(a=s.createTexture(),s.bindTexture(s.TEXTURE_2D,a),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),
s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.bindTexture(s.TEXTURE_2D,null),this.texture=a,this.allowRefresh=this.initialized=!0,this.setDirty())};aa.prototype.initFrameBuffer=function(a){s&&(this.frameBuffer=new n(s,this.width,this.height,{texture:this.texture,useFloat:a}))};aa.prototype.addTarget=function(a){var b;for(b=0;b<this.targets.length;b++)if(this.targets[b]===a)return;this.targets.push(a)};aa.prototype.removeTarget=function(a){a=this.targets&&this.targets.indexOf(a);
0<=a&&this.targets.splice(a,1)};aa.prototype.resize=function(){var a,b;this.uniforms.resolution[0]=this.width;this.uniforms.resolution[1]=this.height;this.framebuffer&&this.framebuffer.resize(this.width,this.height);this.emit("resize");this.setDirty();if(this.targets)for(a=0;a<this.targets.length;a++)b=this.targets[a],b.resize(),b.setTransformDirty&&b.setTransformDirty()};aa.prototype.setReady=function(){var a;if(!this.ready&&(this.ready=!0,this.resize(),this.initialize(),this.emit("ready"),this.targets))for(a=
0;a<this.targets.length;a++)this.targets[a].setReady()};aa.prototype.render=function(){var a=this.source;s&&(a||0===a)&&this.ready&&(this.initialized||this.initialize(),this.allowRefresh&&this.plugin&&this.plugin.render&&(this.dirty||this.checkDirty&&this.checkDirty())&&this.plugin.render.call(this,s,ha,V,X)&&(this.dirty=!1,this.emit("render")))};aa.prototype.renderImageCanvas=function(){var a=this.source;if(s&&a&&this.ready&&(this.initialized||this.initialize(),this.allowRefresh&&this.dirty)){s.bindTexture(s.TEXTURE_2D,
this.texture);s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,this.flip);s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);try{return s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,a),this.dirty=!1,this.emit("render"),!0}catch(c){c.code===b.DOMException.SECURITY_ERR&&(this.allowRefresh=!1,p.logger.error("Unable to access cross-domain image"))}return!1}};aa.prototype.destroy=function(){var a,b;this.plugin&&this.plugin.destroy&&this.plugin.destroy.call(this);for(s&&this.texture&&s.deleteTexture(this.texture);this.targets.length;)(a=
this.targets.pop())&&a.removeSource&&a.removeSource(this);a=Z.indexOf(this);0<=a&&Z.splice(a,1);a=S[this.hook].indexOf(this);0<=a&&S[this.hook].splice(a,1);for(b in this)this.hasOwnProperty(b)&&"id"!==b&&delete this[b];I.prototype.destroy.call(this)};ua=function(a){Object.defineProperties(this,{source:{enumerable:!0,configurable:!0,get:function(){if(a.source)return a.source.pub},set:function(b){a.setSource(b)}},original:{enumerable:!0,configurable:!0,get:function(){return a.target}},width:{enumerable:!0,
configurable:!0,get:function(){return a.width},set:function(b){!isNaN(b)&&0<b&&a.width!==b&&(a.width=b,a.resize(),a.setTransformDirty())}},height:{enumerable:!0,configurable:!0,get:function(){return a.height},set:function(b){!isNaN(b)&&0<b&&a.height!==b&&(a.height=b,a.resize(),a.setTransformDirty())}},id:{enumerable:!0,configurable:!0,get:function(){return a.id}}});this.render=function(){a.render()};this.readPixels=function(b,c,d,e,q){return a.readPixels(b,c,d,e,q)};this.on=function(b,c){a.on(b,c)};
this.off=function(b,c){a.off(b,c)};this.go=function(b){a.go(b)};this.stop=function(){a.stop()};this.getTexture=function(){return a.frameBuffer.texture};this.destroy=function(){var b,c;a.destroy();for(b in this)this.hasOwnProperty(b)&&"isDestroyed"!==b&&"id"!==b&&(c=Object.getOwnPropertyDescriptor(this,b),c.get||c.set||"function"!==typeof this[b]?delete this[b]:this[b]=O)};this.inputs=function(a){return{source:{type:"image"}}};this.isDestroyed=function(){return a.isDestroyed};this.isReady=function(){return a.ready}};
ba=function(a,b,d){function e(a,b,d,q){var h=H[a];if(h.definition){h=h.definition.call(g,b,d,q);if(!h)return null;h=c(c({},H[a]),h);g.hook=G;m=!0;g.plugin=h;g.compare=h.compare;h.gl&&!g.gl&&(g.gl=h.gl,s||k(h.gl));g.gl===s&&(g.model=V,g.shader=X)}return h}var f,h,u,g=this,m=!1,K,v,z,t,G;I.call(this);if(a&&"string"!==typeof a||!b&&0!==b)d&&"object"===typeof d||(d=b),b=a;d=d||{};f=void 0===d.flip?!0:d.flip;h=parseInt(d.width,10);u=parseInt(d.height,10);v=d.debugContext;"string"===typeof a&&H[a]&&e(a,
b,d,!0);this.renderToTexture=d.renderToTexture;if(b instanceof WebGLFramebuffer)if(z=b,d instanceof HTMLCanvasElement)b=d;else if(d instanceof WebGLRenderingContext)b=d.canvas;else if(d.canvas instanceof HTMLCanvasElement)b=d.canvas;else if(d.context instanceof WebGLRenderingContext)b=d.context.canvas;else throw Error("Must provide a canvas with WebGLFramebuffer target");if(b instanceof HTMLElement&&"CANVAS"===b.tagName){h=b.width;u=b.height;if(!s||s.canvas!==b&&d.allowSecondaryWebGL)K=l(b,{alpha:!0,
premultipliedAlpha:!0,preserveDrawingBuffer:!0,stencil:!0,debugContext:v});if(K)s&&s!==K?(this.gl=K,this.frameBuffer={frameBuffer:z||null},this.shader=new r(this.gl,Y,ka),this.model=q.call(this,this.gl),this.pixels=null,this.texture=this.gl.createTexture(),this.gl.bindTexture(s.TEXTURE_2D,this.texture),this.gl.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),this.gl.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),this.gl.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),
this.gl.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),this.render=this.renderSecondaryWebGL):(N||(N=this),s||k(K),this.render=this.renderWebGL,d.renderToTexture?s&&(this.frameBuffer=new n(s,h,u,!1)):this.frameBuffer={frameBuffer:z||null});else{if(!d.allowSecondaryWebGL&&s&&s.canvas!==b)throw Error("Only one WebGL target canvas allowed. Set allowSecondaryWebGL option to create secondary context.");this.render=O;p.logger.log("Unable to create WebGL context.")}m=!0}if(!m)for(G in H)if(H.hasOwnProperty(G)&&
H[G]&&e(G,b,d,!1))break;if(!m)throw Error("Unknown target type");J&&((t=J.get(b))?p.logger.warn("Target already in use by another instance",b,Object.keys(t).map(function(a){return t[a]})):(t={},J.set(b,t)),t[C.id]=C);this.target=b;this.transform=null;this.transformDirty=!0;this.flip=f;h&&(this.width=h);u&&(this.height=u);this.uniforms.resolution[0]=this.width;this.uniforms.resolution[1]=this.height;this.auto=void 0!==d.auto?d.auto:xa;this.frames=0;this.pub=new ua(this);fa.push(this);oa[this.id]=this;
W.push(this)};ba.prototype=Object.create(I.prototype);ba.prototype.setSource=function(a){a=w(a);a!==this.source&&(this.source&&this.source.removeTarget(this),this.source=a,a.addTarget(this),a&&(this.resize(),a.ready?this.setReady():this.setUnready()),this.setDirty())};ba.prototype.setDirty=function(){this.dirty=!0;this.auto&&!$&&($=ta(x))};ba.prototype.resize=function(){if(this.target instanceof HTMLCanvasElement){if(this.width!==this.target.width||this.height!==this.target.height)this.target.width=
this.width,this.target.height=this.height,this.uniforms.resolution[0]=this.width,this.uniforms.resolution[1]=this.height,this.emit("resize"),this.setTransformDirty()}else this.plugin&&this.plugin.resize&&this.plugin.resize.call(this);!this.source||this.source.width===this.width&&this.source.height===this.height||this.transform||(this.transform=new Float32Array(16))};ba.prototype.setTransformDirty=function(){this.transformDirty=!0;this.setDirty()};ba.prototype.go=function(){this.auto=!0;this.setDirty()};
ba.prototype.stop=function(){this.auto=!1};ba.prototype.render=function(){s&&this.plugin&&this.plugin.render&&this.plugin.render.call(this,ha,X,V)};ba.prototype.renderWebGL=function(){var a,b,c;this.resize();s&&this.dirty&&this.ready&&this.source&&(this.source.render(),this.uniforms.source=this.source.texture,this.source.width===this.width&&this.source.height===this.height?this.uniforms.transform=this.source.cumulativeMatrix||E:this.transformDirty&&(a=this.transform,da.copy(a,this.source.cumulativeMatrix||
E),b=this.source.width/this.width,c=this.source.height/this.height,a[0]*=b,a[1]*=b,a[2]*=b,a[3]*=b,a[4]*=c,a[5]*=c,a[6]*=c,a[7]*=c,this.uniforms.transform=a,this.transformDirty=!1),ha(X,V,this.uniforms,this.frameBuffer.frameBuffer,this,ca),this.emit("render"),this.dirty=!1)};ba.prototype.renderSecondaryWebGL=function(){var a,b,c;this.dirty&&this.ready&&this.source&&(this.emit("render"),this.source.render(!0),a=this.source.width,b=this.source.height,this.pixels&&this.pixels.length===a*b*4||(this.pixels=
new Uint8Array(a*b*4)),this.source.readPixels(0,0,a,b,this.pixels),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,a,b,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.pixels),a===this.width&&b===this.height?this.uniforms.transform=E:this.transformDirty&&(a=this.transform,da.copy(a,E),b=this.source.width/this.width,c=this.source.height/this.height,a[0]*=b,a[1]*=b,a[2]*=b,a[3]*=b,a[4]*=c,a[5]*=c,a[6]*=c,a[7]*=c,this.uniforms.transform=a,this.transformDirty=!1),this.uniforms.source=this.texture,ha(this.shader,
this.model,this.uniforms,null,this,ca),this.dirty=!1)};ba.prototype.removeSource=function(a){if(this.source===a||this.source===a.pub)this.source=null};ba.prototype.destroy=function(){var a;this.source&&this.source.removeTarget&&this.source.removeTarget(this);J&&(a=J.get(this.target),delete a[C.id],Object.keys(a).length||J.delete(this.target));this.plugin&&this.plugin.destroy&&this.plugin.destroy.call(this);delete this.source;delete this.target;delete this.pub;delete this.uniforms;delete this.pixels;
delete this.auto;a=W.indexOf(this);0<=a&&W.splice(a,1);I.prototype.destroy.call(this);this===N&&(R.removeEventListener("webglcontextrestored",m,!1),t(),N=null)};ra=function(b){function d(b,c,e){var q;q=h.inputElements[b];"string"===typeof e&&isNaN(e)&&("enum"===c.type?c.options.hasOwnProperty(e)||(e=a(e,["select"])):"number"===c.type||"boolean"===c.type?e=a(e,["input","select"]):"image"===c.type&&(e=a(e,["canvas","img","video"])));e instanceof HTMLInputElement||e instanceof HTMLSelectElement?(c=e.value,
q&&q.element!==e&&(q.element.removeEventListener("change",q.listener,!0),q.element.removeEventListener("input",q.listener,!0),delete h.inputElements[b],q=null),q||(q={element:e,listener:function(a){return function(){var c,d;c="checkbox"===e.type?e.checked:a.value;d=h.setInput(b,c);"color"===e.type&&(d=f(d));d!==c&&(a.value=d)}}(e)},h.inputElements[b]=q,"range"===e.type&&e.addEventListener("input",q.listener,!0),e.addEventListener("change",q.listener,!0)),q&&"checkbox"===e.type&&(c=e.checked)):(q&&
(q.element.removeEventListener("change",q.listener,!0),q.element.removeEventListener("input",q.listener,!0),delete h.inputElements[b]),c=e);h.setInput(b,c)}function e(a,b){Object.defineProperty(g,a,{configurable:!0,enumerable:!0,get:function(){return b.get.call(h)},set:function(c){d(a,b,c)}})}function q(a){return function(){a.apply(h,arguments)&&h.setTransformDirty()}}var h=b,g=this,u;Object.defineProperties(this,{transform:{enumerable:!0,configurable:!0,get:function(){return h.hook}},title:{enumerable:!0,
configurable:!0,get:function(){return h.plugin.title||h.hook}},width:{enumerable:!0,configurable:!0,get:function(){return h.width}},height:{enumerable:!0,configurable:!0,get:function(){return h.height}},id:{enumerable:!0,configurable:!0,get:function(){return h.id}},source:{enumerable:!0,configurable:!0,get:function(){return h.source&&h.source.pub},set:function(a){h.setSource(a)}}});for(u in h.methods)h.methods.hasOwnProperty(u)&&(this[u]=q(h.methods[u].bind(h)));for(u in h.inputs)h.inputs.hasOwnProperty(u)&&
e(u,h.inputs[u]);this.update=function(){h.setDirty()};this.inputs=function(a){var b,d;b=h.plugin.inputs;if(a){b=b[a];if(!b||b.method)return null;a={type:b.type,defaultValue:b.defaultValue,title:b.title||a};"number"===b.type?(a.min=b.min,a.max=b.max,a.step=b.step):"enum"===b.type?a.options=c({},b.options):"vector"===b.type&&(a.dimensions=b.dimensions);b.description&&(a.description=b.description);return a}a={};for(d in b)b.hasOwnProperty(d)&&!b[d].method&&(a[d]=this.inputs(d));return a};this.alias=
function(a,b){h.alias(a,b);return this};this.on=function(a,b){h.on(a,b)};this.off=function(a,b){h.off(a,b)};this.destroy=function(){var a,b;h.destroy();for(a in this)this.hasOwnProperty(a)&&"isDestroyed"!==a&&"id"!==a&&(b=Object.getOwnPropertyDescriptor(this,a),b.get||b.set||"function"!==typeof this[a]?delete this[a]:this[a]=O)};this.isDestroyed=function(){return h.isDestroyed};this.isReady=function(){return h.ready}};Q=function(a,b){var d,e,q,f,u;this.matrix=new Float32Array(16);this.cumulativeMatrix=
new Float32Array(16);this.ready=!1;this.height=this.width=1;this.seriously=C;this.transformRef=ea[a];this.hook=a;this.id=ia;ia++;this.options=b;this.sources=null;this.targets=[];this.inputElements={};this.inputs={};this.methods={};this.listeners={};this.uniforms=this.frameBuffer=this.texture=null;this.transformDirty=this.dirty=!0;this.transformed=this.isDestroyed=this.renderDirty=!1;this.plugin=c({},this.transformRef);this.transformRef.definition&&c(this.plugin,this.transformRef.definition.call(this,
b));for(d in this.plugin.inputs)this.plugin.inputs.hasOwnProperty(d)&&(e=this.plugin.inputs[d],e.method&&"function"===typeof e.method?this.methods[d]=e.method:"function"===typeof e.set&&"function"===typeof e.get&&(this.inputs[d]=e));h(this.plugin);u=M[a];for(d in this.plugin.inputs)this.plugin.inputs.hasOwnProperty(d)&&(e=this.plugin.inputs[d],"function"===typeof e.set&&"function"===typeof e.get&&"function"!==typeof e.method&&(q=e.get.call(this),f=void 0===e.defaultValue?q:e.defaultValue,f=e.validate.call(this,
f,e,q),u&&void 0!==u[d]&&(f=e.validate.call(this,u[d],e,e.defaultValue,f),u[d]=f),f!==q&&e.set.call(this,f)));fa.push(this);oa[this.id]=this;this.pub=new ra(this);F.push(this);z[a].push(this)};Q.prototype=Object.create(I.prototype);Q.prototype.setDirty=function(){this.renderDirty=!0;I.prototype.setDirty.call(this)};Q.prototype.setTransformDirty=function(){var a,b;this.renderDirty=this.dirty=this.transformDirty=!0;for(a=0;a<this.targets.length;a++)b=this.targets[a],b.setTransformDirty?b.setTransformDirty():
b.setDirty()};Q.prototype.resize=function(){var a;I.prototype.resize.call(this);this.plugin.resize&&this.plugin.resize.call(this);for(a=0;a<this.targets.length;a++)this.targets[a].resize();this.setTransformDirty()};Q.prototype.setSource=function(a){a=w(a);if(a!==this.source){if(B(a,this))throw Error("Attempt to make cyclical connection.");this.source&&this.source.removeTarget(this);this.source=a;a.addTarget(this);a&&a.ready?this.setReady():this.setUnready();this.resize()}};Q.prototype.addTarget=function(a){var b;
for(b=0;b<this.targets.length;b++)if(this.targets[b]===a)return;this.targets.push(a)};Q.prototype.removeTarget=function(a){a=this.targets&&this.targets.indexOf(a);0<=a&&this.targets.splice(a,1);this.targets&&this.targets.length&&this.resize()};Q.prototype.setInput=function(a,b){var c,d,e;if(this.plugin.inputs.hasOwnProperty(a))return c=this.plugin.inputs[a],d=M[this.hook]&&void 0!==M[this.hook][a]?M[this.hook][a]:c.defaultValue,e=c.get.call(this),void 0===d&&(d=e),b=c.validate.call(this,b,c,d,e),
c.set.call(this,b)&&this.setTransformDirty(),c.get.call(this)};Q.prototype.alias=function(a,b){var c=this,d,e;if(0<=za.indexOf(b))throw Error("'"+b+"' is a reserved name and cannot be used as an alias.");if(this.plugin.inputs.hasOwnProperty(a)){b||(b=a);C.removeAlias(b);if(d=this.inputs[a])e=c.inputs[a],Object.defineProperty(C,b,{configurable:!0,enumerable:!0,get:function(){return e.get.call(c)},set:function(a){e.set.call(c,a)&&c.setTransformDirty()}});else if(d=this.methods[a])e=d,C[b]=function(){e.apply(c,
arguments)&&c.setTransformDirty()};d&&(ga[b]={node:this,input:a})}return this};Q.prototype.render=function(a){if(this.source)return this.source.render(),this.transformDirty&&(this.transformed?this.source.cumulativeMatrix?da.multiply(this.cumulativeMatrix,this.matrix,this.source.cumulativeMatrix):da.copy(this.cumulativeMatrix,this.matrix):da.copy(this.cumulativeMatrix,this.source.cumulativeMatrix||E),this.transformDirty=!1),a&&s?(this.renderDirty&&(this.frameBuffer||(this.uniforms={resolution:[this.width,
this.height]},this.frameBuffer=new n(s,this.width,this.height)),this.uniforms.source=this.source.texture,this.uniforms.transform=this.cumulativeMatrix||E,ha(X,V,this.uniforms,this.frameBuffer.frameBuffer,this),this.renderDirty=!1),this.texture=this.frameBuffer.texture):this.texture=this.source?this.source.texture:null,this.dirty=!1,this.texture;this.transformDirty&&(da.copy(this.cumulativeMatrix,this.matrix),this.transformDirty=!1);this.texture=null;this.dirty=!1};Q.prototype.readPixels=function(a,
b,c,d,e){var q=this.gl||s;if(!s)throw Error("Cannot read pixels until a canvas is connected");this.render(!0);if(void 0===e)e=new Uint8Array(c*d*4);else if(!e instanceof Uint8Array)throw Error("Incompatible array type");q.bindFramebuffer(s.FRAMEBUFFER,this.frameBuffer.frameBuffer);q.readPixels(a,b,c,d,s.RGBA,s.UNSIGNED_BYTE,e);return e};Q.prototype.destroy=function(){var a,b,c,d=this.hook;this.plugin.destroy&&"function"===typeof this.plugin.destroy&&this.plugin.destroy.call(this);delete this.effect;
this.frameBuffer&&(this.frameBuffer.destroy(),delete this.frameBuffer,delete this.texture);for(a in this.inputElements)this.inputElements.hasOwnProperty(a)&&(c=this.inputElements[a],c.element.removeEventListener("change",c.listener,!0),c.element.removeEventListener("input",c.listener,!0));for(this.source&&this.source.removeTarget(this);this.targets.length;)(c=this.targets.pop())&&c.removeSource&&c.removeSource(this);for(b in this)this.hasOwnProperty(b)&&"id"!==b&&delete this[b];for(b in ga)ga.hasOwnProperty(b)&&
(c=ga[b],c.node===this&&C.removeAlias(b));a=F.indexOf(this);0<=a&&F.splice(a,1);a=z[d].indexOf(this);0<=a&&z[d].splice(a,1);I.prototype.destroy.call(this)};Q.prototype.setReady=I.prototype.setReady;Q.prototype.setUnready=I.prototype.setUnready;Q.prototype.on=I.prototype.on;Q.prototype.off=I.prototype.off;Q.prototype.emit=I.prototype.emit;d=d instanceof HTMLCanvasElement?{canvas:d}:d||{};this.effect=function(a,b){if(!G[a])throw Error("Unknown effect: "+a);return(new P(a,b)).pub};this.source=function(a,
b,c){return w(a,b,c).pub};this.transform=function(a,b){"string"!==typeof a&&(b=a,a=!1);if(a){if(!ea[a])throw Error("Unknown transform: "+a);}else if(a=d&&d.defaultTransform||"2d",!ea[a])throw Error("No transform specified");return(new Q(a,b)).pub};this.target=function(a,b,c){var d,e;a&&"string"===typeof a&&!H[a]&&(d=v.querySelector(a));if("string"!==typeof a||!b&&0!==b||d)c&&"object"===typeof c||(c=b),b=d||a,a=null;"string"===typeof b&&isNaN(b)&&(b=v.querySelector(b));for(e=0;e<W.length;e++)if(d=
W[e],(!a||a===d.hook)&&(d.target===b||d.compare&&d.compare(b,c)))return d.pub;d=new ba(a,b,c);return d.pub};this.aliases=function(){return Object.keys(ga)};this.removeAlias=function(a){ga[a]&&(delete this[a],delete ga[a])};this.defaults=function(a,b){var d;if(a)if("object"===typeof a)for(d in a)a.hasOwnProperty(d)&&this.defaults(d,a[d]);else null===b?delete M[a]:"object"===typeof b&&(M[a]=c({},b));else if(null===a)for(d in M)M.hasOwnProperty(d)&&delete M[d]};this.go=function(a,b){var c;"function"===
typeof a&&0>ma.indexOf(a)&&ma.push(a);"function"===typeof b&&0>na.indexOf(b)&&na.push(b);xa=!0;for(c=0;c<W.length;c++)W[c].go();$||!ma.length&&!na.length||x()};this.stop=function(){ma.length=0;na.length=0;sa($);$=0};this.render=function(){var a;for(a=0;a<W.length;a++)W[a].render(d)};this.destroy=function(){for(var a,b;fa.length;)b=fa.shift(),b.destroy();for(a in this)this.hasOwnProperty(a)&&"isDestroyed"!==a&&"id"!==a&&(b=Object.getOwnPropertyDescriptor(this,a),b.get||b.set||"function"!==typeof this[a]?
delete this[a]:this[a]=O);C=null;Z=[];W=[];la=[];fa=[];ma.length=0;na.length=0;sa($);$=0;ya=!0};this.isDestroyed=function(){return ya};this.incompatible=function(a){var b,c=!1;if(c=p.incompatible(a))return c;if(!a){for(b in D)if(D.hasOwnProperty(b)&&D[b].length&&(a=G[b])&&"function"===typeof a.compatible&&!a.compatible.call(this))return"plugin-"+b;for(b in S)if(S.hasOwnProperty(b)&&S[b].length&&(a=A[b])&&"function"===typeof a.compatible&&!a.compatible.call(this))return"source-"+b}return!1};this.isNode=
function(a){return a&&(a=oa[a.id])&&!a.isDestroyed?!0:!1};this.isSource=function(a){return this.isNode(a)&&a instanceof qa};this.isEffect=function(a){return this.isNode(a)&&a instanceof pa};this.isTransform=function(a){return this.isNode(a)&&a instanceof ra};this.isTarget=function(a){return this.isNode(a)&&a instanceof ua};Object.defineProperties(this,{id:{enumerable:!0,configurable:!0,get:function(){return L}}});this.defaults(d.defaults)}var v=b.document,x=b.console,w,B,L,G={},ea={},A={},H={},t=
[],D={},z={},S={canvas:[],image:[],video:[]},C={},J=b.WeakMap&&new WeakMap,E,T=0,O=function(){},F,R={transparent:[0,0,0,0],black:[0,0,0,1],red:[1,0,0,1],green:[0,128/255,0,1],blue:[0,0,1,1],white:[1,1,1,1],silver:[192/255,192/255,192/255,1],gray:[128/255,128/255,128/255,1],maroon:[128/255,0,0,1],purple:[128/255,0,128/255,1],fuchsia:[1,0,1,1],lime:[0,1,0,1],olive:[128/255,128/255,0,1],yellow:[1,1,0,1],navy:[0,0,128/255,1],teal:[0,128/255,128/255,1],aqua:[0,1,1,1],orange:[1,165/255,0,1]},M=["x","y",
"z","w"],N=["r","g","b","a"],ca={srcRGB:770,dstRGB:771,srcAlpha:1,dstAlpha:771},Y,ka,da={frustum:function(a,b,c,d,e,h,f){f||(f=da.create());var g=b-a,k=d-c,p=h-e;f[0]=2*e/g;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=2*e/k;f[6]=0;f[7]=0;f[8]=(b+a)/g;f[9]=(d+c)/k;f[10]=-(h+e)/p;f[11]=-1;f[12]=0;f[13]=0;f[14]=-(h*e*2)/p;f[15]=0;return f},perspective:function(a,b,c,d,e){a=c*Math.tan(a*Math.PI/360);b*=a;return da.frustum(-b,b,-a,a,c,d,e)},multiply:function(a,b,c){var d=b[0],e=b[1],h=b[2],f=b[3],g=b[4],k=b[5],p=
b[6],n=b[7],r=b[8],m=b[9],v=b[10],l=b[11],z=b[12],t=b[13],G=b[14];b=b[15];var x=c[0],w=c[1],A=c[2],B=c[3];a[0]=x*d+w*g+A*r+B*z;a[1]=x*e+w*k+A*m+B*t;a[2]=x*h+w*p+A*v+B*G;a[3]=x*f+w*n+A*l+B*b;x=c[4];w=c[5];A=c[6];B=c[7];a[4]=x*d+w*g+A*r+B*z;a[5]=x*e+w*k+A*m+B*t;a[6]=x*h+w*p+A*v+B*G;a[7]=x*f+w*n+A*l+B*b;x=c[8];w=c[9];A=c[10];B=c[11];a[8]=x*d+w*g+A*r+B*z;a[9]=x*e+w*k+A*m+B*t;a[10]=x*h+w*p+A*v+B*G;a[11]=x*f+w*n+A*l+B*b;x=c[12];w=c[13];A=c[14];B=c[15];a[12]=x*d+w*g+A*r+B*z;a[13]=x*e+w*k+A*m+B*t;a[14]=x*
h+w*p+A*v+B*G;a[15]=x*f+w*n+A*l+B*b;return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a}},ta=function(){var a=0;return b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame||
b.oRequestAnimationFrame||b.msRequestAnimationFrame||function(c){var d,e,h;d=(new Date).getTime();e=Math.max(0,16-(d-a));h=b.setTimeout(function(){c(d+e)},e);a=d+e;return h}}(),sa=function(){return b.cancelAnimationFrame||b.webkitCancelAnimationFrame||b.mozCancelAnimationFrame||b.oCancelAnimationFrame||b.msCancelAnimationFrame||function(a){b.cancelTimeout(a)}}(),Aa="alias destroy effect id initialize inputs isDestroyed isReady matte off on readPixels render title update".split(" "),Ba="alias destroy id inputs isDestroyed isReady off on source title update".split(" "),
za=["aliases","defaults","destroy","effect","go","id","incompatible","isDestroyed","isEffect",,"isNode","isSource","isTarget","isTransform","removeAlias","render","source","stop","target","transform"];b.addEventListener("message",function(a){a.source===b&&"seriously-timeout-message"===a.data&&(a.stopPropagation(),0<t.length&&t.shift()())},!0);n.prototype.resize=function(a,b){var c=this.gl;if(this.width!==a||this.height!==b)this.width=a,this.height=b,c&&(c.bindTexture(c.TEXTURE_2D,this.texture),c.bindFramebuffer(c.FRAMEBUFFER,
this.frameBuffer),c.bindRenderbuffer(c.RENDERBUFFER,this.renderBuffer),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,a,b,0,c.RGBA,c.UNSIGNED_BYTE,null),c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_COMPONENT16,a,b),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,this.texture,0),c.bindTexture(c.TEXTURE_2D,null),c.bindRenderbuffer(c.RENDERBUFFER,null),c.bindFramebuffer(c.FRAMEBUFFER,null))};n.prototype.destroy=function(){var a=this.gl;a&&(a.deleteFramebuffer(this.frameBuffer),a.deleteRenderbuffer(this.renderBuffer),
this.ownTexture&&a.deleteTexture(this.texture));delete this.frameBuffer;delete this.renderBuffer;delete this.texture;delete this.gl};r.prototype.use=function(){this.gl.useProgram(this.program)};p.incompatible=function(a){var c,d;void 0===L&&((c=v.createElement("canvas"))&&c.getContext?b.WebGLRenderingContext?(d=m())||(L="context"):L="webgl":L="canvas");if(L)return L;if(a){if((c=G[a])&&"function"===typeof c.compatible&&!c.compatible(d))return"plugin-"+a;if((c=A[a])&&"function"===typeof c.compatible&&
!c.compatible(d))return"source-"+a}return!1};p.plugin=function(a,b,d){if(G[a])p.logger.warn("Effect ["+a+"] already loaded");else if(void 0===d&&"object"===typeof b&&(d=b),d)return d=c({},d),"function"===typeof b&&(d.definition=b),d.reserved=Aa,d.inputs&&h(d),d.title||(d.title=a),G[a]=d,D[a]=[],d};p.removePlugin=function(a){var b,c;if(!a||!G[a])return this;if(b=D[a]){for(;b.length;)c=b.shift(),c.destroy();delete D[a]}delete G[a];return this};p.source=function(a,b,d){if(A[a])p.logger.warn("Source ["+
a+"] already loaded");else if(void 0===d&&"object"===typeof b&&(d=b),d||b)return d=c({},d),"function"===typeof b&&(d.definition=b),d.title||(d.title=a),A[a]=d,S[a]=[],d};p.removeSource=function(a){var b,c;if(!a||!A[a])return this;if(b=S[a]){for(;b.length;)c=b.shift(),c.destroy();delete S[a]}delete A[a];return this};p.transform=function(a,b,d){if(ea[a])p.logger.warn("Transform ["+a+"] already loaded");else if(void 0===d&&"object"===typeof b&&(d=b),d||b)return d=c({},d),"function"===typeof b&&(d.definition=
b),d.reserved=Ba,d.inputs&&h(d),d.title||(d.title=a),ea[a]=d,z[a]=[],d};p.removeTransform=function(a){var b,c;if(!a||!ea[a])return this;if(b=z[a]){for(;b.length;)c=b.shift(),c.destroy();delete z[a]}delete ea[a];return this};p.target=function(a,b,d){if(H[a])p.logger.warn("Target ["+a+"] already loaded");else if(void 0===d&&"object"===typeof b&&(d=b),d||b)return d=c({},d),"function"===typeof b&&(d.definition=b),d.title||(d.title=a),H[a]=d,C[a]=[],d};p.removeTarget=function(a){var b,c;if(!a||!H[a])return this;
if(b=C[a]){for(;b.length;)c=b.shift(),c.destroy();delete C[a]}delete H[a];return this};p.inputValidators={color:function(a,c,d,h){var f;d=h||[];if("string"===typeof a){if((f=/^(rgb|hsl)a?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*(\d+(\.\d*)?)\s*)?\)/i.exec(a))&&f.length){if(3>f.length)return d[0]=d[1]=d[2]=d[3]=0,d;d[3]=1;for(c=0;3>c;c++)d[c]=parseFloat(f[c+2])/255;isNaN(f[6])||(d[3]=parseFloat(f[6]));return"hsl"===f[1].toLowerCase()?e(d[0],d[1],d[2],d[3],d):d}if((f=/^#(([0-9a-fA-F]{3,8}))/.exec(a))&&
f.length)return f=f[1],3===f.length?(d[0]=parseInt(f[0],16)/15,d[1]=parseInt(f[1],16)/15,d[2]=parseInt(f[2],16)/15,d[3]=1):4===f.length?(d[0]=parseInt(f[0],16)/15,d[1]=parseInt(f[1],16)/15,d[2]=parseInt(f[2],16)/15,d[3]=parseInt(f[3],16)/15):6===f.length?(d[0]=parseInt(f.substr(0,2),16)/255,d[1]=parseInt(f.substr(2,2),16)/255,d[2]=parseInt(f.substr(4,2),16)/255,d[3]=1):8===f.length?(d[0]=parseInt(f.substr(0,2),16)/255,d[1]=parseInt(f.substr(2,2),16)/255,d[2]=parseInt(f.substr(4,2),16)/255,d[3]=parseInt(f.substr(6,
2),16)/255):d[0]=d[1]=d[2]=d[3]=0,d;if(f=R[a.toLowerCase()]){for(c=0;4>c;c++)d[c]=f[c];return d}B||(B=v.createElement("a"));B.style.backgroundColor="";B.style.backgroundColor=a;f=b.getComputedStyle(B);if((f=f.getPropertyValue("background-color")||f.getPropertyValue("backgroundColor")||B.style.backgroundColor)&&f!==a)return p.inputValidators.color(f,c,h);d[0]=d[1]=d[2]=d[3]=0;return d}if(k(a)){d=a;if(3>d.length)return d[0]=d[1]=d[2]=d[3]=0,d;for(c=0;3>c;c++)if(isNaN(d[c]))return d[0]=d[1]=d[2]=d[3]=
0,d;4>d.length&&d.push(1);return d}if("number"===typeof a)return d[0]=d[1]=d[2]=a,d[3]=1,d;if("object"===typeof a){for(c=0;4>c;c++)f=N[c],null===a[f]||isNaN(a[f])?d[c]=3===c?1:0:d[c]=a[f];return d}d[0]=d[1]=d[2]=d[3]=0;return d},number:function(a,b,c){if(isNaN(a))return c||0;a=parseFloat(a);return a<b.min?b.min:a>b.max?b.max:b.step?Math.round(a/b.step)*b.step:a},"enum":function(a,b,c){b=b.options||[];"string"===typeof a?a=a.toLowerCase():"number"===typeof a?a=a.toString():a||(a="");return b.hasOwnProperty(a)?
a:c||""},vector:function(a,b,c,d){var e;b=b.dimensions||4;d=d||[];if(k(a)){for(c=0;c<b;c++)d[c]=a[c]||0;return d}if("object"===typeof a){for(c=0;c<b;c++)e=M[c],void 0===a[e]&&(e=N[c]),d[c]=a[e]||0;return d}a=parseFloat(a)||0;for(c=0;c<b;c++)d[c]=a;return d},"boolean":function(a){return!a||a&&a.toLowerCase&&"false"===a.toLowerCase()?!1:!0},string:function(a){return"string"===typeof a?a:0===a||a?a.toString?a.toString():String(a):""}};p.prototype.effects=p.effects=function(){var a,b,c,d={},e,f;for(a in G)if(G.hasOwnProperty(a)){b=
G[a];c={title:b.title||a,description:b.description||"",inputs:{}};for(f in b.inputs)b.inputs.hasOwnProperty(f)&&(e=b.inputs[f],c.inputs[f]={type:e.type,defaultValue:e.defaultValue,step:e.step,min:e.min,max:e.max,minCount:e.minCount,maxCount:e.maxCount,dimensions:e.dimensions,title:e.title||f,description:e.description||"",options:e.options||[]});d[a]=c}return d};b.Float32Array&&(E=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]));b.Seriously&&"object"===typeof b.Seriously&&function(){for(var a in b.Seriously)b.Seriously.hasOwnProperty(a)&&
"plugin"!==a&&"object"===typeof b.Seriously[a]&&p.plugin(a,b.Seriously[a])}();p.logger={log:d("log"),info:d("info"),warn:d("warn"),error:d("error")};p.util={mat4:da,checkSource:function(c){var d,e;c=a(c,["img","canvas","video"]);if(!c)return!1;d=v.createElement("canvas");if(!d)return p.logger.warn("Browser does not support canvas or Seriously.js"),!1;if(0===c.naturalWidth&&"IMG"===c.tagName)return p.logger.warn("Image not loaded"),!1;if(0===c.readyState&&0===c.videoWidth&&"VIDEO"===c.tagName)return p.logger.warn("Video not loaded"),
!1;if(e=m()){(d=e.createTexture())||p.logger.error("Test WebGL context has been lost");e.bindTexture(e.TEXTURE_2D,d);try{e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,c)}catch(f){return f.code===b.DOMException.SECURITY_ERR?p.logger.log("Unable to access cross-domain image"):p.logger.error("Error storing image to texture: "+f.message),e.deleteTexture(d),!1}e.deleteTexture(d)}else{e=d.getContext("2d");try{e.drawImage(c,0,0),e.getImageData(0,0,1,1)}catch(h){return h.code===b.DOMException.SECURITY_ERR?
p.logger.log("Unable to access cross-domain image"):p.logger.error("Error drawing image to canvas: "+h.message),!1}}return!0},hslToRgb:e,colors:R,setTimeoutZero:g,ShaderProgram:r,FrameBuffer:n,requestAnimationFrame:ta,shader:{makeNoise:"float makeNoise(float u, float v, float timer) {\n\tfloat x = u * v * mod(timer * 1000.0, 100.0);\n\tx = mod(x, 13.0) * mod(x, 127.0);\n\tfloat dx = mod(x, 0.01);\n\treturn clamp(0.1 + dx * 100.0, 0.0, 1.0);\n}\n",random:"#ifndef RANDOM\n#define RANDOM\nfloat random(vec2 n) {\n\treturn 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453);\n}\n#endif\n"}};
p.source("video",function(a,c,d){function e(){a.removeEventListener("loadedmetadata",e,!0);if(!r)if(a.videoWidth){if(g.width!==a.videoWidth||g.height!==a.videoHeight)g.width=a.videoWidth,g.height=a.videoHeight,g.resize();m&&g.setReady()}else m=!0,setTimeout(e,50)}function f(){l=!0}function h(){l=!1;g.setDirty()}var g=this,k,n,r=!1,m=!1,l=!1,z=0;if(a instanceof b.HTMLVideoElement)return a.readyState?e():(m=!0,a.addEventListener("loadedmetadata",e,!0)),a.addEventListener("seeking",f,!1),a.addEventListener("seeked",
h,!1),{deferTexture:m,source:a,render:function ia(c){var d,e;z=a.currentTime;if(!a.videoHeight||!a.videoWidth)return!1;F?(n||(n=v.createElement("canvas").getContext("2d"),k=n.canvas,k.width=g.width,k.height=g.height),d=k,n.drawImage(a,0,0,g.width,g.height)):d=a;c.bindTexture(c.TEXTURE_2D,g.texture);c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,g.flip);c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);try{c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,d);if(void 0===F){e=c.getError();if(e===c.INVALID_VALUE)return F=
!0,ia(c);F=!1}return!0}catch(f){f.code===b.DOMException.SECURITY_ERR?(g.allowRefresh=!1,p.logger.error("Unable to access cross-domain image")):p.logger.error("Error rendering video source",f)}return!1},checkDirty:function(){return!l&&a.currentTime!==z},compare:function(a){return g.source===a},destroy:function(){r=!0;a.removeEventListener("seeking",f,!1);a.removeEventListener("seeked",h,!1);a.removeEventListener("loadedmetadata",e,!0)}}},{title:"Video"});p.transform("2d",function(a){function b(){function a(b,
c){l[12]=l[0]*b+l[4]*c+l[12];l[13]=l[1]*b+l[5]*c+l[13];l[14]=l[2]*b+l[6]*c+l[14];l[15]=l[3]*b+l[7]*c+l[15]}var l=c.matrix,v,z,t,x,G,w,A,B,u,s;k||p||n||r||m||1!==h||1!==g?(da.identity(l),a(k+e,p+f),r&&(l[4]=r/c.width),m&&(l[1]=m/c.height),n&&(t=l[0],x=l[1],G=l[2],w=l[3],A=l[4],B=l[5],u=l[6],s=l[7],v=-(d?n*Math.PI/180:n),z=Math.sin(v),v=Math.cos(v),l[0]=t*v+A*z,l[1]=x*v+B*z,l[2]=G*v+u*z,l[3]=w*v+s*z,l[4]=A*v-t*z,l[5]=B*v-x*z,l[6]=u*v-G*z,l[7]=s*v-w*z),1!==h&&(l[0]*=h,l[1]*=h,l[2]*=h,l[3]*=h),1!==g&&
(l[4]*=g,l[5]*=g,l[6]*=g,l[7]*=g),a(-e,-f),c.transformed=!0):c.transformed=!1}var c=this,d=!(a&&a.radians),e=0,f=0,h=1,g=1,k=0,p=0,n=0,r=0,m=0;return{inputs:{reset:{method:function(){f=e=0;g=h=1;m=r=n=p=k=0;return c.transformed?(c.transformed=!1,!0):!1}},translate:{method:function(a,c){isNaN(a)&&(a=k);isNaN(c)&&(c=p);if(a===k&&c===p)return!1;k=a;p=c;b();return!0},type:["number","number"]},translateX:{get:function(){return k},set:function(a){if(a===k)return!1;k=a;b();return!0},type:"number"},translateY:{get:function(){return p},
set:function(a){if(a===p)return!1;p=a;b();return!0},type:"number"},rotation:{get:function(){return n},set:function(a){if(a===n)return!1;n=parseFloat(a);b();return!0},type:"number"},center:{method:function(a,c){isNaN(a)&&(a=e);isNaN(c)&&(c=f);if(a===e&&c===f)return!1;e=a;f=c;b();return!0},type:["number","number"]},centerX:{get:function(){return e},set:function(a){if(a===e)return!1;e=a;b();return!0},type:"number"},centerY:{get:function(){return f},set:function(a){if(a===f)return!1;f=a;b();return!0},
type:"number"},skew:{method:function(a,c){isNaN(a)&&(a=r);isNaN(c)&&(c=m);if(a===r&&c===m)return!1;r=a;m=c;b();return!0},type:["number","number"]},skewX:{get:function(){return r},set:function(a){if(a===r)return!1;r=a;b();return!0},type:"number"},skewY:{get:function(){return m},set:function(a){if(a===m)return!1;m=a;b();return!0},type:"number"},scale:{method:function(a,c){var d,e;d=isNaN(a)?h:a;if(isNaN(c)){if(isNaN(a))return!1;e=d}else e=c;if(d===h&&e===g)return!1;h=d;g=e;b();return!0},type:["number",
"number"]},scaleX:{get:function(){return h},set:function(a){if(a===h)return!1;h=a;b();return!0},type:"number"},scaleY:{get:function(){return g},set:function(a){if(a===g)return!1;g=a;b();return!0},type:"number"}}}},{title:"2D Transform",description:"Translate, Rotate, Scale, Skew"});p.transform("flip",function(){function a(){var d=b.matrix;c?(d[0]=-1,d[5]=1):(d[0]=1,d[5]=-1)}var b=this,c=!0;da.identity(b.matrix);a();b.transformDirty=!0;b.transformed=!0;return{inputs:{direction:{get:function(){return c?
"horizontal":"vertical"},set:function(b){b="vertical"===b?!1:!0;if(b===c)return!1;c=b;a();return!0},type:"string"}}}},{title:"Flip",description:"Flip Horizontal/Vertical"});p.transform("reformat",function(){function a(){var b=d.matrix,c=e||d.width,g=f||d.height,k=d.source,p=k&&k.width||1,k=k&&k.height||1,n,r;"distort"===h||c===p&&g===k?d.transformed=!1:(n=p/k,r=c/g,"none"===h?(c=p/c,g=k/g):"width"===h||"contain"===h&&r<=n?(c=1,g=r/n):"height"===h||"contain"===h&&r>n?(c=n/r,g=1):r>n?(c=1,g=r/n):(c=
n/r,g=1),1===c&&1===g?d.transformed=!1:(da.identity(b),1!==c&&(b[0]*=c,b[1]*=c,b[2]*=c,b[3]*=c),1!==g&&(b[4]*=g,b[5]*=g,b[6]*=g,b[7]*=g),d.transformed=!0))}function b(){return e||d.source&&d.source.width||1}function c(){return f||d.source&&d.source.height||1}var d=this,e,f,h="contain";this.resize=function(){var d=b(),e=c();if(this.width!==d||this.height!==e)for(this.width=d,this.height=e,this.uniforms&&this.uniforms.resolution&&(this.uniforms.resolution[0]=d,this.uniforms.resolution[1]=e),this.frameBuffer&&
this.frameBuffer.resize&&this.frameBuffer.resize(d,e),d=0;d<this.targets.length;d++)this.targets[d].resize();this.setTransformDirty();a()};return{inputs:{width:{get:b,set:function(a){a=Math.floor(a);if(a===e)return!1;e=a;this.resize();return!1},type:"number"},height:{get:c,set:function(a){a=Math.floor(a);if(a===f)return!1;f=a;this.resize();return!1},type:"number"},mode:{get:function(){return h},set:function(b){if(b===h)return!1;h=b;a();return!0},type:"enum",options:"cover contain distort width height none".split(" ")}}}},
{title:"Reformat",description:"Change output dimensions"});Y="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nvarying vec2 vTexCoord;\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.w = screenPosition.w;\n\tvTexCoord = texCoord;\n}\n";
ka="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nvoid main(void) {\n\t\tgl_FragColor = texture2D(source, vTexCoord);\n}";p.util.shader.noiseHelpers="#ifndef NOISE_HELPERS\n#define NOISE_HELPERS\nvec2 mod289(vec2 x) {\n\treturn x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec3 mod289(vec3 x) {\n\treturn x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec4 mod289(vec4 x) {\n\treturn x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec3 permute(vec3 x) {\n\treturn mod289(((x*34.0)+1.0)*x);\n}\nvec4 permute(vec4 x) {\n\treturn mod289(((x*34.0)+1.0)*x);\n}\nvec4 taylorInvSqrt(vec4 r) {\n\treturn 1.79284291400159 - 0.85373472095314 * r;\n}\nfloat taylorInvSqrt(float r) {\n\treturn 1.79284291400159 - 0.85373472095314 * r;\n}\n#endif\n";
p.util.shader.snoise2d="#ifndef NOISE2D\n#define NOISE2D\nfloat snoise(vec2 v) {\n\tconst vec4 C = vec4(0.211324865405187, // (3.0-sqrt(3.0))/6.0\n\t\t0.366025403784439, // 0.5*(sqrt(3.0)-1.0)\n\t\t-0.577350269189626, // -1.0 + 2.0 * C.x\n\t\t0.024390243902439); // 1.0 / 41.0\n\tvec2 i = floor(v + dot(v, C.yy));\n\tvec2 x0 = v - i + dot(i, C.xx);\n\tvec2 i1;\n\t//i1.x = step(x0.y, x0.x); // x0.x > x0.y ? 1.0 : 0.0\n\t//i1.y = 1.0 - i1.x;\n\ti1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n\t// x0 = x0 - 0.0 + 0.0 * C.xx ;\n\t// x1 = x0 - i1 + 1.0 * C.xx ;\n\t// x2 = x0 - 1.0 + 2.0 * C.xx ;\n\tvec4 x12 = x0.xyxy + C.xxzz;\n\tx12.xy -= i1;\n\ti = mod289(i); // Avoid truncation effects in permutation\n\tvec3 p = permute(permute(i.y + vec3(0.0, i1.y, 1.0)) + i.x + vec3(0.0, i1.x, 1.0));\n\tvec3 m = max(0.5 - vec3(dot(x0, x0), dot(x12.xy, x12.xy), dot(x12.zw, x12.zw)), 0.0);\n\tm = m*m ;\n\tm = m*m ;\n\tvec3 x = 2.0 * fract(p * C.www) - 1.0;\n\tvec3 h = abs(x) - 0.5;\n\tvec3 ox = floor(x + 0.5);\n\tvec3 a0 = x - ox;\n\tm *= 1.79284291400159 - 0.85373472095314 * (a0*a0 + h*h);\n\tvec3 g;\n\tg.x = a0.x * x0.x + h.x * x0.y;\n\tg.yz = a0.yz * x12.xz + h.yz * x12.yw;\n\treturn 130.0 * dot(m, g);\n}\n#endif\n";
p.util.shader.snoise3d="#ifndef NOISE3D\n#define NOISE3D\nfloat snoise(vec3 v) {\n\tconst vec2 C = vec2(1.0/6.0, 1.0/3.0) ;\n\tconst vec4 D = vec4(0.0, 0.5, 1.0, 2.0);\n\tvec3 i = floor(v + dot(v, C.yyy));\n\tvec3 x0 = v - i + dot(i, C.xxx) ;\n\tvec3 g = step(x0.yzx, x0.xyz);\n\tvec3 l = 1.0 - g;\n\tvec3 i1 = min(g.xyz, l.zxy);\n\tvec3 i2 = max(g.xyz, l.zxy);\n\t// x0 = x0 - 0.0 + 0.0 * C.xxx;\n\t// x1 = x0 - i1 + 1.0 * C.xxx;\n\t// x2 = x0 - i2 + 2.0 * C.xxx;\n\t// x3 = x0 - 1.0 + 3.0 * C.xxx;\n\tvec3 x1 = x0 - i1 + C.xxx;\n\tvec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n\tvec3 x3 = x0 - D.yyy; // -1.0+3.0*C.x = -0.5 = -D.y\n\ti = mod289(i);\n\tvec4 p = permute(permute(permute(\n\t\t\t\t\t\ti.z + vec4(0.0, i1.z, i2.z, 1.0))\n\t\t\t\t\t\t+ i.y + vec4(0.0, i1.y, i2.y, 1.0))\n\t\t\t\t\t\t+ i.x + vec4(0.0, i1.x, i2.x, 1.0));\n\tfloat n_ = 0.142857142857; // 1.0/7.0\n\tvec3 ns = n_ * D.wyz - D.xzx;\n\tvec4 j = p - 49.0 * floor(p * ns.z * ns.z); // mod(p, 7 * 7)\n\tvec4 x_ = floor(j * ns.z);\n\tvec4 y_ = floor(j - 7.0 * x_); // mod(j, N)\n\tvec4 x = x_ * ns.x + ns.yyyy;\n\tvec4 y = y_ * ns.x + ns.yyyy;\n\tvec4 h = 1.0 - abs(x) - abs(y);\n\tvec4 b0 = vec4(x.xy, y.xy);\n\tvec4 b1 = vec4(x.zw, y.zw);\n\t//vec4 s0 = vec4(lessThan(b0, 0.0)) * 2.0 - 1.0;\n\t//vec4 s1 = vec4(lessThan(b1, 0.0)) * 2.0 - 1.0;\n\tvec4 s0 = floor(b0) * 2.0 + 1.0;\n\tvec4 s1 = floor(b1) * 2.0 + 1.0;\n\tvec4 sh = -step(h, vec4(0.0));\n\tvec4 a0 = b0.xzyw + s0.xzyw * sh.xxyy ;\n\tvec4 a1 = b1.xzyw + s1.xzyw * sh.zzww ;\n\tvec3 p0 = vec3(a0.xy, h.x);\n\tvec3 p1 = vec3(a0.zw, h.y);\n\tvec3 p2 = vec3(a1.xy, h.z);\n\tvec3 p3 = vec3(a1.zw, h.w);\n\tvec4 norm = taylorInvSqrt(vec4(dot(p0, p0), dot(p1, p1), dot(p2, p2), dot(p3, p3)));\n\tp0 *= norm.x;\n\tp1 *= norm.y;\n\tp2 *= norm.z;\n\tp3 *= norm.w;\n\tvec4 m = max(0.6 - vec4(dot(x0, x0), dot(x1, x1), dot(x2, x2), dot(x3, x3)), 0.0);\n\tm = m * m;\n\treturn 42.0 * dot(m*m, vec4(dot(p0, x0), dot(p1, x1), dot(p2, x2), dot(p3, x3)));\n}\n#endif\n";
p.util.shader.snoise4d="#ifndef NOISE4D\n#define NOISE4D\nvec4 grad4(float j, vec4 ip)\n\t{\n\tconst vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\n\tvec4 p, s;\n\n\tp.xyz = floor(fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\n\tp.w = 1.5 - dot(abs(p.xyz), ones.xyz);\n\ts = vec4(lessThan(p, vec4(0.0)));\n\tp.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www;\n\n\treturn p;\n\t}\n\n#define F4 0.309016994374947451\n\nfloat snoise(vec4 v)\n\t{\n\tconst vec4 C = vec4(0.138196601125011, // (5 - sqrt(5))/20 G4\n\t\t\t\t\t\t0.276393202250021, // 2 * G4\n\t\t\t\t\t\t0.414589803375032, // 3 * G4\n\t\t\t\t\t\t-0.447213595499958); // -1 + 4 * G4\n\n\tvec4 i = floor(v + dot(v, vec4(F4)));\n\tvec4 x0 = v - i + dot(i, C.xxxx);\n\n\n\tvec4 i0;\n\tvec3 isX = step(x0.yzw, x0.xxx);\n\tvec3 isYZ = step(x0.zww, x0.yyz);\n\ti0.x = isX.x + isX.y + isX.z;\n\ti0.yzw = 1.0 - isX;\n\ti0.y += isYZ.x + isYZ.y;\n\ti0.zw += 1.0 - isYZ.xy;\n\ti0.z += isYZ.z;\n\ti0.w += 1.0 - isYZ.z;\n\n\tvec4 i3 = clamp(i0, 0.0, 1.0);\n\tvec4 i2 = clamp(i0 - 1.0, 0.0, 1.0);\n\tvec4 i1 = clamp(i0 - 2.0, 0.0, 1.0);\n\n\tvec4 x1 = x0 - i1 + C.xxxx;\n\tvec4 x2 = x0 - i2 + C.yyyy;\n\tvec4 x3 = x0 - i3 + C.zzzz;\n\tvec4 x4 = x0 + C.wwww;\n\n\ti = mod289(i);\n\tfloat j0 = permute(permute(permute(permute(i.w) + i.z) + i.y) + i.x);\n\tvec4 j1 = permute(permute(permute(permute (\n\t\t\t\t\ti.w + vec4(i1.w, i2.w, i3.w, 1.0))\n\t\t\t\t\t+ i.z + vec4(i1.z, i2.z, i3.z, 1.0))\n\t\t\t\t\t+ i.y + vec4(i1.y, i2.y, i3.y, 1.0))\n\t\t\t\t\t+ i.x + vec4(i1.x, i2.x, i3.x, 1.0));\n\n\tvec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\n\n\tvec4 p0 = grad4(j0, ip);\n\tvec4 p1 = grad4(j1.x, ip);\n\tvec4 p2 = grad4(j1.y, ip);\n\tvec4 p3 = grad4(j1.z, ip);\n\tvec4 p4 = grad4(j1.w, ip);\n\n\tvec4 norm = taylorInvSqrt(vec4(dot(p0, p0), dot(p1, p1), dot(p2, p2), dot(p3, p3)));\n\tp0 *= norm.x;\n\tp1 *= norm.y;\n\tp2 *= norm.z;\n\tp3 *= norm.w;\n\tp4 *= taylorInvSqrt(dot(p4, p4));\n\n\tvec3 m0 = max(0.6 - vec3(dot(x0, x0), dot(x1, x1), dot(x2, x2)), 0.0);\n\tvec2 m1 = max(0.6 - vec2(dot(x3, x3), dot(x4, x4)), 0.0);\n\tm0 = m0 * m0;\n\tm1 = m1 * m1;\n\treturn 49.0 * (dot(m0*m0, vec3(dot(p0, x0), dot(p1, x1), dot(p2, x2)))\n\t\t\t\t\t\t\t+ dot(m1*m1, vec2(dot(p3, x3), dot(p4, x4)))) ;\n}\n#endif\n";
return p});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):a(b.Seriously)})(this,function(b){b.source("array",function(a,b,d){var e,f,k;if(b&&(Array.isArray(a)||a&&a.BYTES_PER_ELEMENT&&"length"in a))if(e=b.width,f=b.height,e&&f)if(e*f*4!==a.length){if(d)throw"Array length must be height x width x 4.";}else return this.width=e,this.height=f,void 0===b.flip&&(this.flip=!1),a instanceof Uint8Array||(k=new Uint8Array(a.length)),{render:function(b){var c;
if(this.dirty){if(k)for(c=0;c<k.length;c++)k[c]=a[c];b.bindTexture(b.TEXTURE_2D,this.texture);b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,this.flip);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,this.width,this.height,0,b.RGBA,b.UNSIGNED_BYTE,k||a);this.lastRenderTime=Date.now()/1E3;return!0}}};else if(d)throw"Height and width must be provided with an Array";},{title:"Array",description:"Array or Uint8Array"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):a(b.Seriously)})(this,function(b){var a=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,c=window.URL||window.webkitURL||window.mozURL||window.msURL;b.source("camera",function(d,e,f){function k(){m&&(m.pause(),m.src="",m.load());r&&r.stop&&r.stop();r=null}function g(){n||(m.videoWidth?(l.width=m.videoWidth,l.height=m.videoHeight,l.setReady()):
setTimeout(g,50))}var l=this,m,h,n=!1,r,p=0;if(f){if(!a)throw"Camera source type unavailable. Browser does not support getUserMedia";e={};if(d&&"object"===typeof d)for(h in d)d.hasOwnProperty(h)&&(e[h]=d[h]);e.video||(e.video=!0);m=document.createElement("video");a.call(navigator,e,function(a){r=a;n?k():(m.mozCaptureStream?m.mozSrcObject=r:m.src=c&&c.createObjectURL(r)||r,m.readyState?g():m.addEventListener("loadedmetadata",g,!1),m.play())},function(a){console.log("Unable to access video camera",
a)});return{deferTexture:!0,source:m,render:function(a){p=m.currentTime;a.bindTexture(a.TEXTURE_2D,this.texture);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,this.flip);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);try{return a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,m),!0}catch(c){b.logger.error("Error rendering camera video source",c)}return!1},checkDirty:function(){return m.currentTime!==p},destroy:function(){n=!0;k()}}}},{compatible:function(){return!!a},title:"Camera"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):a(b.Seriously)})(this,function(b){function a(a,b,c,k,g){a=new Uint8Array(a,b,g);c=new Uint8Array(c,k,g);a.set(c)}var c=/GDepth:Data="([\S]*)"/;b.source("depth",function(d,e,f){function k(){r||(l.width=n.naturalWidth,l.height=n.naturalHeight,l.setReady())}function g(d){var e=new Uint8Array(d),f=[],h="",g,r,m,l;if(255==e[0]&&216==e[1]){for(g=0;g<e.byteLength;g++)255===e[g]&&
225===e[g+1]&&(f.push(g),g++);f.push(e.byteLength);for(g=0;g<f.length-1;g++)255===e[f[g]]&&225===e[f[g]+1]&&(m=256*e[f[g]+2]+e[f[g]+3],l=79,l>m&&(l=0),m+=2,r=new ArrayBuffer(m-l),a(r,0,d,f[g]+l,m-l),r=String.fromCharCode.apply(null,new Uint8Array(r)),h+=r);d=c.exec(h);if(null===d)return b.logger.error("JPEG file does not include depth image."),!1;n||(n=document.createElement("img"));n.src="data:image/png;base64,"+d[1];n.complete&&n.naturalWidth?k():(n.addEventListener("load",k,!0),n.addEventListener("error",
function(a){b.logger.error("Error loading depth image.",a)},!0))}else return b.logger.error("Unable to load depth image. File is not a JPEG."),!1}var l=this,m,h,n,r=!1;if(f)return m="string"===typeof d?document.querySelector(d):d,m instanceof window.ArrayBuffer?g(d):e&&e.url?h=e.url:m&&m instanceof window.HTMLImageElement&&("IMG"===m.tagName||f)&&(h=m.src),h||"string"!==typeof d||(h=d),h&&(n=document.createElement("img"),d=new XMLHttpRequest,d.open("GET",h,!0),d.responseType="arraybuffer",d.onload=
function(){g(this.response)},d.send()),n?{deferTexture:!0,source:n,render:Object.getPrototypeOf(this).renderImageCanvas,destroy:function(){r=!0}}:!1},{title:"Depth Image"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):a(b.Seriously)})(this,function(b){b.source("imagedata",function(a){if(a instanceof Object&&a.data&&a.width&&a.height&&a.width*a.height*4===a.data.length)return this.width=a.width,this.height=a.height,{render:function(b){if(this.dirty)return b.bindTexture(b.TEXTURE_2D,this.texture),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,this.flip),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,
a),this.lastRenderTime=Date.now()/1E3,!0}}},{title:"ImageData",description:"2D Canvas ImageData"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously","three"],a):"object"===typeof exports?a(require("seriously"),require("three")):a(b.Seriously,b.THREE)})(this,function(b,a){b.source("three",function(b,d,e){function f(){var a=b.__webglTexture,d=k.gl;if(a&&d&&!k.initialized){if(!d.isTexture(a))throw Error("Failed to create Three.js source. WebGL texture is from a different context");k.texture=a;k.initialized=!0;k.allowRefresh=!0;k.setReady()}}var k=this,g=this.setDirty;if(a&&
b instanceof a.WebGLRenderTarget)return d=b.width,e=b.height,this.width=d,this.height=e,f(),this.initialized||(this.setDirty=function(){f();this.initialized&&(this.setDirty=g);g.call(this)}),{deferTexture:!this.initialized,render:function(a){this.lastRenderTime=Date.now()/1E3;this.dirty=!1;this.emit("render")}}},{title:"Three.js WebGLRenderTarget Source"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously","three"],a):"object"===typeof exports?a(require("seriously"),require("three")):a(b.Seriously,b.THREE)})(this,function(b,a){var c=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),d=b.util.mat4;b.target("three",function(b,f){function k(){m&&l&&!g.initialized&&(g.initialized=!0,g.allowRefresh=!0,g.setReady())}var g=this,l,m;if(a&&b instanceof a.WebGLRenderTarget){if(g.gl)l=g.gl;else if(f)if(f.gl)l=f.gl;else if(f.canvas&&f.canvas.getContext){try{l=
f.canvas.getContext("webgl")}catch(h){}if(!l)try{l=f.canvas.getContext("experimental-webgl")}catch(n){}}if(!l)throw Error("Failed to create Three.js target. Missing WebGL context");this.ready=!1;this.width=b.width;this.height=b.height;if(b.__webglFramebuffer){if(!l.isFramebuffer(b.__webglFramebuffer))throw Error("Failed to create Three.js target. WebGL texture is from a different context");m=b.__webglFramebuffer;k()}else Object.defineProperty(b,"__webglFramebuffer",{configurable:!0,enumerable:!0,
get:function(){return m},set:function(a){a&&(m=a,k())}});this.setReady=function(){m&&this.source&&this.source.ready&&!this.ready&&(this.emit("ready"),this.ready=!0)};this.target=b;return{gl:l,resize:function(){this.width=b.width;this.height=b.height},render:function(a,f,h){var g,k,n;if(l&&this.dirty&&this.ready&&this.source&&(this.source.render(),this.uniforms.source=this.source.texture,this.source.width===this.width&&this.source.height===this.height?this.uniforms.transform=this.source.cumulativeMatrix||
c:this.transformDirty&&(g=this.transform,d.copy(g,this.source.cumulativeMatrix||c),k=this.source.width/this.width,n=this.source.height/this.height,g[0]*=k,g[1]*=k,g[2]*=k,g[3]*=k,g[4]*=n,g[5]*=n,g[6]*=n,g[7]*=n,this.uniforms.transform=g,this.transformDirty=!1),a(f,h,this.uniforms,m,this),this.emit("render"),this.dirty=!1,b.onUpdate))b.onUpdate()},destroy:function(){Object.defineProperty(b,"__webglFramebuffer",{configurable:!0,enumerable:!0,value:m})}}}},{title:"THREE.js WebGLRenderTarget Target"})});(function(b,a){"function"===typeof define&&define.amd?define([],a):b.MediaLoader=a()})(this,function(){var b=/^[a-z\-]+/i,a={video:"video",audio:"audio",image:"img"};return function(c,d){function e(a){a.preventDefault();return!1}function f(e){var f,g;n&&0>n.indexOf(e.type)?d.error&&d.error(e.type):(g=(g=b.exec(e.type))&&g[0],"file"===h?c(e):"contents"!==h&&a[g]?(g=document.createElement(a[g]),g.src=URL.createObjectURL(e),c(g,e)):(f=new FileReader,f.onload=function(){c(f.result,e)},f.readAsArrayBuffer(e)))}
function k(a){a.preventDefault();a.dataTransfer.files.length&&f(a.dataTransfer.files[0]);return!1}function g(a){a.target.files.length&&f(a.target.files[0])}var l,m,h,n;"object"===typeof c&&(d=c,c=d.callback);if(!c)throw Error("MediaLoader does not work without a callback function");d||(d={});n=d.types||"video/webm video/mp4 video/ogg audio/ogg audio/mp3 image/jpeg image/png".split(" ");h=d.format;if(l=d.target?"string"===typeof l?document.querySelector(d.target):d.target:document.body)l.addEventListener("dragover",
e,!1),l.addEventListener("drop",k,!0);(m=d.input)&&"string"===typeof m&&(m=document.querySelector(m));m&&m.addEventListener("change",g,!1);this.destroy=function(){l&&(l.removeEventListener("dragover",e,!1),l.removeEventListener("drop",k,!0));m&&m.removeEventListener("change",g,!1)}}});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){function a(a,b,c){function d(a){var e={base:(b||"base")+"."+a,blend:(c||"blend")+"."+a};return function(a){return e[a]||a}}return"vec3("+a.replace(/blend|base/g,d("r"))+", "+a.replace(/blend|base/g,d("g"))+", "+a.replace(/blend|base/g,d("b"))+")"}var c={normal:"blend",lighten:"max(blend, base)",
darken:"min(blend, base)",multiply:"(base * blend)",average:"(base + blend / TWO)",add:"min(base + blend, ONE)",subtract:"max(base - blend, ZERO)",divide:"base / blend",difference:"abs(base - blend)",negation:"(ONE - abs(ONE - base - blend))",exclusion:"(base + blend - TWO * base * blend)",screen:"(ONE - ((ONE - base) * (ONE - blend)))",lineardodge:"min(base + blend, ONE)",phoenix:"(min(base, blend) - max(base, blend) + ONE)",linearburn:"max(base + blend - ONE, ZERO)",hue:"BlendHue(base, blend)",
saturation:"BlendSaturation(base, blend)",color:"BlendColor(base, blend)",luminosity:"BlendLuminosity(base, blend)",darkercolor:"BlendDarkerColor(base, blend)",lightercolor:"BlendLighterColor(base, blend)",overlay:a("base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend))"),softlight:a("blend < 0.5 ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend))"),hardlight:a("base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend))",
"blend","base"),colordodge:a("blend == 1.0 ? blend : min(base / (1.0 - blend), 1.0)"),colorburn:a("blend == 0.0 ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0)"),linearlight:a("BlendLinearLightf(base, blend)"),vividlight:a("BlendVividLightf(base, blend)"),pinlight:a("BlendPinLightf(base, blend)"),hardmix:a("BlendHardMixf(base, blend)"),reflect:a("BlendReflectf(base, blend)"),glow:a("BlendReflectf(blend, base)")},d={normal:!0};b.plugin("accumulator",function(){var a={clear:!1},f,k=0;return{initialize:function(a,
c){a();f=[this.frameBuffer,new b.util.FrameBuffer(c,this.width,this.height)]},shader:function(a,b){var e=a.blendMode||"normal",e=e.toLowerCase();b.fragment=["precision mediump float;\nconst vec3 ZERO = vec3(0.0);\nconst vec3 ONE = vec3(1.0);\nconst vec3 HALF = vec3(0.5);\nconst vec3 TWO = vec3(2.0);\n#define BlendAddf(base, blend)\t\t\tmin(base + blend, 1.0)\n#define BlendLinearDodgef(base, blend)\tBlendAddf(base, blend)\n#define BlendLinearBurnf(base, blend)\tmax(base + blend - 1.0, 0.0)\n#define BlendLightenf(base, blend)\t\tmax(blend, base)\n#define BlendDarkenf(base, blend)\t\tmin(blend, base)\n#define BlendLinearLightf(base, blend)\t(blend < 0.5 ? BlendLinearBurnf(base, (2.0 * blend)) : BlendLinearDodgef(base, (2.0 * (blend - 0.5))))\n#define BlendScreenf(base, blend)\t\t(1.0 - ((1.0 - base) * (1.0 - blend)))\n#define BlendOverlayf(base, blend)\t\t(base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))\n#define BlendSoftLightf(base, blend)\t((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)))\n#define BlendColorDodgef(base, blend)\t((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0))\n#define BlendColorBurnf(base, blend)\t((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0))\n#define BlendVividLightf(base, blend)\t((blend < 0.5) ? BlendColorBurnf(base, (2.0 * blend)) : BlendColorDodgef(base, (2.0 * (blend - 0.5))))\n#define BlendPinLightf(base, blend)\t((blend < 0.5) ? BlendDarkenf(base, (2.0 * blend)) : BlendLightenf(base, (2.0 *(blend - 0.5))))\n#define BlendHardMixf(base, blend)\t\t((BlendVividLightf(base, blend) < 0.5) ? 0.0 : 1.0)\n#define BlendReflectf(base, blend)\t\t((blend == 1.0) ? blend : min(base * base / (1.0 - blend), 1.0))\nvec3 RGBToHSL(vec3 color) {\n\tvec3 hsl;\n\tfloat fmin = min(min(color.r, color.g), color.b);\n\tfloat fmax = max(max(color.r, color.g), color.b);\n\tfloat delta = fmax - fmin;\n\thsl.z = (fmax + fmin) / 2.0;\n\tif (delta == 0.0) {\n\t\thsl.x = 0.0;\n\t\thsl.y = 0.0;\n\t} else {\n\t\tif (hsl.z < 0.5)\n\t\t\thsl.y = delta / (fmax + fmin);\n\t\telse\n\t\t\thsl.y = delta / (2.0 - fmax - fmin);\n\t\tfloat deltaR = (((fmax - color.r) / 6.0) + (delta / 2.0)) / delta;\n\t\tfloat deltaG = (((fmax - color.g) / 6.0) + (delta / 2.0)) / delta;\n\t\tfloat deltaB = (((fmax - color.b) / 6.0) + (delta / 2.0)) / delta;\n\t\tif (color.r == fmax )\n\t\t\thsl.x = deltaB - deltaG;\n\t\telse if (color.g == fmax)\n\t\t\thsl.x = (1.0 / 3.0) + deltaR - deltaB;\n\t\telse if (color.b == fmax)\n\t\t\thsl.x = (2.0 / 3.0) + deltaG - deltaR;\n\t\tif (hsl.x < 0.0)\n\t\t\thsl.x += 1.0;\n\t\telse if (hsl.x > 1.0)\n\t\t\thsl.x -= 1.0;\n\t}\n\treturn hsl;\n}\nfloat HueToRGB(float f1, float f2, float hue) {\n\tif (hue < 0.0)\n\t\thue += 1.0;\n\telse if (hue > 1.0)\n\t\thue -= 1.0;\n\tfloat res;\n\tif ((6.0 * hue) < 1.0)\n\t\tres = f1 + (f2 - f1) * 6.0 * hue;\n\telse if ((2.0 * hue) < 1.0)\n\t\tres = f2;\n\telse if ((3.0 * hue) < 2.0)\n\t\tres = f1 + (f2 - f1) * ((2.0 / 3.0) - hue) * 6.0;\n\telse\n\t\tres = f1;\n\treturn res;\n}\nvec3 HSLToRGB(vec3 hsl) {\n\tvec3 rgb;\n\tif (hsl.y == 0.0)\n\t\trgb = vec3(hsl.z);\n\telse {\n\t\tfloat f2;\n\t\tif (hsl.z < 0.5)\n\t\t\tf2 = hsl.z * (1.0 + hsl.y);\n\t\telse\n\t\t\tf2 = (hsl.z + hsl.y) - (hsl.y * hsl.z);\n\t\tfloat f1 = 2.0 * hsl.z - f2;\n\t\trgb.r = HueToRGB(f1, f2, hsl.x + (1.0/3.0));\n\t\trgb.g = HueToRGB(f1, f2, hsl.x);\n\t\trgb.b= HueToRGB(f1, f2, hsl.x - (1.0/3.0));\n\t}\n\treturn rgb;\n}\nvec3 BlendHue(vec3 base, vec3 blend) {\n\tvec3 baseHSL = RGBToHSL(base);\n\treturn HSLToRGB(vec3(RGBToHSL(blend).r, baseHSL.g, baseHSL.b));\n}\nvec3 BlendSaturation(vec3 base, vec3 blend) {\n\tvec3 baseHSL = RGBToHSL(base);\n\treturn HSLToRGB(vec3(baseHSL.r, RGBToHSL(blend).g, baseHSL.b));\n}\nvec3 BlendColor(vec3 base, vec3 blend) {\n\tvec3 blendHSL = RGBToHSL(blend);\n\treturn HSLToRGB(vec3(blendHSL.r, blendHSL.g, RGBToHSL(base).b));\n}\nvec3 BlendLuminosity(vec3 base, vec3 blend) {\n\tvec3 baseHSL = RGBToHSL(base);\n\treturn HSLToRGB(vec3(baseHSL.r, baseHSL.g, RGBToHSL(blend).b));\n}\nvec3 BlendLighterColor(vec3 base, vec3 blend) {\n\tfloat baseTotal = base.r + base.g + base.b;\n\tfloat blendTotal = blend.r + blend.g + blend.b;\n\treturn blendTotal > baseTotal ? blend : base;\n}\nvec3 BlendDarkerColor(vec3 base, vec3 blend) {\n\tfloat baseTotal = base.r + base.g + base.b;\n\tfloat blendTotal = blend.r + blend.g + blend.b;\n\treturn blendTotal < baseTotal ? blend : base;\n}",
"#define BlendFunction(base, blend) "+c[e],d[e]?"#define MIX_ALPHA":"","varying vec2 vTexCoord;\nuniform sampler2D source;\nuniform sampler2D previous;\nuniform float opacity;\nvec3 BlendOpacity(vec4 base, vec4 blend, float opacity) {\n\tvec3 blendedColor = BlendFunction(base.rgb, blend.rgb);\n\treturn mix(base.rgb, blendedColor, opacity * blend.a);\n}\nvoid main(void) {\n\tvec4 topPixel = texture2D(source, vTexCoord);\n\tvec4 bottomPixel = texture2D(previous, vTexCoord);\n\tif (topPixel.a == 0.0) {\n\t\tgl_FragColor = bottomPixel;\n\t} else {\n\t\tfloat alpha;\n#ifdef MIX_ALPHA\n\t\talpha = topPixel.a * opacity;\n\t\talpha = alpha + bottomPixel.a * (1.0 - alpha);\n#else\n\t\talpha = bottomPixel.a;\n#endif\n\t\tgl_FragColor = vec4(BlendOpacity(bottomPixel, topPixel, opacity), alpha);\n\t}\n}"].join("\n");
return b},resize:function(){f&&(f[0].resize(this.width,this.height),f[1].resize(this.width,this.height))},draw:function(b,c,d,h,n){this.uniforms.previous=this.frameBuffer.texture;k=(k+1)%2;this.frameBuffer=h=f[k];this.texture=h.texture;this.inputs.clear?n(this.baseShader,c,d,h.frameBuffer,null):n(b,c,d,h.frameBuffer,null,a)},destroy:function(){f&&(f[0].destroy(),f[1].destroy(),f.length=0)}}},{inPlace:!1,title:"Accumulator",description:"Draw on top of previous frame",inputs:{source:{type:"image",uniform:"source"},
clear:{type:"boolean",defaultValue:!1},opacity:{type:"number",uniform:"opacity",defaultValue:1,min:0,max:1},blendMode:{type:"enum",shaderDirty:!0,defaultValue:"normal",options:[["normal","Normal"],["lighten","Lighten"],["darken","Darken"],["multiply","Multiply"],["average","Average"],["add","Add"],["subtract","Subtract"],["divide","Divide"],["difference","Difference"],["negation","Negation"],["exclusion","Exclusion"],["screen","Screen"],["overlay","Overlay"],["softlight","Soft Light"],["hardlight",
"Hard Light"],["colordodge","Color Dodge"],["colorburn","Color Burn"],["lineardodge","Linear Dodge"],["linearburn","Linear Burn"],["linearlight","Linear Light"],["vividlight","Vivid Light"],["pinlight","Pin Light"],["hardmix","Hard Mix"],["reflect","Reflect"],["glow","Glow"],["phoenix","Phoenix"],["hue","Hue"],["saturation","Saturation"],["color","color"],["luminosity","Luminosity"],["darkercolor","Darker Color"],["lightercolor","Lighter Color"]]}}})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a,c;c=document.createElement("img");c.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAvAAAAAICAYAAACf+MsnAAAFY0lEQVR4Xu2Z644bOwyDN+//0NsOigEMQdRHyU6CFDnA+bHVWNaFojiTx8/Pz+/f/4/89/v7z9Xj8Tjib3XyTN9usFcMz8gt3h9zXf/O6nD/W1V7Vb9uXad+nHucZ9xenX7OqTHdSfmRXfmPsSn8xPMrllcfCkdVfHSe7Ned0/yp7jv2GPfqK+MCByc0zzvxKi5RPq8cuvE4+JrwpFM7N78K2yu+qb9kd3qV+ZjUx5n/+xnXP81ctW/UHQ5P3Gd360vxKf+n8dGpxXTeKu6h2ansFT6pvo5G2/FP99NsUf9d/xleInfetcj629m9cf9WOV5K+78R8ERGRLYO8VQiecd/1vwKEJV46JBJRzhRfXftVL/MTgM48UmL0l2OSmzs9kctAJfE4/1KkNFzbj8cjFHsJ/u460vhnPDfqddujJ27poLCWWBuHt0YKr/ki+yOKJnk5Z7pPLfLf4TZif+qvi7XuDWg+HbtNEe79ds9H7m1m2/3+YzLK5Hc9e/gYxdfNP+ZfdV9lT3usWn+9310/qiAdxa1O5gTEqVhoLudxVwVNPrvCqDp/ZX4d0Uk1Y7sbgyU4zooCk8nB3i9Y61V5wWpIjDlP+ZJsxPvmLxEOD2sntk5Pz1LBOb0L+sPfQGs6ksYpt7QAiHuUwtkgl+F3Qyf2YxTX53+Vdjfjc8VYIq7KT+abzof7ervZ8fX8d/Jyc3PmTcnRrrPEbyVTnD8T+Y38pH624mfNIr6muzO95S/sh1Gvog/XmW/a6N+scww43zgqLjcOX9cwFeESQK3Gpx32QggTlwk8Ei8OXfE4VMLeCLQiLBjfJM7VA069XefnZBGJz7Vr24dK3GwEoqLD7p/1+4IMWdRdxaMK9CmP4E62F7nm8S7s4B3BMCkBzQPVQ0IM06+2WLvzlDlI+NfF4d0ljiHuF/Zb/4m/4ojTgnA6f0qfiWA135P5l/NoFv/7txm+5ZyyOw0e1R/skd8ZKKwwnjXf9xLrkBV+2x3Pib9Vz3JOMaNL/KZ+oCkXhDUTLxEwLsC41OfI5DEYe9+mXfr0l2mJH5ISHTOUw2U8IjD5LyVUtxEmrvi4V5ejvijWNWicBbOyfsrYejkMMXmdIFEAZH19ASWnNyrPlBdKH+yU3y0gGjGKf4Mv51ft9zzKk83vul5qr9r7+CT9gHx2zvs0/yofpGX1AuC4svqhYJeJJydNZk/urcSxet91dfiUy94HX6oBHCHi5+F38svCeg1h+zZ6nyF5VUzVC8Q0X9LwE/IkMjmpJ3i27XvxuqQ0c4dp/JTfnb9T847AoNIW/nokIYrYKvnJvln/siPwtD0XAeTU+x0luEugWdLNeY4ecl260vxK8Efl3OnZi4uaZZIMBFeJ/hw6xrFvppvV1Q559d8MwwR50cskIBQ2KhE3y7/ZeddAUjxOr3diZ/8U3+I953z7uzR7Lj4rvjl9HxXvaHaOflSfSkf93y24xx94PpX89I5H2t9+fwK+KVzNOwdIeM+e905+ZqqRIj7pYHiU3FNFnBnkO+41EKige3cpX7GunwoARfjIwKrxNhEJFLfMrsbI+G/smfkojAa60vxPcNeCZCqhjSra6ydBaAWSFzaqnb01c4VEdVCWWPM7svstKDWuKrZpwUb7dVsOzPcxUeGdYdfdgV8Vr+Mv1R8Tn/iHcSNWR8jjjv9URzama9qbp0XlBP4y2Jw6u/E577AZTVz/BM/OfySzSjl79o73FRxaFdfuPG5/XE58PbXEvAT8UBn1HKuSIB8ThYwiZfJnd8z768Aib/3R/iN4J0VeMXcVwvynbl/735OBV6BKTfyT+e/T4/f7dP3uW8F3Aqs/PIHbWXeeeKjnSsAAAAASUVORK5CYII=";
a=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);b.plugin("ascii",function(){function d(){m=p.height;l=p.width;h=Math.ceil(l/8);n=Math.ceil(m/8);r.resolution=p.uniforms.resolution;r.transform=a;f&&f.resize(h,n)}var e,f,k,g,l,m,h,n,r={},p=this;return{initialize:function(p){function m(){g.bindTexture(g.TEXTURE_2D,k);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.NEAREST);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.NEAREST);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE);
g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE);g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!0);g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,c);g.bindTexture(g.TEXTURE_2D,null)}var l=this;p();this.texture=this.frameBuffer.texture;g=this.gl;k=g.createTexture();c.naturalWidth?m():c.addEventListener("load",function(){m();l.setDirty()});r.letters=k;g.bindTexture(g.TEXTURE_2D,this.texture||this.frameBuffer&&this.frameBuffer.texture);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,
g.NEAREST);g.bindTexture(g.TEXTURE_2D,null);d();f=new b.util.FrameBuffer(g,h,n);g.bindTexture(g.TEXTURE_2D,f.texture);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.NEAREST);this.uniforms.transform=a;e=this.baseShader},commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform sampler2D letters;\nuniform vec4 background;\nuniform vec2 resolution;\nconst vec3 lumcoeff = vec3(0.2125, 0.7154, 0.0721);\nconst vec2 fontSize = vec2(8.0, 8.0);\nvec4 lookup(float ascii) {\n\tvec2 pos = mod(vTexCoord * resolution, fontSize) / vec2(752.0, fontSize.x) + vec2(ascii, 0.0);\n\treturn texture2D(letters, pos);\n}\nvoid main(void) {\n\tvec4 sample = texture2D(source, vTexCoord);\n\tvec4 clamped = vec4(floor(sample.rgb * 8.0) / 8.0, sample.a);\n\tfloat luma = dot(sample.rgb,lumcoeff);\n\tfloat char = floor(luma * 94.0) / 94.0;\n\tgl_FragColor = mix(background, clamped, lookup(char).r);\n}";
return b},resize:d,draw:function(a,b,c,d,g){g(e,b,c,f.frameBuffer,!1,{width:h,height:n,blend:!1});r.source=f.texture;r.background=c.background;g(a,b,r,d)},destroy:function(){f&&f.destroy();g&&k&&g.deleteTexture(k)}}},{inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},background:{type:"color",uniform:"background",defaultValue:[0,0,0,1]}},description:"Display image as ascii text in 8-bit color.",title:"Ascii Text"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("bleach-bypass",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float amount;\nconst vec4 one = vec4(1.0);\nconst vec4 two = vec4(2.0);\nconst vec4 lumcoeff = vec4(0.2125,0.7154,0.0721,0.0);\nvec4 overlay(vec4 myInput, vec4 previousmix, vec4 amount) {\n\tfloat luminance = dot(previousmix,lumcoeff);\n\tfloat mixamount = clamp((luminance - 0.45) * 10.0, 0.0, 1.0);\n\tvec4 branch1 = two * previousmix * myInput;\n\tvec4 branch2 = one - (two * (one - previousmix) * (one - myInput));\n\tvec4 result = mix(branch1, branch2, vec4(mixamount) );\n\treturn mix(previousmix, result, amount);\n}\nvoid main (void)  {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tvec4 luma = vec4(vec3(dot(pixel,lumcoeff)), pixel.a);\n\tgl_FragColor = overlay(luma, pixel, vec4(amount));\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},amount:{type:"number",uniform:"amount",defaultValue:1,min:0,max:1}},title:"Bleach Bypass",categories:["film"],description:'Bleach Bypass film treatment\nhttp://en.wikipedia.org/wiki/Bleach_bypass\nsee: "Saving Private Ryan", "Minority Report"'})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){function a(a,b,c){function d(a){var e={base:(b||"base")+"."+a,blend:(c||"blend")+"."+a};return function(a){return e[a]||a}}return"vec3("+a.replace(/blend|base/g,d("r"))+", "+a.replace(/blend|base/g,d("g"))+", "+a.replace(/blend|base/g,d("b"))+")"}var c={normal:"blend",lighten:"max(blend, base)",
darken:"min(blend, base)",multiply:"(base * blend)",average:"(base + blend / TWO)",add:"min(base + blend, ONE)",subtract:"max(base - blend, ZERO)",divide:"base / blend",difference:"abs(base - blend)",negation:"(ONE - abs(ONE - base - blend))",exclusion:"(base + blend - TWO * base * blend)",screen:"(ONE - ((ONE - base) * (ONE - blend)))",lineardodge:"min(base + blend, ONE)",phoenix:"(min(base, blend) - max(base, blend) + ONE)",linearburn:"max(base + blend - ONE, ZERO)",hue:"BlendHue(base, blend)",
saturation:"BlendSaturation(base, blend)",color:"BlendColor(base, blend)",luminosity:"BlendLuminosity(base, blend)",darkercolor:"BlendDarkerColor(base, blend)",lightercolor:"BlendLighterColor(base, blend)",overlay:a("base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend))"),softlight:a("blend < 0.5 ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend))"),hardlight:a("base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend))",
"blend","base"),colordodge:a("blend == 1.0 ? blend : min(base / (1.0 - blend), 1.0)"),colorburn:a("blend == 0.0 ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0)"),linearlight:a("BlendLinearLightf(base, blend)"),vividlight:a("BlendVividLightf(base, blend)"),pinlight:a("BlendPinLightf(base, blend)"),hardmix:a("BlendHardMixf(base, blend)"),reflect:a("BlendReflectf(base, blend)"),glow:a("BlendReflectf(blend, base)")},d={normal:["FUNC_ADD","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","SRC_ALPHA","DST_ALPHA"]},
e=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);b.plugin("blend",function(){function a(){var b=m&&d[m.mode];b&&h&&(l.blendEquation=h[b[0]],l.srcRGB=h[b[1]],l.dstRGB=h[b[2]],l.srcAlpha=h[b[3]],l.dstAlpha=h[b[4]])}var b,g,l={clear:!1},m,h;this.resize=function(){var a,c;a=this.inputs.sizeMode;var d;d=this.inputs.bottom;var e=this.inputs.top;"bottom"===a||"top"===a?(c=this.inputs[a])?(a=c.width,c=c.height):c=a=1:d?e?(c="union"===a?Math.max:Math.min,a=c(d.width,e.width),c=c(d.height,e.height)):(a=
d.width,c=d.height):e?(a=e.width,c=e.height):c=a=1;if(this.width!==a||this.height!==c)this.width=a,this.height=c,this.uniforms.resolution[0]=a,this.uniforms.resolution[1]=c,this.frameBuffer&&this.frameBuffer.resize(a,c),this.emit("resize"),this.setDirty();this.uniforms.resBottom[0]=d&&d.width||1;this.uniforms.resBottom[1]=d&&d.height||1;this.uniforms.resTop[0]=e&&e.width||1;this.uniforms.resTop[1]=e&&e.height||1;b&&(d&&(g.resolution[0]=d.width,g.resolution[1]=d.height),e&&(b.resolution[0]=e.width,
b.resolution[1]=e.height));for(d=0;d<this.targets.length;d++)this.targets[d].resize()};this.uniforms.resTop=[1,1];this.uniforms.resBottom=[1,1];return{initialize:function(b){m=this.inputs;b();h=this.gl;a()},shader:function(a,f){var h=a.mode||"normal",h=h.toLowerCase();if(d[h])return b||(h=this.inputs.top,b={resolution:[h&&h.width||1,h&&h.height||1],targetRes:this.uniforms.resolution,source:h,transform:h&&h.cumulativeMatrix||e,opacity:this.inputs.opacity},h=this.inputs.bottom,g={resolution:[h&&h.width||
1,h&&h.height||1],targetRes:this.uniforms.resolution,source:h,transform:h&&h.cumulativeMatrix||e,opacity:1}),f.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform vec2 targetRes;\nuniform mat4 transform;\nvarying vec2 vTexCoord;\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.xy *= resolution / targetRes;\n\tgl_Position.w = screenPosition.w;\n\tvTexCoord = texCoord;\n}\n",
f.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float opacity;\nvoid main(void) {\n\tgl_FragColor = texture2D(source, vTexCoord);\n\tgl_FragColor.a *= opacity;\n}",f;g=b=null;f.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform vec2 resBottom;\nuniform vec2 resTop;\nvarying vec2 texCoordBottom;\nvarying vec2 texCoordTop;\nconst vec2 HALF = vec2(0.5);\nvoid main(void) {\n\tgl_Position = position;\n\tvec2 adjusted = (texCoord - HALF) * resolution;\n\ttexCoordBottom = adjusted / resBottom + HALF;\n\ttexCoordTop = adjusted / resTop + HALF;\n}";
f.fragment=["precision mediump float;\nconst vec3 ZERO = vec3(0.0);\nconst vec3 ONE = vec3(1.0);\nconst vec3 HALF = vec3(0.5);\nconst vec3 TWO = vec3(2.0);\n#define BlendAddf(base, blend)\t\t\tmin(base + blend, 1.0)\n#define BlendLinearDodgef(base, blend)\tBlendAddf(base, blend)\n#define BlendLinearBurnf(base, blend)\tmax(base + blend - 1.0, 0.0)\n#define BlendLightenf(base, blend)\t\tmax(blend, base)\n#define BlendDarkenf(base, blend)\t\tmin(blend, base)\n#define BlendLinearLightf(base, blend)\t(blend < 0.5 ? BlendLinearBurnf(base, (2.0 * blend)) : BlendLinearDodgef(base, (2.0 * (blend - 0.5))))\n#define BlendScreenf(base, blend)\t\t(1.0 - ((1.0 - base) * (1.0 - blend)))\n#define BlendOverlayf(base, blend)\t\t(base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))\n#define BlendSoftLightf(base, blend)\t((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)))\n#define BlendColorDodgef(base, blend)\t((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0))\n#define BlendColorBurnf(base, blend)\t((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0))\n#define BlendVividLightf(base, blend)\t((blend < 0.5) ? BlendColorBurnf(base, (2.0 * blend)) : BlendColorDodgef(base, (2.0 * (blend - 0.5))))\n#define BlendPinLightf(base, blend)\t((blend < 0.5) ? BlendDarkenf(base, (2.0 * blend)) : BlendLightenf(base, (2.0 *(blend - 0.5))))\n#define BlendHardMixf(base, blend)\t\t((BlendVividLightf(base, blend) < 0.5) ? 0.0 : 1.0)\n#define BlendReflectf(base, blend)\t\t((blend == 1.0) ? blend : min(base * base / (1.0 - blend), 1.0))\nvec3 RGBToHSL(vec3 color) {\n\tvec3 hsl;\n\tfloat fmin = min(min(color.r, color.g), color.b);\n\tfloat fmax = max(max(color.r, color.g), color.b);\n\tfloat delta = fmax - fmin;\n\thsl.z = (fmax + fmin) / 2.0;\n\tif (delta == 0.0) {\n\t\thsl.x = 0.0;\n\t\thsl.y = 0.0;\n\t} else {\n\t\tif (hsl.z < 0.5)\n\t\t\thsl.y = delta / (fmax + fmin);\n\t\telse\n\t\t\thsl.y = delta / (2.0 - fmax - fmin);\n\t\tfloat deltaR = (((fmax - color.r) / 6.0) + (delta / 2.0)) / delta;\n\t\tfloat deltaG = (((fmax - color.g) / 6.0) + (delta / 2.0)) / delta;\n\t\tfloat deltaB = (((fmax - color.b) / 6.0) + (delta / 2.0)) / delta;\n\t\tif (color.r == fmax )\n\t\t\thsl.x = deltaB - deltaG;\n\t\telse if (color.g == fmax)\n\t\t\thsl.x = (1.0 / 3.0) + deltaR - deltaB;\n\t\telse if (color.b == fmax)\n\t\t\thsl.x = (2.0 / 3.0) + deltaG - deltaR;\n\t\tif (hsl.x < 0.0)\n\t\t\thsl.x += 1.0;\n\t\telse if (hsl.x > 1.0)\n\t\t\thsl.x -= 1.0;\n\t}\n\treturn hsl;\n}\nfloat HueToRGB(float f1, float f2, float hue) {\n\tif (hue < 0.0)\n\t\thue += 1.0;\n\telse if (hue > 1.0)\n\t\thue -= 1.0;\n\tfloat res;\n\tif ((6.0 * hue) < 1.0)\n\t\tres = f1 + (f2 - f1) * 6.0 * hue;\n\telse if ((2.0 * hue) < 1.0)\n\t\tres = f2;\n\telse if ((3.0 * hue) < 2.0)\n\t\tres = f1 + (f2 - f1) * ((2.0 / 3.0) - hue) * 6.0;\n\telse\n\t\tres = f1;\n\treturn res;\n}\nvec3 HSLToRGB(vec3 hsl) {\n\tvec3 rgb;\n\tif (hsl.y == 0.0)\n\t\trgb = vec3(hsl.z);\n\telse {\n\t\tfloat f2;\n\t\tif (hsl.z < 0.5)\n\t\t\tf2 = hsl.z * (1.0 + hsl.y);\n\t\telse\n\t\t\tf2 = (hsl.z + hsl.y) - (hsl.y * hsl.z);\n\t\tfloat f1 = 2.0 * hsl.z - f2;\n\t\trgb.r = HueToRGB(f1, f2, hsl.x + (1.0/3.0));\n\t\trgb.g = HueToRGB(f1, f2, hsl.x);\n\t\trgb.b= HueToRGB(f1, f2, hsl.x - (1.0/3.0));\n\t}\n\treturn rgb;\n}\nvec3 BlendHue(vec3 base, vec3 blend) {\n\tvec3 baseHSL = RGBToHSL(base);\n\treturn HSLToRGB(vec3(RGBToHSL(blend).r, baseHSL.g, baseHSL.b));\n}\nvec3 BlendSaturation(vec3 base, vec3 blend) {\n\tvec3 baseHSL = RGBToHSL(base);\n\treturn HSLToRGB(vec3(baseHSL.r, RGBToHSL(blend).g, baseHSL.b));\n}\nvec3 BlendColor(vec3 base, vec3 blend) {\n\tvec3 blendHSL = RGBToHSL(blend);\n\treturn HSLToRGB(vec3(blendHSL.r, blendHSL.g, RGBToHSL(base).b));\n}\nvec3 BlendLuminosity(vec3 base, vec3 blend) {\n\tvec3 baseHSL = RGBToHSL(base);\n\treturn HSLToRGB(vec3(baseHSL.r, baseHSL.g, RGBToHSL(blend).b));\n}\nvec3 BlendLighterColor(vec3 base, vec3 blend) {\n\tfloat baseTotal = base.r + base.g + base.b;\n\tfloat blendTotal = blend.r + blend.g + blend.b;\n\treturn blendTotal > baseTotal ? blend : base;\n}\nvec3 BlendDarkerColor(vec3 base, vec3 blend) {\n\tfloat baseTotal = base.r + base.g + base.b;\n\tfloat blendTotal = blend.r + blend.g + blend.b;\n\treturn blendTotal < baseTotal ? blend : base;\n}",
"#define BlendFunction(base, blend) "+c[h],"varying vec2 texCoordBottom;\nvarying vec2 texCoordTop;\nuniform sampler2D top;\nuniform sampler2D bottom;\nuniform float opacity;\nvec3 BlendOpacity(vec4 base, vec4 blend, float opacity) {\n\tvec3 blendedColor = BlendFunction(base.rgb, blend.rgb);\n\treturn mix(base.rgb, blendedColor, opacity * blend.a);\n}\nvoid main(void) {\n\tvec4 topPixel = texture2D(top, texCoordTop);\n\tvec4 bottomPixel = texture2D(bottom, texCoordBottom);\n\tif (topPixel.a == 0.0) {\n\t\tgl_FragColor = bottomPixel;\n\t} else {\n\t\tgl_FragColor = vec4(BlendOpacity(bottomPixel, topPixel, opacity), bottomPixel.a);\n\t}\n}"].join("\n");
return f},draw:function(a,c,e,f,m){d[this.inputs.mode]?(this.inputs.bottom?m(a,c,g,f):(h.viewport(0,0,this.width,this.height),h.bindFramebuffer(h.FRAMEBUFFER,f),h.clearColor(0,0,0,0),h.clear(h.COLOR_BUFFER_BIT|h.DEPTH_BUFFER_BIT)),this.inputs.top&&this.inputs.opacity&&m(a,c,b,f,null,l)):m(a,c,e,f)},requires:function(a){return this.inputs.opacity||"top"!==a?!0:!1},inputs:{top:{type:"image",uniform:"top",update:function(){b&&(b.source=this.inputs.top,b.transform=this.inputs.top.cumulativeMatrix||e);
this.resize()}},bottom:{type:"image",uniform:"bottom",update:function(){g&&(g.source=this.inputs.bottom,g.transform=this.inputs.bottom.cumulativeMatrix||e);this.resize()}},opacity:{type:"number",uniform:"opacity",defaultValue:1,min:0,max:1,updateSources:!0,update:function(a){b&&(b.opacity=a)}},sizeMode:{type:"enum",defaultValue:"bottom",options:["bottom","top","union","intersection"],update:function(){this.resize()}},mode:{type:"enum",shaderDirty:!0,defaultValue:"normal",options:[["normal","Normal"],
["lighten","Lighten"],["darken","Darken"],["multiply","Multiply"],["average","Average"],["add","Add"],["subtract","Subtract"],["divide","Divide"],["difference","Difference"],["negation","Negation"],["exclusion","Exclusion"],["screen","Screen"],["overlay","Overlay"],["softlight","Soft Light"],["hardlight","Hard Light"],["colordodge","Color Dodge"],["colorburn","Color Burn"],["lineardodge","Linear Dodge"],["linearburn","Linear Burn"],["linearlight","Linear Light"],["vividlight","Vivid Light"],["pinlight",
"Pin Light"],["hardmix","Hard Mix"],["reflect","Reflect"],["glow","Glow"],["phoenix","Phoenix"],["hue","Hue"],["saturation","Saturation"],["color","color"],["luminosity","Luminosity"],["darkercolor","Darker Color"],["lightercolor","Lighter Color"]],update:function(){a()}}}}},{inPlace:function(){return!!d[this.inputs.mode]},description:"Blend two layers",title:"Blend"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a=[0.2,0.3,0.5,0.8,1],c=a.length-1,d=[1,0],e=[0,1],f=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);b.plugin("blur",function(k){var g,l,m,h={amount:0,inputScale:1,resolution:[this.width,this.height],transform:f,direction:null};return{initialize:function(a){a();if(a=this.gl)m=
this.baseShader,g=new b.util.FrameBuffer(a,this.width,this.height),l=new b.util.FrameBuffer(a,this.width,this.height)},commonShader:!0,shader:function(a,b){var c=this.gl,c=10<=c.getParameter(c.MAX_VARYING_VECTORS)?"#define USE_VARYINGS":"";b.vertex=[c,"precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nuniform vec2 direction;\nuniform float amount;\nuniform float inputScale;\nconst vec2 zero = vec2(0.0, 0.0);\nvarying vec2 vTexCoord;\n#ifdef USE_VARYINGS\nvec2 one;\nvec2 amount1;\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying vec2 vTexCoord3;\nvarying vec2 vTexCoord4;\nvarying vec2 vTexCoord5;\nvarying vec2 vTexCoord6;\nvarying vec2 vTexCoord7;\nvarying vec2 vTexCoord8;\n#else\nvarying vec2 one;\nvarying vec2 amount1;\n#endif\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position = screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tvTexCoord = texCoord;\n\tone = vec2(1.0, 1.0) * inputScale;\n\tif (inputScale < 1.0) {\n\t\tone -= 1.0 / resolution;\n\t}\n\tvTexCoord = max(zero, min(one, texCoord.st * inputScale));\n\tamount1 = direction * (inputScale * amount * 5.0 / resolution);\n#ifdef USE_VARYINGS\n\tvec2 amount2 = amount1 * 3.0;\n\tvec2 amount3 = amount1 * 6.0;\n\tvec2 amount4 = amount1 * 9.0;\n\tvec2 amount5 = -amount1;\n\tvec2 amount6 = amount5 * 3.0;\n\tvec2 amount7 = amount5 * 6.0;\n\tvec2 amount8 = amount5 * 9.0;\n\tvTexCoord1 = max(zero, min(one, vTexCoord + amount1));\n\tvTexCoord2 = max(zero, min(one, vTexCoord + amount2));\n\tvTexCoord3 = max(zero, min(one, vTexCoord + amount3));\n\tvTexCoord4 = max(zero, min(one, vTexCoord + amount4));\n\tvTexCoord5 = max(zero, min(one, vTexCoord + amount5));\n\tvTexCoord6 = max(zero, min(one, vTexCoord + amount6));\n\tvTexCoord7 = max(zero, min(one, vTexCoord + amount7));\n\tvTexCoord8 = max(zero, min(one, vTexCoord + amount8));\n#endif\n}"].join("\n");
b.fragment=[c,"precision mediump float;\n\nvarying vec2 vTexCoord;\nuniform sampler2D source;\n#ifdef USE_VARYINGS\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying vec2 vTexCoord3;\nvarying vec2 vTexCoord4;\nvarying vec2 vTexCoord5;\nvarying vec2 vTexCoord6;\nvarying vec2 vTexCoord7;\nvarying vec2 vTexCoord8;\n#else\nvarying vec2 amount1;\nvarying vec2 one;\nconst vec2 zero = vec2(0.0, 0.0);\n#endif\nvoid main(void) {\n#ifndef USE_VARYINGS\n\tvec2 vTexCoord1 = max(zero, min(one, vTexCoord + amount1));\n\tvec2 vTexCoord2 = max(zero, min(one, vTexCoord + amount1 * 3.0));\n\tvec2 vTexCoord3 = max(zero, min(one, vTexCoord + amount1 * 6.0));\n\tvec2 vTexCoord4 = max(zero, min(one, vTexCoord + amount1 * 9.0));\n\tvec2 vTexCoord5 = max(zero, min(one, vTexCoord - amount1));\n\tvec2 vTexCoord6 = max(zero, min(one, vTexCoord - amount1 * 3.0));\n\tvec2 vTexCoord7 = max(zero, min(one, vTexCoord - amount1 * 6.0));\n\tvec2 vTexCoord8 = max(zero, min(one, vTexCoord - amount1 * 9.0));\n#endif\n\tgl_FragColor = texture2D(source, vTexCoord) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord1) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord2) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord3) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord4) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord5) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord6) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord7) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord8) / 9.0;\n}"].join("\n");
return b},draw:function(b,f,k,v,x){var w,B,L,G,ea={width:0,height:0,blend:!1},A=1;if(B=this.inputs.amount)if(0.01>=B)k.inputScale=1,k.direction=d,k.source=this.inputs.source.texture,x(b,f,k,g.frameBuffer),k.direction=e,k.source=g.texture,x(b,f,k,v);else for(h.amount=B,h.source=this.inputs.source.texture,k=0;k<a.length;k++)w=Math.min(1,a[k]/B),L=Math.floor(w*this.width),G=Math.floor(w*this.height),h.resolution[0]=L,h.resolution[1]=G,h.inputScale=A,A=w,ea.width=L,ea.height=G,h.direction=d,x(b,f,h,g.frameBuffer,
null,ea),h.inputScale=w,h.source=g.texture,h.direction=e,x(b,f,h,k===c?v:l.frameBuffer,null,ea),h.source=l.texture;else k.source=this.inputs.source.texture,x(m,f,k,v)},resize:function(){h.resolution[0]=this.width;h.resolution[1]=this.height;g&&(g.resize(this.width,this.height),l.resize(this.width,this.height))},destroy:function(){g&&(g.destroy(),l.destroy(),l=g=null);h=null}}},{inputs:{source:{type:"image",shaderDirty:!1},amount:{type:"number",uniform:"amount",defaultValue:0.2,min:0,max:1}},title:"Gaussian Blur"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("brightness-contrast",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float brightness;\nuniform float saturation;\nuniform float contrast;\nconst vec3 half3 = vec3(0.5);\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tvec3 color = pixel.rgb * brightness;\n\tcolor = (color - half3) * contrast + half3;\n\tgl_FragColor = vec4(color, pixel.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},brightness:{type:"number",uniform:"brightness",defaultValue:1,min:0},contrast:{type:"number",uniform:"contrast",defaultValue:1,min:0}},title:"Brightness/Contrast",description:"Multiply brightness and contrast values. Works the same as CSS filters."})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a=["Red","Green","Blue","Alpha"],c={r:0,g:1,b:2,a:3,x:0,y:1,z:2,w:3};b.plugin("channels",function(){function d(a,b,d){"string"===typeof a?(b=a.charAt(0).toLowerCase(),b=c[b],void 0===b&&(b=-1),0>b&&(b=parseFloat(a))):b=a;return 0===b||1===b||2===b||3===b?b:m.inputs[d]}function e(){var a=
m.inputs,b,c,d,e;for(b=0;b<k.length;b++){d=k[b];e=l[b];e||(e=l[b]=[],m.uniforms["channels"+b]=e);for(c=0;16>c;c++)e[c]=0;e[a.red]=a.redSource===d?1:0;e[4+a.green]=a.greenSource===d?1:0;e[8+a.blue]=a.blueSource===d?1:0;e[12+a.alpha]=a.alphaSource===d?1:0}}function f(){function a(c){var d;d=b[c];d||(d=m.sources[c]=b[c]=b.source);c=k.indexOf(d);0>c&&(c=k.length,k.push(d),m.uniforms["source"+c]=d)}var b=m.inputs;k.length=0;a("redSource");a("greenSource");a("blueSource");a("alphaSource");m.resize();e()}
var k=[],g=[],l=[],m=this;this.resize=function(){var a,b;a=this.inputs.sizeMode;var c,d,e;if(k.length)if(1===k.length)e=k[0],a=e.width,b=e.height;else if("union"===a)for(c=b=a=0;c<k.length;c++)e=k[0],a=Math.max(a,e.width),b=Math.max(b,e.height);else if("intersection"===a)for(b=a=Infinity,c=0;c<k.length;c++)e=k[0],a=Math.min(a,e.width),b=Math.min(b,e.height);else(e=m.inputs[a+"Source"])?(a=e.width,b=e.height):b=a=1;else b=a=1;for(c=0;c<k.length;c++)e=k[c],(d=m.uniforms["resolution"+c])?(d[0]=e.width,
d[1]=e.height):m.uniforms["resolution"+c]=[e.width,e.height];if(this.width!==a||this.height!==b)this.width=a,this.height=b,this.uniforms.resolution[0]=a,this.uniforms.resolution[1]=b,this.frameBuffer&&this.frameBuffer.resize(a,b),this.emit("resize"),this.setDirty();for(c=0;c<this.targets.length;c++)this.targets[c].resize()};return{shader:function(){var a,c,d=c="",e="",f="";if(g[k.length])return g[k.length];for(a=0;a<k.length;a++)e+="varying vec2 vTexCoord"+a+";\n",c+="uniform sampler2D source"+a+
";\nuniform mat4 channels"+a+";\nuniform vec2 resolution"+a+";\n\n",f+="    vTexCoord"+a+" = (position.xy * resolution / resolution"+a+") * 0.5 + 0.5;\n",d+="    if (all(greaterThanEqual(vTexCoord"+a+", vec2(0.0))) && all(lessThan(vTexCoord"+a+", vec2(1.0)))) {\n        gl_FragColor += texture2D(source"+a+", vTexCoord"+a+") * channels"+a+";\n    }\n";a=["precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;",c,e,"void main(void) {",f,"\tgl_Position = position;\n}\n"].join("\n");
c=["precision mediump float;",e,c,"void main(void) {\n\tgl_FragColor = vec4(0.0);",d,"}"].join("\n");c=new b.util.ShaderProgram(this.gl,a,c);return g[k.length]=c},inputs:{sizeMode:{type:"enum",defaultValue:"red",options:"red green blue alpha union intersection".split(" "),update:function(){this.resize()}},source:{type:"image",update:f,shaderDirty:!0},redSource:{type:"image",update:f,shaderDirty:!0},greenSource:{type:"image",update:f,shaderDirty:!0},blueSource:{type:"image",update:f,shaderDirty:!0},
alphaSource:{type:"image",update:f,shaderDirty:!0},red:{type:"enum",options:a,validate:d,update:e,defaultValue:0},green:{type:"enum",options:a,validate:d,update:e,defaultValue:1},blue:{type:"enum",options:a,validate:d,update:e,defaultValue:2},alpha:{type:"enum",options:a,validate:d,update:e,defaultValue:3}}}},{inPlace:!1,title:"Channel Mapping"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("checkerboard",function(){function a(){b.resize()}var b=this;return{initialize:function(b){b();a()},shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nuniform vec2 size;\nuniform vec2 anchor;\nvec2 pixelCoord;\nvarying vec2 vGridCoord;\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.w = screenPosition.w;\n\tpixelCoord = resolution * (texCoord - 0.5) / 2.0;\n\tvGridCoord = (pixelCoord - anchor) / size;\n}\n";
b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nvarying vec2 vPixelCoord;\nvarying vec2 vGridCoord;\nuniform vec2 resolution;\nuniform vec2 anchor;\nuniform vec2 size;\nuniform vec4 color1;\nuniform vec4 color2;\nvoid main(void) {\n\tvec2 modGridCoord = floor(mod(vGridCoord, 2.0));\n\tif (modGridCoord.x == modGridCoord.y) {\n\t\tgl_FragColor = color1;\n\t} else  {\n\t\tgl_FragColor = color2;\n\t}\n}";return b},inPlace:!0,inputs:{anchor:{type:"vector",uniform:"anchor",dimensions:2,defaultValue:[0,
0]},size:{type:"vector",uniform:"size",dimensions:2,defaultValue:[4,4]},color1:{type:"color",uniform:"color1",defaultValue:[1,1,1,1]},color2:{type:"color",uniform:"color2",defaultValue:[187/255,187/255,187/255,1]},width:{type:"number",min:0,step:1,update:a,defaultValue:640},height:{type:"number",min:0,step:1,update:a,defaultValue:360}}}},{commonShader:!0,title:"Checkerboard",categories:["generator"]})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("chroma",{shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nvarying vec2 vTexCoord;\nuniform vec4 screen;\nuniform float balance;\nvarying float screenSat;\nvarying vec3 screenPrimary;\nvoid main(void) {\n\tfloat fmin = min(min(screen.r, screen.g), screen.b);\n\tfloat fmax = max(max(screen.r, screen.g), screen.b);\n\tfloat secondaryComponents;\n\tscreenPrimary = step(fmax, screen.rgb);\n\tsecondaryComponents = dot(1.0 - screenPrimary, screen.rgb);\n\tscreenSat = fmax - mix(secondaryComponents - fmin, secondaryComponents / 2.0, balance);\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position = screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tvTexCoord = texCoord;\n}";
b.fragment=[this.inputs.mask?"#define MASK":"","precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec4 screen;\nuniform float screenWeight;\nuniform float balance;\nuniform float clipBlack;\nuniform float clipWhite;\nuniform bool mask;\nvarying float screenSat;\nvarying vec3 screenPrimary;\nvoid main(void) {\n\tfloat pixelSat, secondaryComponents;\n\tvec4 sourcePixel = texture2D(source, vTexCoord);\n\tfloat fmin = min(min(sourcePixel.r, sourcePixel.g), sourcePixel.b);\n\tfloat fmax = max(max(sourcePixel.r, sourcePixel.g), sourcePixel.b);\n\tvec3 pixelPrimary = step(fmax, sourcePixel.rgb);\n\tsecondaryComponents = dot(1.0 - pixelPrimary, sourcePixel.rgb);\n\tpixelSat = fmax - mix(secondaryComponents - fmin, secondaryComponents / 2.0, balance);\n\tfloat diffPrimary = dot(abs(pixelPrimary - screenPrimary), vec3(1.0));\n\tfloat solid = step(1.0, step(pixelSat, 0.1) + step(fmax, 0.1) + diffPrimary);\n\tfloat alpha = max(0.0, 1.0 - pixelSat / screenSat);\n\talpha = smoothstep(clipBlack, clipWhite, alpha);\n\tvec4 semiTransparentPixel = vec4((sourcePixel.rgb - (1.0 - alpha) * screen.rgb * screenWeight) / max(0.00001, alpha), alpha);\n\tvec4 pixel = mix(semiTransparentPixel, sourcePixel, solid);\n#ifdef MASK\n\tgl_FragColor = vec4(vec3(pixel.a), 1.0);\n#else\n\tgl_FragColor = pixel;\n#endif\n}"].join("\n");
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},screen:{type:"color",uniform:"screen",defaultValue:[66/255,195/255,31/255,1]},weight:{type:"number",uniform:"screenWeight",defaultValue:1,min:0},balance:{type:"number",uniform:"balance",defaultValue:1,min:0,max:1},clipBlack:{type:"number",uniform:"clipBlack",defaultValue:0,min:0,max:1},clipWhite:{type:"number",uniform:"clipWhite",defaultValue:1,min:0,max:1},mask:{type:"boolean",defaultValue:!1,uniform:"mask",shaderDirty:!0}},title:"Chroma Key",
description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("color",function(){function a(){c.resize()}var c=this,d={width:1,height:1},e=!0;this.resize=function(){var a,b;this.inputs&&this.inputs.width?(a=this.inputs.width,b=this.inputs.height||a):this.inputs&&this.inputs.height?a=b=this.inputs.height:b=a=1;a=Math.floor(a);b=
Math.floor(b);if(this.width!==a||this.height!==b)this.width=a,this.height=b,this.emit("resize"),this.setDirty();for(a=0;a<this.targets.length;a++)b=this.targets[a],b.resize(),b.setTransformDirty&&b.setTransformDirty()};return{initialize:function(c){this.frameBuffer=new b.util.FrameBuffer(this.gl,1,1);a();e=!0},commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nvoid main(void) {\n\tgl_Position = position;\n}\n";b.fragment="precision mediump float;\n\nuniform vec4 color;\nvoid main(void) {\n\tgl_FragColor = color;\n}";
return b},draw:function(a,b,c,l,m){e&&(m(a,b,c,l,null,d),e=!1)},inPlace:!0,inputs:{color:{type:"color",uniform:"color",defaultValue:[0,0,0,1],update:function(){e=!0}},width:{type:"number",min:0,step:1,update:a,defaultValue:640},height:{type:"number",min:0,step:1,update:a,defaultValue:360}}}},{title:"Color",description:"Generate color",categories:["generator"]})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("colorcomplements",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec4 guideColor;\nuniform float correlation;\nuniform float amount;\nuniform float concentration;\nfloat hueLerp(float h1, float h2, float v) {\n\tfloat d = abs(h1 - h2);\n\tif (d <= 0.5) {\n\t\treturn mix(h1, h2, v);\n\t} else if (h1 < h2) {\n\t\treturn fract(mix((h1 + 1.0), h2, v));\n\t} else {\n\t\treturn fract(mix(h1, (h2 + 1.0), v));\n\t}\n}\nvec3 rgbToHsv(vec3 c) {\n\tvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n\tvec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n\tvec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n\tfloat d = q.x - min(q.w, q.y);\n\tfloat e = 1.0e-10;\n\treturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\nvec3 hsvToRgb(vec3 c) {\n\tvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\tvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec3 hsvComplement(vec3 hsv) {\n\tvec3 compl = hsv;\n\tcompl.x = mod(compl.x - 0.5, 1.0);\n\treturn compl;\n}\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tvec3 hsv = rgbToHsv(pixel.rgb);\n\tvec3 hsvPole1 = rgbToHsv(guideColor.rgb);\n\tvec3 hsvPole2 = hsvPole1;\n\thsvPole2 = hsvComplement(hsvPole1);\n\tfloat dist1 = abs(hsv.x - hsvPole1.x);\n\tdist1 = dist1 > 0.5 ? 1.0 - dist1 : dist1;\n\tfloat dist2 = abs(hsv.x - hsvPole2.x);\n\tdist2 = dist2 > 0.5 ? 1.0 - dist2 : dist2;\n\tfloat descent = smoothstep(0.0, correlation, hsv.y);\n\tvec3 outputHsv = hsv;\n\tvec3 pole = dist1 < dist2 ? hsvPole1 : hsvPole2;\n\tfloat dist = min(dist1, dist2);\n\tfloat c = descent * amount * (1.0 - pow((dist * 2.0), 1.0 / concentration));\n\toutputHsv.x = hueLerp(hsv.x, pole.x, c);\n\toutputHsv.y = mix(hsv.y, pole.y, c);\n\tgl_FragColor = vec4(hsvToRgb(outputHsv), pixel.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},amount:{type:"number",uniform:"amount",min:0,max:1,defaultValue:0.8},concentration:{type:"number",uniform:"concentration",min:0.1,max:4,defaultValue:2},correlation:{type:"number",uniform:"correlation",min:0,max:1,defaultValue:0.5},guideColor:{type:"color",uniform:"guideColor",defaultValue:[1,0.5,0,1]}},title:"Color Complements",categories:["color"],description:"http://theabyssgazes.blogspot.com/2010/03/teal-and-orange-hollywood-please-stop.html"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("colorcube",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nuniform sampler2D source;\nuniform sampler2D colorCube;\nvarying vec2 vTexCoord;\nvec3 sampleAs3DTexture(sampler2D tex, vec3 coord, float size) {\n\tfloat sliceSize = 1.0 / size;\n\tfloat slicePixelSize = sliceSize / size;\n\tfloat sliceInnerSize = slicePixelSize * (size - 1.0);\n\tfloat zSlice0 = min(floor(coord.z * size), size - 1.0);\n\tfloat zSlice1 = min(zSlice0 + 1.0, size - 1.0);\n\tfloat xOffset = slicePixelSize * 0.5 + coord.x * sliceInnerSize;\n\tfloat s0 = xOffset + (zSlice0 * sliceSize);\n\tfloat s1 = xOffset + (zSlice1 * sliceSize);\n\tvec3 slice0Color = texture2D(tex, vec2(s0, 1.0 - coord.y)).rgb;\n\tvec3 slice1Color = texture2D(tex, vec2(s1, 1.0 - coord.y)).rgb;\n\tfloat zOffset = mod(coord.z * size, 1.0);\n\treturn mix(slice0Color, slice1Color, zOffset);\n}\nvoid main(void) {\n\tvec4 originalColor = texture2D(source, vTexCoord);\n\tvec3 color = sampleAs3DTexture(colorCube, originalColor.rgb, 8.0);\n\tgl_FragColor = vec4(color, originalColor.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},cube:{type:"image",uniform:"colorCube"}},title:"Color Cube",description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("color-select",{shader:function(a,b,d){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nuniform float hueMin;\nuniform float hueMax;\nuniform float hueMinFalloff;\nuniform float hueMaxFalloff;\nuniform float saturationMin;\nuniform float saturationMax;\nuniform float saturationMinFalloff;\nuniform float saturationMaxFalloff;\nuniform float lightnessMin;\nuniform float lightnessMax;\nuniform float lightnessMinFalloff;\nuniform float lightnessMaxFalloff;\nvarying vec2 vTexCoord;\nvarying vec4 adjustedHueRange;\nvarying vec4 saturationRange;\nvarying vec4 lightnessRange;\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.w = screenPosition.w;\n\tvTexCoord = texCoord;\n\tfloat hueOffset = hueMin - hueMinFalloff;\n\tadjustedHueRange = mod(vec4(hueOffset, hueMin - hueOffset, hueMax - hueOffset, hueMax + hueMaxFalloff - hueOffset), 360.0);\n\tif (hueMin != hueMax) {\n\t\tif (adjustedHueRange.z == 0.0) {\n\t\t\tadjustedHueRange.z = 360.0;\n\t\t\tadjustedHueRange.w += 360.0;\n\t\t} else if (adjustedHueRange.w == 0.0) {\n\t\t\tadjustedHueRange.w += 360.0;\n\t\t}\n\t}\n\tsaturationRange = vec4(saturationMin - saturationMinFalloff, saturationMin, saturationMax, saturationMax + saturationMaxFalloff );\n\tlightnessRange = vec4(lightnessMin - lightnessMinFalloff, lightnessMin, lightnessMax, lightnessMax + lightnessMaxFalloff );\n}";
b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform bool mask;\nvarying vec4 adjustedHueRange;\nvarying vec4 saturationRange;\nvarying vec4 lightnessRange;\nvec3 calcHSL(vec3 c) {\n\tfloat minColor = min(c.r, min(c.g, c.b));\n\tfloat maxColor = max(c.r, max(c.g, c.b));\n\tfloat delta = maxColor - minColor;\n\tvec3 hsl = vec3(0.0, 0.0, (maxColor + minColor) / 2.0);\n\tif (delta > 0.0) {\n\t\tif (hsl.z < 0.5) {\n\t\t\thsl.y = delta / (maxColor + minColor);\n\t\t} else {\n\t\t\thsl.y = delta / (2.0 - maxColor - minColor);\n\t\t}\n\t\tif (c.r == maxColor) {\n\t\t\thsl.x = (c.g - c.b) / delta;\n\t\t} else if (c.g == maxColor) {\n\t\t\thsl.x = 2.0 + (c.b - c.r) / delta;\n\t\t} else {\n\t\t\thsl.x = 4.0 + (c.r - c.g) / delta;\n\t\t}\n\t\thsl.x = hsl.x * 360.0 / 6.0;\n\t\tif (hsl.x < 0.0) {\n\t\t\thsl.x += 360.0;\n\t\t} else {\n\t\t\thsl.x = mod(hsl.x, 360.0);\n\t\t}\n\t}\n\treturn hsl;\n}\nvoid main(void) {\n\tvec4 color = texture2D(source, vTexCoord);\n\tvec3 hsl = calcHSL(color.rgb);\n\tfloat adjustedHue = mod(hsl.x - adjustedHueRange.x, 360.0);\n\tfloat maskValue;\n\tif (adjustedHue < adjustedHueRange.y) {\n\t\tmaskValue = smoothstep(0.0, adjustedHueRange.y, adjustedHue);\n\t} else if (adjustedHue < adjustedHueRange.z) {\n\t\tmaskValue = 1.0;\n\t} else {\n\t\tmaskValue = 1.0 - smoothstep(adjustedHueRange.z, adjustedHueRange.w, adjustedHue);\n\t}\n\tif (maskValue > 0.0) {\n\t\tif (hsl.y < saturationRange.y) {\n\t\t\tmaskValue = min(maskValue, smoothstep(saturationRange.x, saturationRange.y, hsl.y));\n\t\t} else {\n\t\t\tmaskValue = min(maskValue, 1.0 - smoothstep(saturationRange.z, saturationRange.w, hsl.y));\n\t\t}\n\t}\n\tif (maskValue > 0.0) {\n\t\tif (hsl.z < lightnessRange.y) {\n\t\t\tmaskValue = min(maskValue, smoothstep(lightnessRange.x, lightnessRange.z, hsl.y));\n\t\t} else {\n\t\t\tmaskValue = min(maskValue, 1.0 - smoothstep(lightnessRange.z, lightnessRange.w, hsl.z));\n\t\t}\n\t}\n\tif (mask) {\n\t\tgl_FragColor = vec4(maskValue, maskValue, maskValue, 1.0);\n\t} else {\n\t\tcolor.a = min(color.a, maskValue);\n\t\tgl_FragColor = color;\n\t}\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},hueMin:{type:"number",uniform:"hueMin",defaultValue:0},hueMax:{type:"number",uniform:"hueMax",defaultValue:360},hueMinFalloff:{type:"number",uniform:"hueMinFalloff",defaultValue:0,min:0},hueMaxFalloff:{type:"number",uniform:"hueMaxFalloff",defaultValue:0,min:0},saturationMin:{type:"number",uniform:"saturationMin",defaultValue:0,min:0,max:1},saturationMax:{type:"number",uniform:"saturationMax",defaultValue:1,min:0,max:1},saturationMinFalloff:{type:"number",
uniform:"saturationMinFalloff",defaultValue:0,min:0},saturationMaxFalloff:{type:"number",uniform:"saturationMaxFalloff",defaultValue:0,min:0},lightnessMin:{type:"number",uniform:"lightnessMin",defaultValue:0,min:0,max:1},lightnessMax:{type:"number",uniform:"lightnessMax",defaultValue:1,min:0,max:1},lightnessMinFalloff:{type:"number",uniform:"lightnessMinFalloff",defaultValue:0,min:0},lightnessMaxFalloff:{type:"number",uniform:"lightnessMaxFalloff",defaultValue:0,min:0},mask:{type:"boolean",defaultValue:!1,
uniform:"mask"}},title:"Color Select",description:"Create a mask by hue, saturation and lightness range."})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("crop",function(){function a(){var a=1,e=1;b.source?(a=b.source.width,e=b.source.height):b.sources&&b.sources.source&&(a=b.sources.source.width,e=b.sources.source.height);a=a-b.inputs.left-b.inputs.right;e=e-b.inputs.top-b.inputs.bottom;a=Math.max(1,Math.floor(a));e=
Math.max(1,Math.floor(e));if(b.width!==a||b.height!==e)b.width=a,b.height=e,b.uniforms.resolution[0]=a,b.uniforms.resolution[1]=e,b.frameBuffer&&b.frameBuffer.resize(b.width,b.height),b.emit("resize"),b.setDirty();for(e=0;e<b.targets.length;e++)a=b.targets[e],a.resize(),a.setTransformDirty&&a.setTransformDirty()}var b=this;b.resize=a;return{commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nuniform float top;\nuniform float left;\nuniform float bottom;\nuniform float right;\nvarying vec2 vTexCoord;\nconst vec2 ZERO = vec2(0.0);\nconst vec2 ONE = vec2(1.0);\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.w = screenPosition.w;\n\tvec2 dim = resolution + vec2(right + left, bottom + top);\n\tvec2 scale = dim / resolution;\n\tvec2 offset = vec2(left, bottom) / resolution;\n\tvTexCoord = max(ZERO, (texCoord + offset) / scale);\n}\n";
return b},inputs:{source:{type:"image",uniform:"source",update:a},top:{type:"number",uniform:"top",min:0,step:1,update:a,defaultValue:0},left:{type:"number",uniform:"left",min:0,step:1,update:a,defaultValue:0},bottom:{type:"number",uniform:"bottom",min:0,step:1,update:a,defaultValue:0},right:{type:"number",uniform:"right",min:0,step:1,update:a,defaultValue:0}}}},{inPlace:!0,title:"Crop"})});(function(b,a){if("function"===typeof define&&define.amd)define(["seriously"],a);else if("object"===typeof exports)a(require("seriously"));else{var c=b.Seriously;c||(c={plugin:function(a,b){this[a]=b}});a(c)}})(this,function(b){b.plugin("daltonize",{commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec3 position;\nattribute vec2 texCoord;\nuniform mat4 transform;\nvarying vec2 vTexCoord;\nvoid main(void) {\n\tgl_Position = transform * vec4(position, 1.0);\n\tvTexCoord = vec2(texCoord.s, texCoord.t);\n}";
b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float cbtype;\nvoid main(void) {\n\tvec4 color = texture2D(source, vTexCoord);\n\tif (cbtype == 0.0) {\n\t\tgl_FragColor = color;\n\t\treturn;\n\t}\n\tconst mat3 RGBLMS = mat3( \t\t17.8824, 43.5161, 4.11935,\t\t3.45565, 27.1554, 3.86714,\t\t0.0299566, 0.184309, 1.46709\t);\n\tvec3 LMS = color.rgb * RGBLMS;\n\tvec3 lms = vec3(0.0,0.0,0.0);\n\tif (cbtype < 0.33) {\n\t\tlms = vec3(\t\t\t\t(2.02344 * LMS.g) + (-2.52581 * LMS.b),\t\t\tLMS.g,\t\t\tLMS.b\t\t);\n\t}\n\tif (cbtype > 0.33 && cbtype < 0.66) {\n\t\tlms = vec3(\t\t\t\tLMS.r,\t\t\t(0.494207 * LMS.r) + (1.24827 * LMS.b),\t\t\tLMS.b\t\t);\n\t}\n\tif (cbtype > 0.66) {\n\t\tlms = vec3(\t\t\t\tLMS.r,\t\t\tLMS.g,\t\t\t(-0.395913 * LMS.r) + (0.801109 * LMS.g)\t\t);\n\t}\n\tconst mat3 LMSRGB = mat3(    \t\t0.0809444479, -0.130504409, 0.116721066,\t\t-0.0102485335, 0.0540193266, -0.113614708,\t\t-0.000365296938, -0.00412161469, 0.693511405\t);\n\tvec3 RGB = lms * LMSRGB;\n\tRGB.rgb = color.rgb - RGB.rgb;\n\tRGB.g = 0.7*RGB.r + RGB.g;\n\tRGB.b = 0.7*RGB.r + RGB.b;\n\tcolor.rgb = color.rgb + RGB.rgb;\n\tgl_FragColor = color;\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},type:{title:"Type",type:"enum",uniform:"cbtype",defaultValue:"0.2",options:[["0.0","Off"],["0.2","Protanope"],["0.6","Deuteranope"],["0.8","Tritanope"]]}},title:"Daltonize",description:"Add contrast to colours to assist CVD (colour-blind) users."})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a=[0.2,0.3,0.5,0.8],c=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);b.plugin("directionblur",function(d){var e,f,k={amount:0,angle:0,inputScale:1,resolution:[this.width,this.height],transform:c,projection:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};return{initialize:function(a){a();
(a=this.gl)&&(e=[new b.util.FrameBuffer(a,this.width,this.height),new b.util.FrameBuffer(a,this.width,this.height)])},commonShader:!0,shader:function(a,b){var c=this.gl,c=10<=c.getParameter(c.MAX_VARYING_VECTORS)?"#define USE_VARYINGS":"";f=this.baseShader;b.vertex=[c,"precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 projection;\nuniform mat4 transform;\nvarying vec2 vTexCoord;\nuniform float angle;\nuniform float amount;\nuniform float inputScale;\nconst vec2 zero = vec2(0.0, 0.0);\n#ifdef USE_VARYINGS\nvec2 one;\nvec2 amount1;\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying vec2 vTexCoord3;\nvarying vec2 vTexCoord4;\nvarying vec2 vTexCoord5;\nvarying vec2 vTexCoord6;\nvarying vec2 vTexCoord7;\nvarying vec2 vTexCoord8;\n#else\nvarying vec2 one;\nvarying vec2 amount1;\n#endif\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position = screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tvTexCoord = texCoord;\n\tone = vec2(1.0, 1.0) * inputScale;\n\tif (inputScale < 1.0) {\n\t\tone -= 1.0 / resolution;\n\t}\n\tvTexCoord = max(zero, min(one, texCoord.st * inputScale));\n\tamount1 = vec2(cos(angle), sin(angle)) * amount * 5.0 / resolution;\n#ifdef USE_VARYINGS\n\tvec2 amount2 = amount1 * 3.0;\n\tvec2 amount3 = amount1 * 6.0;\n\tvec2 amount4 = amount1 * 9.0;\n\tvec2 amount5 = -amount1;\n\tvec2 amount6 = amount5 * 3.0;\n\tvec2 amount7 = amount5 * 6.0;\n\tvec2 amount8 = amount5 * 9.0;\n\tvTexCoord1 = max(zero, min(one, vTexCoord + amount1));\n\tvTexCoord2 = max(zero, min(one, vTexCoord + amount2));\n\tvTexCoord3 = max(zero, min(one, vTexCoord + amount3));\n\tvTexCoord4 = max(zero, min(one, vTexCoord + amount4));\n\tvTexCoord5 = max(zero, min(one, vTexCoord + amount5));\n\tvTexCoord6 = max(zero, min(one, vTexCoord + amount6));\n\tvTexCoord7 = max(zero, min(one, vTexCoord + amount7));\n\tvTexCoord8 = max(zero, min(one, vTexCoord + amount8));\n#endif\n}"].join("\n");
b.fragment=[c,"precision mediump float;\n\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float angle;\nuniform float amount;\nuniform float inputScale;\n#ifdef USE_VARYINGS\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying vec2 vTexCoord3;\nvarying vec2 vTexCoord4;\nvarying vec2 vTexCoord5;\nvarying vec2 vTexCoord6;\nvarying vec2 vTexCoord7;\nvarying vec2 vTexCoord8;\n#else\nvarying vec2 amount1;\nvarying vec2 one;\nconst vec2 zero = vec2(0.0, 0.0);\n#endif\nvoid main(void) {\n#ifndef USE_VARYINGS\n\tvec2 vTexCoord1 = max(zero, min(one, vTexCoord + amount1));\n\tvec2 vTexCoord2 = max(zero, min(one, vTexCoord + amount1 * 3.0));\n\tvec2 vTexCoord3 = max(zero, min(one, vTexCoord + amount1 * 6.0));\n\tvec2 vTexCoord4 = max(zero, min(one, vTexCoord + amount1 * 9.0));\n\tvec2 vTexCoord5 = max(zero, min(one, vTexCoord - amount1));\n\tvec2 vTexCoord6 = max(zero, min(one, vTexCoord - amount1 * 3.0));\n\tvec2 vTexCoord7 = max(zero, min(one, vTexCoord - amount1 * 6.0));\n\tvec2 vTexCoord8 = max(zero, min(one, vTexCoord - amount1 * 9.0));\n#endif\n\tgl_FragColor = texture2D(source, vTexCoord) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord1) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord2) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord3) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord4) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord5) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord6) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord7) / 9.0;\n\tgl_FragColor += texture2D(source, vTexCoord8) / 9.0;\n}"].join("\n");
return b},draw:function(b,c,d,h,n){var r,p,v,x,w,B={width:0,height:0,blend:!1},L=1;if(v=this.inputs.amount)if(0.01>=v)n(b,c,d,h);else{k.amount=v;k.angle=this.inputs.angle;k.projection[0]=this.height/this.width;for(d=0;d<a.length;d++)p=Math.min(1,a[d]/v),x=Math.floor(p*this.width),w=Math.floor(p*this.height),k.source=r?r.texture:this.inputs.source.texture,r=e[d%2],k.inputScale=L,L=p,B.width=x,B.height=w,n(b,c,k,r.frameBuffer,null,B);k.source=r.texture;k.inputScale=L;n(b,c,k,h)}else n(f,c,d,h)},resize:function(){k.resolution[0]=
this.width;k.resolution[1]=this.height;e&&(e[0].resize(this.width,this.height),e[1].resize(this.width,this.height))},destroy:function(){e&&(e[0].destroy(),e[1].destroy(),e=null);f&&f.destroy();k=null}}},{inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},amount:{type:"number",uniform:"amount",defaultValue:0.4,min:0,max:1},angle:{type:"number",uniform:"angle",defaultValue:0}},title:"Directional Motion Blur"})});(function(b,a){"object"===typeof exports?a(require("seriously")):"function"===typeof define&&define.amd?define(["seriously"],a):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a={wrap:"pos = mod(pos, 1.0);",clamp:"pos = min(max(pos, 0.0), 1.0);",ignore:"pos = texCoordSource;",color:"gl_FragColor = color;\n\treturn;"},c={none:[0,0,0,0],red:[1,0,0,0],green:[0,1,0,0],blue:[0,0,1,0],alpha:[0,0,0,1],luma:[0.2125,0.7154,0.0721,0],lightness:[1/3,1/3,1/
3,0]};b.plugin("displacement",function(){this.uniforms.resMap=[1,1];this.uniforms.resSource=[1,1];this.uniforms.xVector=c.red;this.uniforms.yVector=c.green;return{shader:function(b,c){var f=a[b.fillMode];c.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform vec2 resSource;\nuniform vec2 resMap;\nvarying vec2 texCoordSource;\nvarying vec2 texCoordMap;\nconst vec2 HALF = vec2(0.5);\nvoid main(void) {\n\tgl_Position = position;\n\tvec2 adjusted = (texCoord - HALF) * resolution;\n\ttexCoordSource = adjusted / resSource + HALF;\n\ttexCoordMap = adjusted / resMap + HALF;\n}";
c.fragment=["precision mediump float;\n\nvarying vec2 texCoordSource;\nvarying vec2 texCoordMap;\nuniform sampler2D source;\nuniform sampler2D map;\nuniform float amount;\nuniform float offset;\nuniform vec2 mapScale;\nuniform vec4 color;\nuniform vec4 xVector;\nuniform vec4 yVector;\nvoid main(void) {\n\tvec4 mapPixel = texture2D(map, texCoordMap);\n\tvec2 mapVector = vec2(dot(mapPixel, xVector), dot(mapPixel, yVector));\n\tvec2 pos = texCoordSource + (mapVector.xy - offset) * mapScale * amount;\n\tif (pos.x < 0.0 || pos.x > 1.0 || pos.y < 0.0 || pos.y > 1.0) {",
"\t\t"+f,"\t}\n\tgl_FragColor = texture2D(source, pos);\n}"].join("\n");return c},requires:function(a){return this.inputs.mapScale||"map"!==a?!0:!1},resize:function(){var a=this.inputs.source,b=this.inputs.map;a?(this.uniforms.resSource[0]=a.width,this.uniforms.resSource[1]=a.height):(this.uniforms.resSource[0]=1,this.uniforms.resSource[1]=1);b?(this.uniforms.resMap[0]=b.width,this.uniforms.resMap[1]=b.height):(this.uniforms.resMap[0]=1,this.uniforms.resMap[1]=1)}}},{inputs:{source:{type:"image",
uniform:"source"},map:{type:"image",uniform:"map"},xChannel:{type:"enum",defaultValue:"red",options:"red green blue alpha luma lightness none".split(" "),update:function(a){this.uniforms.xVector=c[a]}},yChannel:{type:"enum",defaultValue:"green",options:"red green blue alpha luma lightness none".split(" "),update:function(a){this.uniforms.yVector=c[a]}},fillMode:{type:"enum",shaderDirty:!0,defaultValue:"color",options:["color","wrap","clamp","ignore"]},color:{type:"color",uniform:"color",defaultValue:[0,
0,0,0]},offset:{type:"number",uniform:"offset",defaultValue:0.5},mapScale:{type:"vector",dimensions:2,uniform:"mapScale",defaultValue:[1,1],updateSources:!0},amount:{type:"number",uniform:"amount",defaultValue:1}},title:"Displacement Map",description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("dither",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\n#define mod4(a) (a >= 4 ? a - 4 : a)\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec2 resolution;\nconst mat4 dither = mat4(1.0, 33.0, 9.0, 41.0,49.0, 17.0, 57.0, 25.0,13.0, 45.0, 5.0, 37.0,61.0, 29.0, 53.0, 21.0);\nfloat find_closest(int x, int y, float c0) {\n\tfloat limit = 0.0;\n\tint x4 = mod4(x);\n\tint y4 = mod4(y);\n\tfor (int i = 0; i < 4; i++) {\n\t\tif (i == x4) {\n\t\t\tfor (int j = 0; j < 4; j++) {\n\t\t\t\tif (j == y4) {\n\t\t\t\t\tlimit = dither[i][j];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tif (x < 4) {\n\t\tif (y >= 4) {\n\t\t\tlimit += 3.0;\n\t\t}\n\t} else {\n\t\tif (y >= 4) {\n\t\t\tlimit += 1.0;\n\t\t} else {\n\t\t\tlimit += 2.0;\n\t\t}\n\t}\n\tlimit /= 65.0;\n\treturn c0 < limit ? 0.0 : 1.0;\n}\nvoid main (void)  {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tvec2 coord = vTexCoord * resolution;\n\tint x = int(mod(coord.x, 8.0));\n\tint y = int(mod(coord.y, 8.0));\n\tpixel.r = find_closest(x, y, pixel.r);\n\tpixel.g = find_closest(x, y, pixel.g);\n\tpixel.b = find_closest(x, y, pixel.b);\n\tgl_FragColor = pixel;\n}";
return b},inPlace:!1,inputs:{source:{type:"image",uniform:"source"}},title:"Dither"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){function a(a,b){var c;for(c=0;c<b.length;c++)b[c]*=a;return b}var c=Math.sqrt,d,e=[],f,k,g;f=[a(1/(2*c(2)),[1,c(2),1,0,0,0,-1,-c(2),-1]),a(1/(2*c(2)),[1,0,-1,c(2),0,-c(2),1,0,-1]),a(1/(2*c(2)),[0,-1,c(2),1,0,-1,-c(2),1,0]),a(1/(2*c(2)),[c(2),-1,0,-1,0,1,0,1,-c(2)]),a(0.5,[0,1,
0,-1,0,-1,0,1,0]),a(0.5,[-1,0,1,0,0,0,1,0,-1]),a(1/6,[1,-2,1,-2,4,-2,1,-2,1]),a(1/6,[-2,1,-2,1,4,1,-2,1,-2]),a(1/3,[1,1,1,1,1,1,1,1,1])];for(c=0;c<f.length;c++)for(d=0;d<f[c].length;d++)e.push(f[c][d]);k=new Float32Array(e);g=new Float32Array([1,2,1,0,0,0,-1,-2,-1,1,0,-1,2,0,-2,1,0,-1]);b.plugin("edge",{initialize:function(a){a();this.uniforms.pixelWidth=1/this.width;this.uniforms.pixelHeight=1/this.height;this.uniforms["G[0]"]="sobel"===this.inputs.mode?g:k},shader:function(a,b){b.fragment=["sobel"===
a.mode?"#define N_MATRICES 2\n#define SOBEL\n":"#define N_MATRICES 9\n","precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float pixelWidth;\nuniform float pixelHeight;\nuniform mat3 G[9];\nvoid main(void) {\n\tmat3 I;\n\tfloat dp3, cnv[9];\n\tvec3 tc;\n\tfloat fi = 0.0, fj = 0.0;\n\tfor (int i = 0; i < 3; i++) {\n\t\tfj = 0.0;\n\t\tfor (int j = 0; j < 3; j++) {\n\t\t\tI[i][j] = length( texture2D(source, vTexCoord + vec2((fi - 1.0) * pixelWidth, (fj - 1.0) * pixelHeight)).rgb );\n\t\t\tfj += 1.0;\n\t\t};\n\t\tfi += 1.0;\n\t};\n\tfor (int i = 0; i < N_MATRICES; i++) {\n\t\tdp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\n\t\tcnv[i] = dp3 * dp3;\n\t};\n#ifdef SOBEL\n\ttc = vec3(0.5 * sqrt(cnv[0]*cnv[0]+cnv[1]*cnv[1]));\n#else\n\tfloat M = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]);\n\tfloat S = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]) + (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + cnv[8];\n\ttc = vec3(sqrt(M/S));\n#endif\n\tgl_FragColor = vec4(tc, 1.0);\n}"].join("\n");
return b},resize:function(){this.uniforms.pixelWidth=1/this.width;this.uniforms.pixelHeight=1/this.height},inputs:{source:{type:"image",uniform:"source"},mode:{type:"enum",shaderDirty:!0,defaultValue:"sobel",options:[["sobel","Sobel"],["frei-chen","Frei-Chen"]],update:function(){this.uniforms["G[0]"]="sobel"===this.inputs.mode?g:k}}},description:"Edge Detect",title:"Edge Detect"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("emboss",{commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.w = screenPosition.w;\n\tvec2 offset = 1.0 / resolution;\n\tvTexCoord1 = texCoord - offset;\n\tvTexCoord2 = texCoord + offset;\n}";
b.fragment="precision mediump float;\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nuniform sampler2D source;\nuniform float amount;\nconst vec3 average = vec3(1.0 / 3.0);\nvoid main (void)  {\n\tvec4 pixel = vec4(0.5, 0.5, 0.5, 1.0);\n\tpixel -= texture2D(source, vTexCoord1) * amount;\n\tpixel += texture2D(source, vTexCoord2) * amount;\n\tpixel.rgb = vec3(dot(pixel.rgb, average));\n\tgl_FragColor = pixel;\n}";return b},inputs:{source:{type:"image",uniform:"source"},amount:{type:"number",uniform:"amount",
defaultValue:1,min:-85,max:85}},title:"Emboss",categories:[],description:"Emboss"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("exposure",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float exposure;\nvoid main (void)  {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tgl_FragColor = vec4(pow(2.0, exposure) * pixel.rgb, pixel.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},exposure:{type:"number",uniform:"exposure",defaultValue:1,min:-8,max:8}},title:"Exposure",categories:["film"],description:"Exposure control"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("fader",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec4 color;\nuniform float amount;\nvoid main(void) {\n\tgl_FragColor = texture2D(source, vTexCoord);\n\tgl_FragColor = mix(gl_FragColor, color, amount);\n}";
return b},requires:function(a,b){return 1>b.amount},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},color:{type:"color",uniform:"color",defaultValue:[0,0,0,1]},amount:{type:"number",uniform:"amount",defaultValue:0.5,min:0,max:1}},title:"Fader",description:"Fade image to a color"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("falsecolor",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float amount;\nuniform vec4 black;\nuniform vec4 white;\nconst vec3 luma = vec3(0.2125, 0.7154, 0.0721);\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tfloat luminance = dot(pixel.rgb, luma);\n\tvec4 result = mix(black, white, luminance);\n\tgl_FragColor = vec4(result.rgb, pixel.a * result.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},black:{type:"color",uniform:"black",defaultValue:[0,0,0.5,1]},white:{type:"color",uniform:"white",defaultValue:[1,0,0,1]}},title:"False Color"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("filmgrain",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec2 resolution;\nuniform float time;\nuniform float amount;\nuniform bool colored;\nfloat timer;\nconst float permTexUnit = 1.0/256.0;\nconst float permTexUnitHalf = 0.5/256.0;\nvec4 rnm(in vec2 tc) {\n\tfloat noise = sin(dot(tc + vec2(timer,timer),vec2(12.9898,78.233))) * 43758.5453;\n\tfloat noiseR = fract(noise)*2.0-1.0;\n\tfloat noiseG = fract(noise*1.2154)*2.0-1.0; \n\tfloat noiseB = fract(noise*1.3453)*2.0-1.0;\n\tfloat noiseA = fract(noise*1.3647)*2.0-1.0;\n\t\n\treturn vec4(noiseR,noiseG,noiseB,noiseA);\n}\nfloat fade(in float t) {\n\treturn t*t*t*(t*(t*6.0-15.0)+10.0);\n}\nfloat pnoise3D(in vec3 p) {\n\tvec3 pi = permTexUnit*floor(p)+permTexUnitHalf;\n\tvec3 pf = fract(p);\n\tfloat perm00 = rnm(pi.xy).a ;\n\tvec3 grad000 = rnm(vec2(perm00, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n000 = dot(grad000, pf);\n\tvec3 grad001 = rnm(vec2(perm00, pi.z + permTexUnit)).rgb * 4.0 - 1.0;\n\tfloat n001 = dot(grad001, pf - vec3(0.0, 0.0, 1.0));\n\tfloat perm01 = rnm(pi.xy + vec2(0.0, permTexUnit)).a ;\n\tvec3 grad010 = rnm(vec2(perm01, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n010 = dot(grad010, pf - vec3(0.0, 1.0, 0.0));\n\tvec3 grad011 = rnm(vec2(perm01, pi.z + permTexUnit)).rgb * 4.0 - 1.0;\n\tfloat n011 = dot(grad011, pf - vec3(0.0, 1.0, 1.0));\n\tfloat perm10 = rnm(pi.xy + vec2(permTexUnit, 0.0)).a ;\n\tvec3 grad100 = rnm(vec2(perm10, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n100 = dot(grad100, pf - vec3(1.0, 0.0, 0.0));\n\tvec3 grad101 = rnm(vec2(perm10, pi.z + permTexUnit)).rgb * 4.0 - 1.0;\n\tfloat n101 = dot(grad101, pf - vec3(1.0, 0.0, 1.0));\n\tfloat perm11 = rnm(pi.xy + vec2(permTexUnit, permTexUnit)).a ;\n\tvec3 grad110 = rnm(vec2(perm11, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n110 = dot(grad110, pf - vec3(1.0, 1.0, 0.0));\n\tvec3 grad111 = rnm(vec2(perm11, pi.z + permTexUnit)).rgb * 4.0 - 1.0;\n\tfloat n111 = dot(grad111, pf - vec3(1.0, 1.0, 1.0));\n\tvec4 n_x = mix(vec4(n000, n001, n010, n011), vec4(n100, n101, n110, n111), fade(pf.x));\n\tvec2 n_xy = mix(n_x.xy, n_x.zw, fade(pf.y));\n\tfloat n_xyz = mix(n_xy.x, n_xy.y, fade(pf.z));\n\treturn n_xyz;\n}\nvoid main(void) {\n\ttimer = mod(time, 10000.0) / 10000.0;\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tvec3 noise = vec3(pnoise3D(vec3(vTexCoord * resolution, timer + 0.0)));\n\tif (colored) {\n\t\tnoise.g = pnoise3D(vec3(vTexCoord * resolution, timer + 1.0));\n\t\tnoise.b = pnoise3D(vec3(vTexCoord * resolution, timer + 2.0));\n\t}\n\tgl_FragColor = vec4(pixel.rgb + noise * amount, pixel.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},time:{type:"number",uniform:"time"},amount:{type:"number",uniform:"amount",min:0,max:1,defaultValue:0.03},colored:{type:"boolean",uniform:"colored",defaultValue:!1}},title:"Film Grain",description:"Don't over-do it."})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("freeze",{draw:function(a,b,d,e,f){this.inputs.frozen||f(a,b,d,e)},requires:function(){return!this.inputs.frozen},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},frozen:{type:"boolean",defaultValue:!1,updateSources:!0}},title:"Freeze",description:"Freeze Frame"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("fxaa",{commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 transform;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoordNW;\nvarying vec2 vTexCoordNE;\nvarying vec2 vTexCoordSW;\nvarying vec2 vTexCoordSE;\nconst vec2 diag = vec2(1.0, -1.0);\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.w = screenPosition.w;\n\tvTexCoord = texCoord;\n\tvec2 invRes = 1.0 / resolution;\n\tvTexCoordNW = texCoord - invRes;\n\tvTexCoordNE = texCoord + invRes * diag;\n\tvTexCoordSW = texCoord - invRes * diag;\n\tvTexCoordSE = texCoord + invRes;\n}\n";
b.fragment="precision mediump float;\n#define FXAA_REDUCE_MIN (1.0 / 128.0)\n#define FXAA_REDUCE_MUL (1.0 / 8.0)\n#define FXAA_SPAN_MAX 8.0\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoordNW;\nvarying vec2 vTexCoordNE;\nvarying vec2 vTexCoordSW;\nvarying vec2 vTexCoordSE;\nuniform vec2 resolution;\nuniform sampler2D source;\nconst vec3 luma = vec3(0.299, 0.587, 0.114);\nvoid main(void) {\n\tvec4 original = texture2D(source, vTexCoord);\n\tvec3 rgbNW = texture2D(source, vTexCoordNW).rgb;\n\tvec3 rgbNE = texture2D(source, vTexCoordNE).rgb;\n\tvec3 rgbSW = texture2D(source, vTexCoordSW).rgb;\n\tvec3 rgbSE = texture2D(source, vTexCoordSE).rgb;\n\tfloat lumaNW = dot(rgbNW, luma);\n\tfloat lumaNE = dot(rgbNE, luma);\n\tfloat lumaSW = dot(rgbSW, luma);\n\tfloat lumaSE = dot(rgbSE, luma);\n\tfloat lumaM = dot(original.rgb, luma);\n\tfloat lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n\tfloat lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\tvec2 dir = vec2(-((lumaNW + lumaNE) - (lumaSW + lumaSE)), ((lumaNW + lumaSW) - (lumaNE + lumaSE)));\n\tfloat dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * 0.25 * FXAA_REDUCE_MUL, FXAA_REDUCE_MIN);\n\tfloat rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n\tdir = min(vec2(FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX), dir * rcpDirMin)) / resolution;\n\tvec3 rgbA = 0.5 * (\n\t\ttexture2D(source, vTexCoord + dir * (1.0 / 3.0 - 0.5)).rgb +\n\t\ttexture2D(source, vTexCoord + dir * (2.0 / 3.0 - 0.5)).rgb);\n\tvec3 rgbB = rgbA * 0.5 + 0.25 * (\n\t\ttexture2D(source, vTexCoord - dir * 0.5).rgb +\n\t\ttexture2D(source, vTexCoord + dir * 0.5).rgb);\n\tfloat lumaB = dot(rgbB, luma);\n\tif (lumaB < lumaMin || lumaB > lumaMax) {\n\t\tgl_FragColor = vec4(rgbA, original.a);\n\t} else {\n\t\tgl_FragColor = vec4(rgbB, original.a);\n\t}\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1}},title:"FXAA",description:"Fast approximate anti-aliasing"})});(function(b,a){"object"===typeof exports?a(require("seriously")):"function"===typeof define&&define.amd?define(["seriously"],a):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("gradientwipe",function(){this.uniforms.resGradient=[1,1];this.uniforms.resSource=[1,1];return{shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform vec2 resSource;\nuniform vec2 resGradient;\nvarying vec2 texCoordSource;\nvarying vec2 texCoordGradient;\nconst vec2 HALF = vec2(0.5);\nvoid main(void) {\n\tgl_Position = position;\n\tvec2 adjusted = (texCoord - HALF) * resolution;\n\ttexCoordSource = adjusted / resSource + HALF;\n\ttexCoordGradient = adjusted / resGradient + HALF;\n}";
b.fragment="precision mediump float;\n\nvarying vec2 texCoordSource;\nvarying vec2 texCoordGradient;\nuniform sampler2D source;\nuniform sampler2D gradient;\nuniform float transition;\nuniform float smoothness;\nuniform bool invert;\nconst vec3 lumcoeff = vec3(0.2125,0.7154,0.0721);\nvoid main(void) {\n\tfloat gradientVal = 1.0 - dot(texture2D(gradient, texCoordGradient).rgb, lumcoeff);\n\tif (invert) {\n\t\tgradientVal = 1.0 - gradientVal;\n\t}\n\tfloat amount = 1.0 - transition;\n\tfloat mn = (amount - smoothness * (1.0 - amount));\n\tfloat mx = (amount + smoothness * amount);\n\tif (gradientVal <= mn) {\n\t\tgl_FragColor = texture2D(source, texCoordSource);\n\t\treturn;\n\t}\n\tif (gradientVal >= mx) {\n\t\tgl_FragColor = vec4(0.0);\n\t\treturn;\n\t}\n\tfloat alpha = mix(1.0, 0.0, smoothstep(mn, mx, gradientVal));\n\tvec4 pixel = texture2D(source, texCoordSource);\n\tgl_FragColor = vec4(pixel.rgb, pixel.a * alpha);\n}";
return b},draw:function(a,b,d,e,f){0>=d.transition?f(this.baseShader,b,d,e):1<=d.transition?(a=this.gl,a.viewport(0,0,this.width,this.height),a.bindFramebuffer(a.FRAMEBUFFER,e),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)):f(a,b,d,e)},inPlace:!1,requires:function(a,b){return"source"===a&&1<=b.transition||"gradient"===a&&(0>=b.transition||1<=b.transition)?!1:!0},resize:function(){var a=this.inputs.source,b=this.inputs.gradient;a?(this.uniforms.resSource[0]=a.width,this.uniforms.resSource[1]=
a.height):(this.uniforms.resSource[0]=1,this.uniforms.resSource[1]=1);b?(this.uniforms.resGradient[0]=b.width,this.uniforms.resGradient[1]=b.height):(this.uniforms.resGradient[0]=1,this.uniforms.resGradient[1]=1)}}},{inputs:{source:{type:"image",uniform:"source"},gradient:{type:"image",uniform:"gradient"},transition:{type:"number",uniform:"transition",defaultValue:0},invert:{type:"boolean",uniform:"invert",defaultValue:!1},smoothness:{type:"number",uniform:"smoothness",defaultValue:0,min:0,max:1}},
title:"Gradient Wipe"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("hex",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\n\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec2 resolution;\nuniform vec2 center;\nuniform float size;\nvoid main(void) {\n\tvec2 aspect = normalize(resolution);\n\tvec2 tex = (vTexCoord * aspect - center) / size;\n\ttex.y /= 0.866025404;\n\ttex.x -= tex.y * 0.5;\n\tvec2 a;\n\tif (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {\n\t\ta = vec2(floor(tex.x), floor(tex.y));\n\t} else {\n\t\ta = vec2(ceil(tex.x), ceil(tex.y));\n\t}\n\tvec2 b = vec2(ceil(tex.x), floor(tex.y));\n\tvec2 c = vec2(floor(tex.x), ceil(tex.y));\n\tvec3 tex3 = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);\n\tvec3 a3 = vec3(a.x, a.y, 1.0 - a.x - a.y);\n\tvec3 b3 = vec3(b.x, b.y, 1.0 - b.x - b.y);\n\tvec3 c3 = vec3(c.x, c.y, 1.0 - c.x - c.y);\n\tfloat alen =length(tex3 - a3);\n\tfloat blen =length(tex3 - b3);\n\tfloat clen =length(tex3 - c3);\n\tvec2 choice;\n\tif (alen < blen) {\n\t\tif (alen < clen) {\n\t\t\tchoice = a;\n\t\t} else {\n\t\t\tchoice = c;\n\t\t}\n\t} else {\n\t\tif (blen < clen) {\n\t\t\tchoice = b;\n\t\t} else {\n\t\t\tchoice = c;\n\t\t}\n\t}\n\tchoice.x += choice.y * 0.5;\n\tchoice.y *= 0.866025404;\n\tchoice *= size / aspect;\n\tgl_FragColor = texture2D(source, choice + center / aspect);\n}";
return b},inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},size:{type:"number",uniform:"size",min:0,max:0.4,defaultValue:0.01},center:{type:"vector",uniform:"center",dimensions:2,defaultValue:[0,0]}},title:"Hex",description:"Hexagonal Pixelate"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("highlights-shadows",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float shadows;\nuniform float highlights;\nconst vec3 luma = vec3(0.2125, 0.7154, 0.0721);\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tfloat luminance = dot(pixel.rgb, luma);\n\tfloat shadow = clamp((pow(luminance, 1.0 / (shadows + 1.0)) + (-0.76) * pow(luminance, 2.0 / (shadows + 1.0))) - luminance, 0.0, 1.0);\n\tfloat highlight = clamp((1.0 - (pow(1.0 - luminance, 1.0 / (2.0 - highlights)) + (-0.8) * pow(1.0 - luminance, 2.0 / (2.0 - highlights)))) - luminance, -1.0, 0.0);\n\tvec3 rgb = (luminance + shadow + highlight) * (pixel.rgb / vec3(luminance));\n\tgl_FragColor = vec4(rgb, pixel.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},highlights:{type:"number",uniform:"highlights",min:0,max:1,defaultValue:1},shadows:{type:"number",uniform:"shadows",min:0,max:1,defaultValue:0}},title:"Highlights/Shadows",description:"Darken highlights, lighten shadows"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("hue-saturation",{commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform mat4 projection;\nuniform mat4 transform;\nuniform float hue;\nuniform float saturation;\nvarying vec2 vTexCoord;\nvarying vec3 weights;\nvoid main(void) {\n\tfloat angle = hue * 3.14159265358979323846264;\n\tfloat s = sin(angle);\n\tfloat c = cos(angle);\n\tweights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position = screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tvTexCoord = texCoord;\n}";
b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nvarying vec3 weights;\nuniform sampler2D source;\nuniform float hue;\nuniform float saturation;\nvoid main(void) {\n\tvec4 color = texture2D(source, vTexCoord);\n\tfloat len = length(color.rgb);\n\tcolor.rgb = vec3(dot(color.rgb, weights.xyz), dot(color.rgb, weights.zxy), dot(color.rgb, weights.yzx) );\n\tvec3 adjustment = (color.r + color.g + color.b) / 3.0 - color.rgb;\n\tif (saturation > 0.0) {\n\t\tadjustment *= (1.0 - 1.0 / (1.0 - saturation));\n\t} else {\n\t\tadjustment *= (-saturation);\n\t}\n\tcolor.rgb += adjustment;\n\tgl_FragColor = color;\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},hue:{type:"number",uniform:"hue",defaultValue:0.4,min:-1,max:1},saturation:{type:"number",uniform:"saturation",defaultValue:0,min:-1,max:1}},title:"Hue/Saturation",description:"Rotate hue and multiply saturation."})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("invert",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nvoid main(void) {\n\tgl_FragColor = texture2D(source, vTexCoord);\n\tgl_FragColor = vec4(1.0 - gl_FragColor.rgb, gl_FragColor.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1}},title:"Invert",description:"Invert image color"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("kaleidoscope",{commonShader:!0,shader:function(a,b){b.fragment=["precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float segments;\nuniform float offset;","const float PI = "+Math.PI+";","const float TAU = 2.0 * PI;\nvoid main(void) {\n\tif (segments == 0.0) {\n\t\tgl_FragColor = texture2D(source, vTexCoord);\n\t} else {\n\t\tvec2 centered = vTexCoord - 0.5;\n\t\tfloat r = length(centered);\n\t\tfloat theta = atan(centered.y, centered.x);\n\t\ttheta = mod(theta, TAU / segments);\n\t\ttheta = abs(theta - PI / segments);\n\t\tvec2 newCoords = r * vec2(cos(theta), sin(theta)) + 0.5;\n\t\tgl_FragColor = texture2D(source, mod(newCoords - offset, 1.0));\n\t}\n}"].join("\n");
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},segments:{type:"number",uniform:"segments",defaultValue:6},offset:{type:"number",uniform:"offset",defaultValue:0}},title:"Kaleidoscope"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),c=/\d+/;b.plugin("layers",function(b){function e(){k.resize()}var f,k=this,g={clear:!1},l;"number"===typeof b&&2<=b?f=b:(f=b&&b.count||4,f=Math.max(2,f));l={sizeMode:{type:"enum",defaultValue:"0",options:["union","intersection"],
update:function(){this.resize()}}};for(b=0;b<f;b++)l.sizeMode.options.push(b.toString()),l.sizeMode.options.push("source"+b),l["source"+b]={type:"image",update:e},l["opacity"+b]={type:"number",defaultValue:1,min:0,max:1,updateSources:!0};this.uniforms.layerResolution=[1,1];this.resize=function(){var a,b;a=this.inputs.sizeMode;var d,e;if("union"===a)for(d=b=a=0;d<f;d++){if(e=this.inputs["source"+d])a=Math.max(a,e.width),b=Math.max(b,e.height)}else if("intersection"===a)for(b=a=Infinity,d=0;d<f;d++){if(e=
this.inputs["source"+d])a=Math.min(a,e.width),b=Math.min(b,e.height)}else if(b=a=1,d=f-1,(e=c.exec(this.inputs.sizeMode))&&(d=Math.min(parseInt(e[0],10),d)),e=this.inputs["source"+d])a=e.width,b=e.height;if(this.width!==a||this.height!==b)for(this.width=a,this.height=b,this.uniforms.resolution[0]=a,this.uniforms.resolution[1]=b,this.frameBuffer&&this.frameBuffer.resize(a,b),this.emit("resize"),this.setDirty(),d=0;d<this.targets.length;d++)this.targets[d].resize()};return{initialize:function(a){var b=
this.gl;a();g.blendEquation=b.FUNC_ADD;g.srcRGB=b.SRC_ALPHA;g.dstRGB=b.ONE_MINUS_SRC_ALPHA;g.srcAlpha=b.SRC_ALPHA;g.dstAlpha=b.DST_ALPHA},commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform vec2 layerResolution;\nuniform mat4 transform;\nvarying vec2 vTexCoord;\nvoid main(void) {\n\tvec4 screenPosition = vec4(position.xy * layerResolution / 2.0, position.z, position.w);\n\tscreenPosition = transform * screenPosition;\n\tgl_Position.xy = screenPosition.xy * 2.0 / layerResolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (layerResolution.x / layerResolution.y);\n\tgl_Position.xy *= layerResolution / resolution;\n\tgl_Position.w = screenPosition.w;\n\tvTexCoord = texCoord;\n}\n";
b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float opacity;\nvoid main(void) {\n\tif (any(lessThan(vTexCoord, vec2(0.0))) || any(greaterThanEqual(vTexCoord, vec2(1.0)))) {\n\t\tgl_FragColor = vec4(0.0);\n\t} else {\n\t\tgl_FragColor = texture2D(source, vTexCoord);\n\t\tgl_FragColor *= opacity;\n\t}\n}";return b},requires:function(a,b){var d,e=f;(d=c.exec(this.inputs.sizeMode))&&(e=parseInt(d[0],10));return e>=f?!1:!(!b[a]||!b["opacity"+e])},draw:function(b,
c,d,e,k){var l,x,w;l=this.gl;l.viewport(0,0,this.width,this.height);l.bindFramebuffer(l.FRAMEBUFFER,e);l.clearColor(0,0,0,0);l.clear(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT);for(l=0;l<f;l++)w=this.inputs["source"+l],x=this.inputs["opacity"+l],w&&x&&(d.opacity=x,d.layerResolution[0]=w.width,d.layerResolution[1]=w.height,d.source=w,d.transform=w.cumulativeMatrix||a,k(b,c,d,e,null,g))},inputs:l}},{inPlace:!0,description:"Multiple layers",title:"Layers"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("linear-transfer",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec4 slope;\nuniform vec4 intercept;\nconst vec3 half3 = vec3(0.5);\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tgl_FragColor = pixel * slope + intercept;\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},slope:{type:"vector",dimensions:4,uniform:"slope",defaultValue:[1,1,1,1]},intercept:{type:"vector",uniform:"intercept",dimensions:4,defaultValue:[0,0,0,0]}},title:"Linear Transfer",description:"For each color channel: [slope] * [value] + [intercept]"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("lumakey",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float threshold;\nuniform float clipBlack;\nuniform float clipWhite;\nuniform bool invert;\nconst vec3 lumcoeff = vec3(0.2125,0.7154,0.0721);\nvoid main (void)  {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tfloat luma = dot(pixel.rgb,lumcoeff);\n\tfloat alpha = 1.0 - smoothstep(clipBlack, clipWhite, luma);\n\tif (invert) alpha = 1.0 - alpha;\n\tgl_FragColor = vec4(pixel.rgb, min(pixel.a, alpha) );\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},clipBlack:{type:"number",uniform:"clipBlack",defaultValue:0.9,min:0,max:1},clipWhite:{type:"number",uniform:"clipWhite",defaultValue:1,min:0,max:1},invert:{type:"boolean",uniform:"invert",defaultValue:!1}},title:"Luma Key",categories:["key"],description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("mirror",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nuniform vec2 resolution;\nuniform sampler2D source;\nvarying vec2 vTexCoord;\nvoid main(void) {\n\tgl_FragColor = texture2D(source, vec2(0.5 - abs(0.5 - vTexCoord.x), vTexCoord.y));\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"}},title:"Mirror",description:"Shader Mirror Effect"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("nightvision",{commonShader:!0,shader:function(a,b,d){b.fragment=["precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float timer;\nuniform float luminanceThreshold;\nuniform float amplification;\nuniform vec3 nightVisionColor;",d.shader.makeNoise,
"void main(void) {\n\tvec3 noise = vec3(makeNoise(vTexCoord.x, vTexCoord.y, timer), makeNoise(vTexCoord.x, vTexCoord.y, timer * 200.0 + 1.0), makeNoise(vTexCoord.x, vTexCoord.y, timer * 100.0 + 3.0));\n\tvec4 pixel = texture2D(source, vTexCoord + noise.xy * 0.0025);\n\tfloat luminance = dot(vec3(0.299, 0.587, 0.114), pixel.rgb);\n\tpixel.rgb *= step(luminanceThreshold, luminance) * amplification;\n\tgl_FragColor = vec4( (pixel.rgb + noise * 0.1) * nightVisionColor, pixel.a);\n}"].join("\n");return b},
inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},timer:{type:"number",uniform:"timer",defaultValue:0},luminanceThreshold:{type:"number",uniform:"luminanceThreshold",defaultValue:0.1,min:0,max:1},amplification:{type:"number",uniform:"amplification",defaultValue:1.4,min:0},color:{type:"color",uniform:"nightVisionColor",defaultValue:[0.1,0.95,0.2]}},title:"Night Vision",description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("noise",{shader:function(a,b,d){d=["precision mediump float;","#define Blend(base, blend, funcf)\t\tvec3(funcf(base.r, blend.r), funcf(base.g, blend.g), funcf(base.b, blend.b))","#define BlendOverlayf(base, blend) (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))",
"#define BlendOverlay(base, blend)\t\tBlend(base, blend, BlendOverlayf)","varying vec2 vTexCoord;","uniform sampler2D source;","uniform vec2 resolution;","uniform float amount;","uniform float timer;",d.shader.noiseHelpers,d.shader.snoise3d,d.shader.random,"void main(void) {","\tvec4 pixel = texture2D(source, vTexCoord);","\tfloat r = random(vec2(timer * vTexCoord.xy));","\tfloat noise = snoise(vec3(vTexCoord * (1024.4 + r * 512.0), timer)) * 0.5;"];a.overlay?(d.push("\tvec3 overlay = BlendOverlay(pixel.rgb, vec3(noise));"),
d.push("\tpixel.rgb = mix(pixel.rgb, overlay, amount);")):d.push("\tpixel.rgb += noise * amount;");d.push("\tgl_FragColor = pixel;}");b.fragment=d.join("\n");return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},overlay:{type:"boolean",shaderDirty:!0,defaultValue:!0},amount:{type:"number",uniform:"amount",min:0,max:1,defaultValue:1},timer:{type:"number",uniform:"timer",defaultValue:0,step:1}},title:"Noise",description:"Add noise"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("panorama",function(){function a(){b.resize()}var b=this;this.resize=function(){var a=this.width,e=this.height,f=b.inputs.source;this.source?(a=this.source.width,e=this.source.height):this.sources&&this.sources.source?(a=this.sources.source.width,e=this.sources.source.height):
e=a=1;b.inputs.width?(a=b.inputs.width,b.inputs.height?e=b.inputs.height:f&&(e=a*f.height/f.width)):b.inputs.height&&(e=b.inputs.height,f&&(a=e*f.width/f.height));a=Math.floor(a);e=Math.floor(e);f&&(this.uniforms.resolution[0]=a,this.uniforms.resolution[1]=e);if(this.width!==a||this.height!==e)this.width=a,this.height=e,this.frameBuffer&&this.frameBuffer.resize(this.width,this.height),this.emit("resize"),this.setDirty();for(a=0;a<this.targets.length;a++)this.targets[a].resize()};return{shader:function(a,
b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform vec2 resolution;\nuniform sampler2D source;\nuniform float fov;\nuniform float yaw;\nuniform float pitch;\nconst float M_PI = 3.141592653589793238462643;\nconst float M_TWOPI = 6.283185307179586476925286;\nmat3 rotationMatrix(vec2 euler) {\n\tvec2 se = sin(euler);\n\tvec2 ce = cos(euler);\n\treturn mat3(ce.x, 0, -se.x, 0, 1, 0, se.x, 0, ce.x) * \n\t\t\tmat3(1, 0, 0, 0, ce.y, -se.y, 0, se.y, ce.y);\n}\nvec3 toCartesian( vec2 st ) {\n\treturn normalize(vec3(st.x, st.y, 0.5 / tan(0.5 * radians(fov))));\n}\nvec2 toSpherical(vec3 cartesianCoord) {\n\tvec2 st = vec2(\n\t\tatan(cartesianCoord.x, cartesianCoord.z),\n\t\tacos(cartesianCoord.y)\n\t);\n\tif(st.x < 0.0)\n\t\tst.x += M_TWOPI;\n\treturn st;\n}\nvoid main(void) {\n\tvec2 sphericalCoord = gl_FragCoord.xy / resolution - vec2(0.5);\n\tsphericalCoord.y *= -resolution.y / resolution.x;\n\tvec3 cartesianCoord = rotationMatrix(radians(vec2(yaw + 180., -pitch))) * toCartesian(sphericalCoord);\n\tgl_FragColor = texture2D(source, toSpherical( cartesianCoord )/vec2(M_TWOPI, M_PI));\n}";
return b},inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},width:{type:"number",min:0,step:1,update:a,defaultValue:640},height:{type:"number",min:0,step:1,update:a,defaultValue:360},yaw:{type:"number",uniform:"yaw",min:0,max:360,defaultValue:0},fov:{type:"number",uniform:"fov",min:0,max:180,defaultValue:80},pitch:{type:"number",uniform:"pitch",min:-90,max:90,defaultValue:0}}}},{commonShader:!0,title:"Panorama"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("pixelate",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec2 resolution;\nuniform vec2 pixelSize;\nvoid main(void) {\n\tvec2 delta = pixelSize / resolution;\n\tgl_FragColor = texture2D(source, delta * floor(vTexCoord / delta));\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},pixelSize:{type:"vector",dimensions:2,defaultValue:[8,8],min:0,uniform:"pixelSize"}},title:"Pixelate"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("polar",{commonShader:!0,shader:function(a,b){b.fragment=["precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float angle;","const float PI = "+Math.PI+";","void main(void) {\n\tvec2 norm = (1.0 - vTexCoord) * 2.0 - 1.0;\n\tfloat theta = mod(PI + atan(norm.x, norm.y) - angle * (PI / 180.0), PI * 2.0);\n\tvec2 polar = vec2(theta / (2.0 * PI), length(norm));\n\tgl_FragColor = texture2D(source, polar);\n}"].join("\n");
return b},inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},angle:{type:"number",uniform:"angle",defaultValue:0}},title:"Polar Coordinates",description:"Convert cartesian to polar coordinates"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("ripple",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float wave;\nuniform float distortion;\nuniform vec2 center;\nvoid main(void) {\n\tfloat scalar = abs(1.0 - abs(distance(vTexCoord, center)));\n\tfloat sinOffset = sin(wave / scalar);\n\tsinOffset = clamp(sinOffset, 0.0, 1.0);\n\tfloat sinSign = cos(wave / scalar);\n\tsinOffset = sinOffset * distortion / 32.0;\n\tgl_FragColor = texture2D(source, vTexCoord + sinOffset * sinSign);\n}";
return b},inPlace:!1,inputs:{source:{type:"image",uniform:"source"},wave:{type:"number",uniform:"wave",defaultValue:Math.PI/0.75},distortion:{type:"number",uniform:"distortion",defaultValue:1},center:{type:"vector",uniform:"center",dimensions:2,defaultValue:[0.5,0.5]}},title:"Ripple Distortion",description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("scanlines",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float lines;\nuniform float width;\nuniform float intensity;\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tfloat darken = 2.0 * abs( fract(vTexCoord.y * lines / 2.0) - 0.5);\n\tdarken = clamp(darken - width + 0.5, 0.0, 1.0);\n\tdarken = 1.0 - ((1.0 - darken) * intensity);\n\tgl_FragColor = vec4(pixel.rgb * darken, 1.0);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},lines:{type:"number",uniform:"lines",defaultValue:60},size:{type:"number",uniform:"size",defaultValue:0.2,min:0,max:1},intensity:{type:"number",uniform:"intensity",defaultValue:0.1,min:0,max:1}},title:"Scan Lines",description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a=/\d+/;b.plugin("select",function(b){function d(){k.resize()}function e(){var a;a=k.inputs["source"+k.inputs.active];k.texture=a&&a.texture;d()}var f,k=this,g;"number"===typeof b&&2<=b?f=b:(f=b&&b.count||4,f=Math.max(2,f));g={active:{type:"number",step:1,min:0,max:f-1,defaultValue:0,
update:e,updateSources:!0},sizeMode:{type:"enum",defaultValue:"0",options:["union","intersection","active"],update:d}};for(b=0;b<f;b++)g.sizeMode.options.push(b.toString()),g.sizeMode.options.push("source"+b),g["source"+b]={type:"image",update:e};this.uniforms.layerResolution=[1,1];this.resize=function(){var b,c;b=this.inputs.sizeMode;var d,e,g;if("union"===b)for(d=c=b=0;d<f;d++){if(g=this.inputs["source"+d])b=Math.max(b,g.width),c=Math.max(c,g.height)}else if("intersection"===b)for(c=b=Infinity,
d=0;d<f;d++){if(g=this.inputs["source"+d])b=Math.min(b,g.width),c=Math.min(c,g.height)}else if("active"===b)d=this.inputs.active,g=this.inputs["source"+d],b=Math.max(1,g&&g.width||1),c=Math.max(1,g&&g.height||1);else for(c=b=1,e=f-1,(d=a.exec(this.inputs.sizeMode))&&(e=Math.min(parseInt(d[0],10),e)),d=0;d<=e;d++)if(g=this.inputs["source"+d]){b=g.width;c=g.height;break}if(this.width!==b||this.height!==c)this.width=b,this.height=c,this.emit("resize"),this.setDirty();for(d=0;d<this.targets.length;d++)this.targets[d].resize()};
return{initialize:function(){this.initialized=!0;this.shaderDirty=!1},requires:function(a){return!(!this.inputs[a]||a!=="source"+this.inputs.active)},draw:function(){var a;a=k.inputs["source"+k.inputs.active];k.texture=a&&a.texture},inputs:g}},{title:"Select",description:"Select a single source image from a list of source nodes.",inPlace:!1,commonShader:!0})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("sepia",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec4 light;\nuniform vec4 dark;\nuniform float desat;\nuniform float toned;\nconst mat4 coeff = mat4(0.393, 0.349, 0.272, 1.0,0.796, 0.686, 0.534, 1.0, 0.189, 0.168, 0.131, 1.0, 0.0, 0.0, 0.0, 1.0 );\nvoid main(void) {\n\tvec4 sourcePixel = texture2D(source, vTexCoord);\n\tgl_FragColor = coeff * sourcePixel;\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"}},title:"Sepia",description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("simplex",function(){function a(){b.resize()}var b=this;return{shader:function(a,b,c){function k(a){return 0===a-Math.floor(a)?a+".0":a}var g=1,l=1,m=0;b.fragment=["precision mediump float;\nvarying vec2 vTexCoord;\nuniform float amount;\nuniform vec2 noiseScale;\nuniform vec2 noiseOffset;\nuniform float time;\nuniform vec4 black;\nuniform vec4 white;",
c.shader.noiseHelpers,c.shader.snoise3d,"void main(void) {\n\tfloat total = 0.0;\n\tvec3 pos = vec3(vTexCoord.xy * noiseScale + noiseOffset, time);"].join("\n");for(c=0;c<a.octaves;c++)g=Math.pow(2,c),l=Math.pow(a.persistence,c),m+=l,b.fragment+="\ttotal += snoise(pos * "+k(g)+") * "+k(l)+";\n";b.fragment+=["\ttotal *= amount / "+k(m)+";","\ttotal = (total + 1.0)/ 2.0;\n\tgl_FragColor = mix(black, white, total);\n}"].join("\n");return b},inputs:{noiseScale:{type:"vector",dimensions:2,uniform:"noiseScale",
defaultValue:[1,1]},noiseOffset:{type:"vector",dimensions:2,uniform:"noiseOffset",defaultValue:[0,0]},octaves:{type:"number",shaderDirty:!0,min:1,max:8,step:1,defaultValue:1},persistence:{type:"number",defaultValue:0.5,min:0,max:0.5},amount:{type:"number",uniform:"amount",min:0,defaultValue:1},time:{type:"number",uniform:"time",defaultValue:0},width:{type:"number",min:0,step:1,update:a,defaultValue:0},height:{type:"number",min:0,step:1,update:a,defaultValue:0},black:{type:"color",uniform:"black",
defaultValue:[0,0,0,1]},white:{type:"color",uniform:"white",defaultValue:[1,1,1,1]}}}},{title:"Simplex Noise",description:"Generate Simplex Noise"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("sketch",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec2 resolution;\nfloat res = resolution.x;\nfloat n0 = 97.0 / res;\nfloat n1 = 15.0 / res;\nfloat n2 = 97.0 / res;\nfloat n3 = 9.7 / res;\nfloat total = n2 + ( 4.0 * n0 ) + ( 4.0 * n1 );\nconst vec3 div3 = vec3(1.0 / 3.0);\nvoid main(void) {\n\tfloat offset, temp1, temp2;\n\tvec4 m, p0, p1, p2, p3, p4, p5, p6, p7, p8;\n\toffset = n3;\n\tp0=texture2D(source,vTexCoord);\n\tp1=texture2D(source,vTexCoord+vec2(-offset,-offset));\n\tp2=texture2D(source,vTexCoord+vec2( offset,-offset));\n\tp3=texture2D(source,vTexCoord+vec2( offset, offset));\n\tp4=texture2D(source,vTexCoord+vec2(-offset, offset));\n\toffset=n3*2.0;\n\tp5=texture2D(source,vTexCoord+vec2(-offset,-offset));\n\tp6=texture2D(source,vTexCoord+vec2( offset,-offset));\n\tp7=texture2D(source,vTexCoord+vec2( offset, offset));\n\tp8=texture2D(source,vTexCoord+vec2(-offset, offset));\n\tm = (p0 * n2 + (p1 + p2 + p3 + p4) * n0 + (p5 + p6 + p7 + p8) * n1) / total;\n\ttemp1 = dot(p0.rgb, div3);\n\ttemp2 = dot(m.rgb, div3);\n\tif (temp2 <= 0.0005) {\n\t\tgl_FragColor = vec4( 1.0, 1.0, 1.0, p0.a);\n\t} else {\n\t\tgl_FragColor = vec4( vec3(min(temp1 / temp2, 1.0)), p0.a);\n\t}\n}";
return b},inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1}},title:"Sketch",description:"Pencil/charcoal sketch"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("split",function(){var a,b=[1,1],d=[1,1];this.resize=function(){var a,f;a=this.inputs.sizeMode;var k;k=this.inputs.sourceA;var g=this.inputs.sourceB;"a"===a||"b"===a?(f="a"===a?k:g)?(a=f.width,f=f.height):f=a=1:k?g?(f="union"===a?Math.max:Math.min,a=f(k.width,g.width),
f=f(k.height,g.height)):(a=k.width,f=k.height):g?(a=g.width,f=g.height):f=a=1;if(this.width!==a||this.height!==f)this.width=a,this.height=f,this.uniforms.resolution[0]=a,this.uniforms.resolution[1]=f,this.frameBuffer&&this.frameBuffer.resize(a,f),this.emit("resize"),this.setDirty();k&&(b[0]=k.width,b[1]=k.height);g&&(d[0]=g.width,d[1]=g.height);for(k=0;k<this.targets.length;k++)this.targets[k].resize()};return{initialize:function(e){e();this.uniforms.resolutionA=b;this.uniforms.resolutionB=d;a=this.baseShader},
commonShader:!0,shader:function(a,b){b.vertex="precision mediump float;\nattribute vec4 position;\nattribute vec2 texCoord;\nuniform vec2 resolution;\nuniform vec2 resolutionA;\nuniform vec2 resolutionB;\nuniform mat4 projection;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nuniform float angle;\nvarying float c;\nvarying float s;\nvarying float t;\nvoid main(void) {\n   c = cos(angle);\n   s = sin(angle);\n\tt = abs(c + s);\n\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);\n\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;\n\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);\n\tgl_Position.w = screenPosition.w;\n\tvec2 adjustedTexCoord = (texCoord - 0.5) * resolution;\n\tvTexCoordA = adjustedTexCoord / resolutionA + 0.5;\n\tvTexCoordB = adjustedTexCoord / resolutionB + 0.5;\n\tvTexCoord = texCoord;\n}";
b.fragment="precision mediump float;\n\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoordA;\nvarying vec2 vTexCoordB;\nvarying float c;\nvarying float s;\nvarying float t;\nuniform sampler2D sourceA;\nuniform sampler2D sourceB;\nuniform float split;\nuniform float angle;\nuniform float fuzzy;\nvec4 textureLookup(sampler2D tex, vec2 texCoord) {\n\tif (any(lessThan(texCoord, vec2(0.0))) || any(greaterThan(texCoord, vec2(1.0)))) {\n\t\treturn vec4(0.0);\n\t} else {\n\t\treturn texture2D(tex, texCoord);\n\t}\n}\nvoid main(void) {\n\tvec4 pixel1 = textureLookup(sourceA, vTexCoordA);\n\tvec4 pixel2 = textureLookup(sourceB, vTexCoordB);\n\tfloat mn = (split - fuzzy * (1.0 - split));\n\tfloat mx = (split + fuzzy * split);;\n\tvec2 coords = vTexCoord - vec2(0.5);\n\tcoords = vec2(coords.x * c - coords.y * s, coords.x * s + coords.y * c);\n\tfloat scale = max(abs(c - s), abs(s + c));\n\tcoords /= scale;\n\tcoords += vec2(0.5);\n\tfloat x = coords.x;;\n\tgl_FragColor = mix(pixel2, pixel1, smoothstep(mn, mx, x));\n}";
return b},draw:function(b,c,d,g,l){1<=d.split?(d.source=d.sourceB,l(a,c,d,g)):0>=d.split?(d.source=d.sourceA,l(a,c,d,g)):l(b,c,d,g)},inPlace:!1,requires:function(a,b){return"sourceA"===a&&1<=b.split||"sourceB"===a&&0>=b.split?!1:!0}}},{inputs:{sourceA:{type:"image",uniform:"sourceA",shaderDirty:!1,update:function(){this.resize()}},sourceB:{type:"image",uniform:"sourceB",shaderDirty:!1,update:function(){this.resize()}},sizeMode:{type:"enum",defaultValue:"a",options:["a","b","union","intersection"],
update:function(){this.resize()}},split:{type:"number",uniform:"split",defaultValue:0.5,min:0,max:1,updateSources:!0},angle:{type:"number",uniform:"angle",defaultValue:0},fuzzy:{type:"number",uniform:"fuzzy",defaultValue:0,min:0,max:1}},description:"Split screen or wipe",title:"Split"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("throttle",function(){var a=0;return{draw:function(b,d,e,f,k){this.inputs.frameRate&&Date.now()-a>=1E3/this.inputs.frameRate&&(k(b,d,e,f),a=Date.now())},requires:function(b,d){return d.frameRate&&Date.now()-a>=1E3/d.frameRate?!0:!1}}},{inPlace:!0,commonShader:!0,title:"Throttle",
description:"Throttle frame rate",inputs:{source:{type:"image",uniform:"source"},frameRate:{type:"number",uniform:"opacity",defaultValue:15,min:0}}})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("tone",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform vec4 light;\nuniform vec4 dark;\nuniform float desat;\nuniform float toned;\nconst vec3 lumcoeff = vec3(0.2125,0.7154,0.0721);\nvoid main(void) {\n\tvec4 sourcePixel = texture2D(source, vTexCoord);\n\tvec3 sceneColor = light.rgb * sourcePixel.rgb;\n\tvec3 gray = vec3(dot(lumcoeff, sceneColor));\n\tvec3 muted = mix(sceneColor, gray, desat);\n\tvec3 tonedColor = mix(dark.rgb, light.rgb, gray);\n\tgl_FragColor = vec4(mix(muted, tonedColor, toned), sourcePixel.a);\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},light:{type:"color",uniform:"light",defaultValue:[1,0.9,0.5,1]},dark:{type:"color",uniform:"dark",defaultValue:[0.2,0.05,0,1]},toned:{type:"number",uniform:"toned",defaultValue:1,minimumRange:0,maximumRange:1},desat:{type:"number",uniform:"desat",defaultValue:0.5,minimumRange:0,maximumRange:1}},title:"Tone",description:""})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("tvglitch",function(){var a,c,d,e,f,k;return{initialize:function(c){var l,m,h,n;k=this.gl;a=this.height;n=[];m=0.3-0.02;h=0.8-0.2;for(l=0;20>l;l++)n.push(2*Math.random()-1),n.push(Math.random()*h+0.2),n.push(Math.random()*m+0.02),n.push(0.2*Math.random());d=k.createBuffer();
k.bindBuffer(k.ARRAY_BUFFER,d);k.bufferData(k.ARRAY_BUFFER,new Float32Array(n),k.STATIC_DRAW);d.itemSize=4;d.numItems=20;e=new b.util.ShaderProgram(k,"precision mediump float;\nattribute vec4 particle;\nuniform float time;\nuniform float height;\nvarying float intensity;\nvoid main(void) {\n\tfloat y = particle.x + time * particle.y;\n\ty = fract((y + 1.0) / 2.0) * 4.0 - 2.0;\n\tintensity = particle.w;\n\tgl_Position = vec4(0.0, -y , 1.0, 2.0);\n\tgl_PointSize = height * particle.z;\n}","precision mediump float;\nvarying float intensity;\nvoid main(void) {\n\tgl_FragColor = vec4(1.0);\n\tgl_FragColor.a = 2.0 * intensity * (1.0 - abs(gl_PointCoord.y - 0.5));\n}");
f=new b.util.FrameBuffer(k,1,Math.max(1,this.height/2));c()},commonShader:!0,shader:function(a,c){c.fragment=["precision mediump float;\n#define HardLight(top, bottom)  (1.0 - 2.0 * (1.0 - top) * (1.0 - bottom))\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform sampler2D particles;\nuniform float time;\nuniform float scanlines;\nuniform float lineSync;\nuniform float lineHeight;\nuniform float distortion;\nuniform float vsync;\nuniform float bars;\nuniform float frameSharpness;\nuniform float frameShape;\nuniform float frameLimit;\nuniform vec4 frameColor;",
b.util.shader.noiseHelpers+b.util.shader.snoise2d+"void main(void) {","\tvec2 texCoord = vTexCoord;\n\tfloat drandom = snoise(vec2(time * 50.0, texCoord.y /lineHeight));\n\tfloat distortAmount = distortion * (drandom - 0.25) * 0.5;\n\tvec4 particleOffset = texture2D(particles, vec2(0.0, texCoord.y));\n\tdistortAmount -= lineSync * (2.0 * particleOffset.a - 0.5);\n\ttexCoord.x -= distortAmount;\n\ttexCoord.x = mod(texCoord.x, 1.0);\n\tfloat roll;\n\tif (vsync != 0.0) {\n\t\troll = fract(time / vsync);\n\t\ttexCoord.y = mod(texCoord.y - roll, 1.0);\n\t}\n\tvec4 pixel = texture2D(source, texCoord);\n\tfloat barsAmount = particleOffset.r;\n\tif (barsAmount > 0.0) {\n\t\tpixel = vec4(pixel.r + bars * barsAmount,pixel.g + bars * barsAmount,pixel.b + bars * barsAmount,pixel.a);\n\t}\n\tif (mod(texCoord.y / lineHeight, 2.0) < 1.0 ) {\n\t\tpixel.rgb *= (1.0 - scanlines);\n\t}\n\tfloat f = (1.0 - gl_FragCoord.x * gl_FragCoord.x) * (1.0 - gl_FragCoord.y * gl_FragCoord.y);\n\tfloat frame = clamp( frameSharpness * (pow(f, frameShape) - frameLimit), 0.0, 1.0);\n\tgl_FragColor = mix(frameColor, pixel, frame);\n}"].join("\n");
return c},resize:function(){f&&f.resize(1,Math.max(1,this.height/2))},draw:function(b,l,m,h,n){var r=c!==this.inputs.time,p;a!==this.height&&(a=this.height,r=!0);m.lineHeight=1/this.height;this.inputs.verticalSync?(p=0.2/this.inputs.verticalSync,m.vsync=p):(p=1,m.vsync=0);m.time=this.inputs.time%(1E3*p);m.distortion=Math.random()*this.inputs.distortion;r&&(this.inputs.lineSync||this.inputs.bars)&&(e.use(),k.viewport(0,0,1,this.height/2),k.bindFramebuffer(k.FRAMEBUFFER,f.frameBuffer),k.clear(k.COLOR_BUFFER_BIT|
k.DEPTH_BUFFER_BIT),k.enableVertexAttribArray(e.location.particle),k.bindBuffer(k.ARRAY_BUFFER,d),k.vertexAttribPointer(e.location.particle,d.itemSize,k.FLOAT,!1,0,0),k.enable(k.BLEND),k.blendFunc(k.SRC_ALPHA,k.ONE),e.time.set(m.time),e.height.set(this.height),k.drawArrays(k.POINTS,0,20),c=this.inputs.time);m.particles=f.texture;n(b,l,m,h)},destroy:function(){d=null;f&&(f.destroy(),f=null)}}},{inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},time:{type:"number",defaultValue:0},
distortion:{type:"number",defaultValue:0.1,min:0,max:1},verticalSync:{type:"number",defaultValue:0.1,min:0,max:1},lineSync:{type:"number",uniform:"lineSync",defaultValue:0.2,min:0,max:1},scanlines:{type:"number",uniform:"scanlines",defaultValue:0.3,min:0,max:1},bars:{type:"number",uniform:"bars",defaultValue:0,min:0,max:1},frameShape:{type:"number",uniform:"frameShape",min:0,max:2,defaultValue:0.27},frameLimit:{type:"number",uniform:"frameLimit",min:-1,max:1,defaultValue:0.34},frameSharpness:{type:"number",
uniform:"frameSharpness",min:0,max:40,defaultValue:8.4},frameColor:{type:"color",uniform:"frameColor",defaultValue:[0,0,0,1]}},title:"TV Glitch"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("vibrance",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float amount;\nvoid main(void) {\n\tvec4 color = texture2D(source, vTexCoord);\n\tfloat average = (color.r + color.g + color.b) / 3.0;\n\tfloat mx = max(color.r, max(color.g, color.b));\n\tfloat amt = (mx - average) * (-3.0 * amount);\n\tcolor.rgb = mix(color.rgb, vec3(mx), amt);\n\tgl_FragColor = color;\n}";
return b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},amount:{type:"number",uniform:"amount",defaultValue:0,min:-1,max:1}},title:"Vibrance",description:"Non-peaking saturation effect"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){b.plugin("vignette",{commonShader:!0,shader:function(a,b){b.fragment="precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float amount;\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n\tvec2 pos = vTexCoord.xy - 0.5;\n\tfloat vignette = 1.0 - (dot(pos, pos) * amount);\n\tgl_FragColor = vec4(pixel.rgb * vignette, pixel.a);\n}";
return b},inPlace:!1,inputs:{source:{type:"image",uniform:"source"},amount:{type:"number",uniform:"amount",defaultValue:1,min:0}},title:"Vignette",description:"Vignette"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):(b.Seriously||(b.Seriously={plugin:function(a,b){this[a]=b}}),a(b.Seriously))})(this,function(b){var a=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);b.plugin("whitebalance",function(){function c(c,d){var h,x,w;if(f!==c||k!==d)if(f=c,k=d,x=Math.ceil(Math.log(Math.max(d,c))/l),h=Math.pow(2,x),h>n&&(x=Math.ceil(Math.log(n)/l),h=n),x++,g!==h){for(g=h;e.length>x;)e.pop().fb.destroy();
for(;e.length<x;)w=e.length,h=Math.pow(2,w),e.push({fb:new b.util.FrameBuffer(m.gl,h,h),opts:{width:h,height:h},uniforms:{level:e.length,offset:0.25/h,transform:a,projection:a,resolution:[h,h]}}),w&&(e[w-1].uniforms.source=e[w].fb.texture)}}var d,e=[],f,k,g,l=Math.log(2),m=this,h,n;return{initialize:function(a){h=this.gl;n=h.getParameter(h.MAX_TEXTURE_SIZE);this.inputs.auto&&c(this.width,this.height);a()},shader:function(a,c){var e=a.auto;e&&!d&&(d=new b.util.ShaderProgram(this.gl,c.vertex,"precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\nuniform float offset;\nuniform int level;\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord - vec2(offset)) +\n\t\ttexture2D(source, vTexCoord + vec2(offset, -offset)) +\n\t\ttexture2D(source, vTexCoord + vec2(offset)) +\n\t\ttexture2D(source, vTexCoord + vec2(-offset, offset));\n\tpixel /= 4.0;\n\tgl_FragColor = pixel;\n}"));
c.fragment=[e?"#define AUTO":"","precision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D source;\n#ifdef AUTO\nuniform sampler2D whiteSource;\n#else\nuniform vec4 white;\n#endif\nconst vec3 luma = vec3(0.2125, 0.7154, 0.0721);\nvoid main(void) {\n\tvec4 pixel = texture2D(source, vTexCoord);\n#ifdef AUTO\n\tvec4 white = texture2D(whiteSource, vTexCoord);\n#endif\n\tvec3 target = vec3(dot(white.rgb, luma));\n\tpixel.rgb = pixel.rgb * target / white.rgb;\n\tgl_FragColor = pixel;\n}"].join("\n");
return c},resize:function(){this.gl&&this.inputs.auto&&c(this.width,this.height)},draw:function(a,b,c,f,g){var h,k;if(this.inputs.auto){h=e.length-1;for(e[h].uniforms.source=c.source;0<=h;)k=e[h],g(d,b,k.uniforms,k.fb.frameBuffer,null,k.opts),h--;c.whiteSource=e[0].fb.texture}g(a,b,c,f)},destroy:function(){for(;e.length;)e.pop().destroy()},inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},white:{type:"color",uniform:"white",defaultValue:[1,1,1]},auto:{type:"boolean",shaderDirty:!0,
defaultValue:!0}}}},{title:"White Balance"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):a(b.Seriously)})(this,function(b){function a(){var a;if(!r){l=new Uint8Array(256);m=new Uint8Array(512);h=new Uint8Array(512);n=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);for(a=0;256>a;a++)l[a]=256*g();for(a=0;512>a;a++)m[a]=l[a&255],h[a]=m[a]%12;r=!0}}function c(a,b){var c=0,d=0,e=0,g=(a+b)*f,l=Math.floor(a+g),
r=Math.floor(b+g),g=(l+r)*k,A=a-(l-g),H=b-(r-g),t=A>H?1:0,D=(t+1)%2,z=A-t+k,S=H-D+k,g=A-1+2*k,C=H-1+2*k,l=l&255,r=r&255,J=0.5-A*A-H*H,E;0<=J&&(E=3*h[l+m[r]],J*=J,c=J*J*(n[E]*A+n[E+1]*H));A=0.5-z*z-S*S;0<=A&&(E=3*h[l+t+m[r+D]],A*=A,d=A*A*(n[E]*z+n[E+1]*S));A=0.5-g*g-C*C;0<=A&&(E=3*h[l+1+m[r+1]],A*=A,e=A*A*(n[E]*g+n[E+1]*C));return 70*(c+d+e)}var d=b.util.mat4,e=Math.PI,f=0.5*(Math.sqrt(3)-1),k=(3-Math.sqrt(3))/6,g=Math.random,l,m,h,n,r=!1;b.transform("camerashake",function(){function b(a,c,d){var f=
g.width,h=g.height,k=1,l,m,n,p,r;if(d-=e*Math.floor(d/e))p=Math.sin(d),r=Math.sqrt(1-p*p),l=f/2,m=h/2,d=Math.abs(l*r-m*p),k=Math.abs(l*p+m*r),l=-l,n=Math.abs(l*r-m*p),l=Math.abs(l*p+m*r),k=2*Math.max(d/f,n/f,k/h,l/h);return k*=Math.max((2*Math.abs(a)+f)/f,(2*Math.abs(c)+h)/h)}function f(){var a=g.matrix,v,C,J,E,T;C=0;var O,F=1,R=F=0;J=v=0;var M,N,ca,Y,ka;if(l||m||r){J=k*n;for(O=0;O<h;O++)E=Math.pow(2,O),T=Math.pow(0.5,O),C+=T,r&&(v+=c(J*E,7*E)*T),l&&(F+=c(J*E,11*E)*T),m&&(R+=c(J*E,13*E)*T);v*=r/C;
F*=l/C;R*=m/C;J=v*e/180;d.identity(a);C=F;E=R;a[12]=a[0]*C+a[4]*E+a[12];a[13]=a[1]*C+a[5]*E+a[13];a[14]=a[2]*C+a[6]*E+a[14];a[15]=a[3]*C+a[7]*E+a[15];v&&(v=Math.sin(J),C=Math.cos(J),E=a[0],T=a[1],O=a[2],M=a[3],N=a[4],ca=a[5],Y=a[6],ka=a[7],a[0]=E*C+N*v,a[1]=T*C+ca*v,a[2]=O*C+Y*v,a[3]=M*C+ka*v,a[4]=N*C-E*v,a[5]=ca*C-T*v,a[6]=Y*C-O*v,a[7]=ka*C-M*v);t&&(1===H?F=D:(F=b(F,R,J),F=H*D+(1-H)*F),1!==F&&(a[0]*=F,a[1]*=F,a[2]*=F,a[3]*=F,a[4]*=F,a[5]*=F,a[6]*=F,a[7]*=F));g.transformed=!0}else g.transformed=!1}
var g=this,h=1,k=0,l=0,m=0,n=1,r=0,H=0,t=!0,D=1;a();return{resize:f,inputs:{time:{get:function(){return k},set:function(a){if(a===k)return!1;k=a;f();return!0},type:"number"},frequency:{get:function(){return n},set:function(a){if(a===n)return!1;n=a;f();return!0},type:"number"},octaves:{get:function(){return h},set:function(a){a=Math.max(1,a);if(a===h)return!1;h=a;f();return!0},type:"number"},rotation:{get:function(){return r},set:function(a){if(a===r)return!1;r=a;D=b(l,m,r*e/180);f();return!0},type:"number"},
amplitudeX:{get:function(){return l},set:function(a){a=Math.max(0,a);if(a===l)return!1;l=a;D=b(l,m,r*e/180);f();return!0},type:"number"},amplitudeY:{get:function(){return m},set:function(a){a=Math.max(0,a);if(a===m)return!1;m=a;D=b(l,m,r*e/180);f();return!0},type:"number"},autoScale:{get:function(){return t},set:function(a){a=!!a;if(a===t)return!1;t=a;f();return!0},type:"boolean"},preScale:{get:function(){return H},set:function(a){a=Math.max(0,Math.min(1,a));if(a===H)return!1;H=a;f();return!0},type:"number"}}}},
{title:"Camera Shake"})});(function(b,a){"function"===typeof define&&define.amd?define(["seriously"],a):"object"===typeof exports?a(require("seriously")):a(b.Seriously)})(this,function(b){var a=b.util.mat4;b.transform("3d",function(b){function d(){function b(a,c,d){t[12]=t[0]*a+t[4]*c+t[8]*d+t[12];t[13]=t[1]*a+t[5]*c+t[9]*d+t[13];t[14]=t[2]*a+t[6]*c+t[10]*d+t[14];t[15]=t[3]*a+t[7]*c+t[11]*d+t[15]}function c(){var a;x&&(a=-(f?x*Math.PI/180:x),D=Math.sin(a),z=Math.cos(a),T=t[4],O=t[5],F=t[6],R=t[7],M=t[8],N=t[9],ca=t[10],Y=
t[11],t[4]=T*z+M*D,t[5]=O*z+N*D,t[6]=F*z+ca*D,t[7]=R*z+Y*D,t[8]=M*z-T*D,t[9]=N*z-O*D,t[10]=ca*z-F*D,t[11]=Y*z-R*D)}function d(){var a;w&&(a=-(f?w*Math.PI/180:w),D=Math.sin(a),z=Math.cos(a),S=t[0],C=t[1],J=t[2],E=t[3],M=t[8],N=t[9],ca=t[10],Y=t[11],t[0]=S*z-M*D,t[1]=C*z-N*D,t[2]=J*z-ca*D,t[3]=E*z-Y*D,t[8]=S*D+M*z,t[9]=C*D+N*z,t[10]=J*D+ca*z,t[11]=E*D+Y*z)}function H(){var a;B&&(a=-(f?B*Math.PI/180:B),D=Math.sin(a),z=Math.cos(a),S=t[0],C=t[1],J=t[2],E=t[3],T=t[4],O=t[5],F=t[6],R=t[7],t[0]=S*z+T*D,t[1]=
C*z+O*D,t[2]=J*z+F*D,t[3]=E*z+R*D,t[4]=T*z-S*D,t[5]=O*z-C*D,t[6]=F*z-J*D,t[7]=R*z-E*D)}var t=e.matrix,D,z,S,C,J,E,T,O,F,R,M,N,ca,Y;r||p||v||x||w||B||1!==m||1!==h||1!==n?(a.identity(t),b(r+k,p+g,v+l),"XYZ"===L?(c(),d(),H()):"XZY"===L?(c(),H(),d()):"YXZ"===L?(d(),c(),H()):"YZX"===L?(d(),H(),c()):"ZXY"===L?(H(),c(),d()):(H(),d(),c()),1!==m&&(t[0]*=m,t[1]*=m,t[2]*=m,t[3]*=m),1!==h&&(t[4]*=h,t[5]*=h,t[6]*=h,t[7]*=h),1!==n&&(t[8]*=n,t[9]*=n,t[10]*=n,t[11]*=n),b(-k,-g,-l),e.transformed=!0):e.transformed=
!1}var e=this,f=!(b&&b.radians),k=0,g=0,l=0,m=1,h=1,n=1,r=0,p=0,v=0,x=0,w=0,B=0,L="XYZ";return{inputs:{reset:{method:function(){l=g=k=0;n=h=m=1;B=w=x=v=p=r=0;return e.transformed?(e.transformed=!1,!0):!1}},translate:{method:function(a,b,c){isNaN(a)&&(a=r);isNaN(b)&&(b=p);isNaN(c)&&(c=v);if(a===r&&b===p&&c===v)return!1;r=a;p=b;v=c;d();return!0},type:["number","number","number"]},translateX:{get:function(){return r},set:function(a){if(a===r)return!1;r=a;d();return!0},type:"number"},translateY:{get:function(){return p},
set:function(a){if(a===p)return!1;p=a;d();return!0},type:"number"},translateZ:{get:function(){return v},set:function(a){if(a===v)return!1;v=a;d();return!0},type:"number"},rotationOrder:{get:function(){return L},set:function(a){if(a===L)return!1;L=a;d();return!0},type:"number"},rotationX:{get:function(){return x},set:function(a){if(a===x)return!1;x=a;d();return!0},type:"number"},rotationY:{get:function(){return w},set:function(a){if(a===w)return!1;w=a;d();return!0},type:"number"},rotationZ:{get:function(){return B},
set:function(a){if(a===B)return!1;B=a;d();return!0},type:"number"},center:{method:function(a,b,c){isNaN(a)&&(a=k);isNaN(b)&&(b=g);isNaN(c)&&(c=l);if(a===k&&b===g&&c===l)return!1;k=a;g=b;l=c;d();return!0},type:["number","number","number"]},centerX:{get:function(){return k},set:function(a){if(a===k)return!1;k=a;d();return!0},type:"number"},centerY:{get:function(){return g},set:function(a){if(a===g)return!1;g=a;d();return!0},type:"number"},centerZ:{get:function(){return l},set:function(a){if(a===l)return!1;
l=a;d();return!0},type:"number"},scale:{method:function(a,b,c){var e,f;e=isNaN(a)?m:a;isNaN(b)?!isNaN(a)&&isNaN(c)?f=a=e:a=h:a=b;isNaN(c)?void 0===f&&(f=n):f=c;if(e===m&&a===h&&f===n)return!1;m=e;h=a;n=f;d();return!0},type:["number","number","number"]},scaleX:{get:function(){return m},set:function(a){if(a===m)return!1;m=a;d();return!0},type:"number"},scaleY:{get:function(){return h},set:function(a){if(a===h)return!1;h=a;d();return!0},type:"number"},scaleZ:{get:function(){return n},set:function(a){if(a===
n)return!1;n=a;d();return!0},type:"number"}}}},{title:"3D Transform",description:"Translate, Rotate, Scale"})});var UI={version:0.1,nset:{width:322,height:262,w:40,h:40,r:10,sc1:"rgba(120,30,60,0.5)",fc1:"rgba(30,120,60,0.5)",tc1:"rgba(30,60,120,0.5)",sc2:"rgba(120,30,60,0.8)",fc2:"rgba(30,120,60,0.8)",tc2:"rgba(30,60,120,0.8)"},DocClick:!1,Title:function(b,a,c,d){this.target=b;this.content=document.createElement("div");this.content.className="UI-title";this.t1=document.createElement("div");this.t1.className="UI-text";this.t1.style.cssText="width:200px; font-size:12px;";this.t2=document.createElement("div");
this.t2.className="UI-text";this.t2.style.cssText="right:5px; text-align:right; font-size:12px;";b=a;10>a&&(b="0"+a);this.t1.innerHTML=c.replace("-"," ").toUpperCase();this.t2.innerHTML=d.toUpperCase()+" "+b;this.content.appendChild(this.t1);this.content.appendChild(this.t2);this.target.appendChild(this.content)}};
UI.Title.prototype={constructor:UI.Title,clear:function(){this.content.removeChild(this.t1);this.content.removeChild(this.t2);this.target.removeChild(this.content);this.target=this.content=this.t2=this.t1=null}};
UI.Url=function(b,a,c,d){this.target=b;this.mouseDown=!1;this.callback=c||function(){};this.content=document.createElement("div");this.content.className="UI-base";b.appendChild(this.content);this.t1=document.createElement("div");this.t1.className="UI-text";this.t1.innerHTML="URL:";this.content.appendChild(this.t1);this.t2=document.createElement("div");this.t2.className="UI-text";this.t2.style.cssText="width:200px; left:50px; pointer-events:auto;";this.t2.contentEditable=!0;this.t2.innerHTML=d;this.content.appendChild(this.t2);
this.fun=function(a){this.callback(this.t2.innerHTML)}.bind(this);this.t2.addEventListener("input",this.fun,!1)};UI.Url.prototype={constructor:UI.Url,clear:function(){this.t2.removeEventListener("input",this.fun,!1);this.content.removeChild(this.t1);this.content.removeChild(this.t2);this.target.removeChild(this.content);this.target=this.content=this.t2=this.t1=this.fun=this.callback=null}};UI.Number=function(b,a,c,d){};UI.Number.prototype={constructor:UI.Number,clear:function(){}};
UI.V2=function(b,a,c,d){};UI.V2.prototype={constructor:UI.V2,clear:function(){}};UI.Color=function(b,a,c,d){};UI.Color.prototype={constructor:UI.Color,clear:function(){}};UI.Bool=function(b,a,c,d){};UI.Bool.prototype={constructor:UI.Bool,clear:function(){}};
UI.List=function(b,a,c,d,e){this.target=b;this.colors=["rgba(220,220,220,1)","rgba(0,0,0,0.2)","rgba(0,0,0,0.6)","rgba(200,200,200,0.6)","rgba(200,200,200,1)"];this.list=e||[];this.name=a||"list";this.value=d;this.callback=c||function(){};this.lcontent=null;this.mouseDown=!1;this.mover=!0;this.dragValue=0;this.pin=this.bg=this.timer=null;this.init()};
UI.List.prototype={constructor:UI.List,init:function(){this.content=document.createElement("div");this.content.className="UI-base";this.target.appendChild(this.content);this.txt=document.createElement("div");this.txt.className="UI-text";this.txt.innerHTML=this.name.substring(0,1).toUpperCase()+this.name.substring(1,this.name.length)+":";this.content.appendChild(this.txt);this.sel=document.createElement("div");this.sel.className="UI-textList";this.sel.innerHTML=this.value.toUpperCase();this.content.appendChild(this.sel);
this.sel.onclick=function(b){this.displayList()}.bind(this)},displayList:function(){if(null!==this.lcontent)this.lcontent.style.display="block",this.lcontent.style.zIndex=1;else{this.lcontent=document.createElement("div");this.lcontent.className="UI-list";this.content.appendChild(this.lcontent);this.lin=document.createElement("div");this.lin.className="UI-listInner";this.lcontent.appendChild(this.lin);for(var b,a,c=0;c<this.list.length;c++)a=this.list[c],b=document.createElement("div"),b.className=
"UI-listItem",b.innerHTML=a.toUpperCase(),b.name=a,this.lin.appendChild(b);this.lin.onclick=function(a){this.value=a.target.name;this.closeList()}.bind(this);this.lin.onmouseover=function(a){this.mover=!0;clearTimeout(this.timer)}.bind(this);this.lin.onmouseout=function(a){this.mover&&(this.timer=setTimeout(function(a){this.closeList()}.bind(this),1E3))}.bind(this);this.listHeight=16*this.list.length;this.lcontent.style.zIndex=1;80>this.listHeight?this.lcontent.style.height=this.listHeight+"px":this.addScroll()}},
addScroll:function(){this.bg=document.createElement("div");this.bg.className="UI-listScroll";this.lcontent.appendChild(this.bg);this.pin=document.createElement("div");this.pin.className="UI-listPin";this.bg.appendChild(this.pin);this.bg.oncontextmenu=function(b){b.preventDefault()}.bind(this);this.bg.onmouseover=function(b){this.over(b)}.bind(this);this.bg.onmouseout=function(b){this.out(b)}.bind(this);this.bg.onmouseup=function(b){this.up(b)}.bind(this);this.bg.onmousedown=function(b){this.down(b)}.bind(this);
this.bg.onmousemove=function(b){this.drag(b)}.bind(this);this.ratio=this.listHeight/70;this.scrollHeight=20;this.min=10;this.max=70;this.valueRange=this.max-this.min;this.h=60;this.pin.style.height=this.scrollHeight+"px"},closeList:function(){this.mover=!1;this.lcontent.style.display="none";this.sel.innerHTML=this.value.toUpperCase();this.callback(this.value);this.lcontent.style.zIndex=0},updatePosition:function(){this.pin.style.top=this.dragValue-10+"px";this.lin.style.top=-((this.dragValue-10)*
this.ratio)+"px"},out:function(b){this.mouseDown=!1;this.bg.childNodes[0].style.backgroundColor=this.colors[3];b.preventDefault()},over:function(b){this.mover=!0;clearTimeout(this.timer);this.bg.childNodes[0].style.backgroundColor=this.colors[4];b.preventDefault()},up:function(b){this.mouseDown=!1;b.preventDefault()},down:function(b){this.mouseDown=!0;this.drag(b);b.preventDefault()},drag:function(b){if(this.mouseDown){var a=this.bg.getBoundingClientRect();this.dragValue=(b.clientY-a.top-17)/this.h*
this.valueRange+this.min;this.dragValue<this.min&&(this.dragValue=this.min);this.dragValue>this.max&&(this.dragValue=this.max);this.updatePosition()}b.preventDefault()},clear:function(){if(null!==this.lcontent){null!==this.bg&&(this.bg.oncontextmenu=null,this.bg.onmouseover=null,this.bg.onmouseout=null,this.bg.onmouseup=null,this.bg.onmousedown=null,this.bg.onmousemove=null,this.bg.removeChild(this.pin),this.lcontent.removeChild(this.bg),this.bg=this.pin=null);for(;this.lin.firstChild;)this.lin.removeChild(this.lin.firstChild);
this.lin.onclick=null;this.lin.onmouseover=null;this.lin.onmouseout=null;this.lcontent.removeChild(this.lin);this.lcontent=this.lin=null}this.content.removeChild(this.sel);this.content.removeChild(this.txt);this.callback=this.txt=this.sel=this.sel.onclick=null;this.target.removeChild(this.content);this.target=this.content=this.list=null}};
UI.Slide=function(b,a,c,d,e,f,k,g,l){this.target=b;this.colors=["rgba(220,220,220,1)","rgba(0,0,0,0.2)","rgba(0,0,0,0.6)","rgba(200,200,200,0.6)","rgba(200,200,200,1)"];this.precision=k||0;this.min=e||0;this.max=f||100;this.name=a||"slider";this.type=g||"";this.valueRange=this.max-this.min;this.set=l||[10,100,180,10];this.callback=c||function(){};this.width=180;this.height=16;this.w=this.width-8;this.value=d||0;this.mouseDown=!1;this.init()};
UI.Slide.prototype={constructor:UI.Slide,init:function(){this.content=document.createElement("div");this.content.className="UI-base";this.txt=document.createElement("div");this.txt.className="UI-text";this.txt.innerHTML=this.name.substring(0,1).toUpperCase()+this.name.substring(1,this.name.length)+":";this.result=document.createElement("div");this.result.className="UI-text";this.result.style.cssText="right:10px; text-align:right;";this.bg=document.createElement("div");this.bg.className="UI-scroll-bg";
this.bg.style.width=this.width+"px";this.bg.style.height=this.height+"px";this.bg.style.background=this.colors[1];this.sel=document.createElement("div");this.sel.className="UI-scroll-sel";this.sel.style.height=this.height-8+"px";this.sel.style.background=this.colors[3];this.bg.appendChild(this.sel);this.content.appendChild(this.result);this.content.appendChild(this.txt);this.content.appendChild(this.bg);this.target.appendChild(this.content);this.bg.onmouseover=function(b){this.over(b)}.bind(this);
this.bg.onmouseout=function(b){this.out(b)}.bind(this);this.bg.onmouseup=function(b){this.up(b)}.bind(this);this.bg.onmousedown=function(b){this.down(b)}.bind(this);this.bg.onmousemove=function(b){this.drag(b)}.bind(this);this.updatePosition()},updatePosition:function(){this.sel.style.width=(this.value-this.min)/this.valueRange*this.w+"px";this.result.innerHTML=this.value+this.type;this.callback(this.value)},out:function(b){this.mouseDown=!1;this.bg.style.backgroundColor=this.colors[1];this.bg.childNodes[0].style.backgroundColor=
this.colors[3];b.preventDefault()},over:function(b){this.bg.style.backgroundColor=this.colors[2];this.bg.childNodes[0].style.backgroundColor=this.colors[4];b.preventDefault()},up:function(b){this.mouseDown=!1;b.preventDefault()},down:function(b){this.mouseDown=!0;this.drag(b);b.preventDefault()},drag:function(b){if(this.mouseDown){var a=this.bg.getBoundingClientRect();this.value=1*((b.clientX-a.left)/this.w*this.valueRange+this.min).toFixed(this.precision);this.value<this.min&&(this.value=this.min);
this.value>this.max&&(this.value=this.max);this.updatePosition()}b.preventDefault()},clear:function(){this.bg.onmouseover=null;this.bg.onmouseout=null;this.bg.onmouseup=null;this.bg.onmousedown=null;this.bg.onmousemove=null;this.bg.removeChild(this.sel);this.content.removeChild(this.result);this.content.removeChild(this.txt);this.content.removeChild(this.bg);this.target.removeChild(this.content);this.target=this.content=this.result=this.txt=this.sel=this.bg=null}};
UI.createClass=function(b,a){var c=".";"*"==b&&(c="");var d=document.createElement("style");d.type="text/css";document.getElementsByTagName("head")[0].appendChild(d);(d.sheet||{}).insertRule?d.sheet.insertRule(c+b+"{"+a+"}",0):(d.styleSheet||d.sheet).addRule(c+b,a)};var str="box-sizing:border-box; -moz-box-sizing:border-box; -webkit-box-sizing:border-box;";
UI.createClass("UI-base","width:"+(UI.nset.width-4)+"px; height:20px; position:relative; left:0px; pointer-events:none; background:"+UI.nset.fc1+"; padding-left:10px; padding-right:10px; margin-bottom:1px;"+str);UI.createClass("UI-title","width:"+(UI.nset.width-4)+"px; height:30px; position:relative; left:0px; pointer-events:none; padding-left:5px; padding-right:5px; margin-bottom:1px; padding-top:8px;"+str);
UI.createClass("UI-text","font-size:12px; position:absolute; width:80px; height:12px; pointer-events:none; margin-top:4px; text-align:Left;"+str);UI.createClass("UI-textList","border:1px solid "+UI.nset.fc1+"; background:"+UI.nset.fc2+"; left:90px; font-size:12px; position:absolute; cursor:pointer; width:180px; height:16px; pointer-events:auto; margin-top:2px; text-align:center;"+str);UI.createClass("UI-textList:hover","border:1px solid #FFF;"+str);
UI.createClass("UI-list","border:1px solid #FFF; position:absolute; left:90px; top:17px; width:180px; height:80px; background:#000; overflow:hidden; pointer-events:none; "+str);UI.createClass("UI-listInner","position:absolute; left:0; top:0; width:180px; background:#060; pointer-events:none;"+str);UI.createClass("UI-listItem","position:relative; width:180px; height:15px; background:#020; margin-bottom:1px; pointer-events:auto; cursor:pointer;"+str);
UI.createClass("UI-listItem:hover","background:#050; color:#FFF;"+str);UI.createClass("UI-listScroll","position:absolute; right:0px; background:#000; width:20px; height:80px;cursor:pointer;pointer-events:auto;"+str);UI.createClass("UI-listPin","position:absolute; right:1px; background:#0F0; width:18px; height:20px; pointer-events:none;"+str);UI.createClass("UI-scroll-bg","position:absolute; left:90px; top:2px; cursor:w-resize; pointer-events:auto;"+str);
UI.createClass("UI-scroll-sel","position:absolute; pointer-events:none; left:4px; top:4px;"+str);var Seriously,Serious={version:0.1,Sources:["image","video","camera","scene","texture"],Effects:"accumulator ascii bleach-bypass blend blur brightness-contrast channels checkerboard chroma color colorcomplements colorcube color-select crop daltonize directionblur displacement dither edge emboss exposure expression fader falsecolor filmgrain freeze fxaa gradientwipe hex highlights-shadows hue-saturation invert kaleidoscope layer linear-transfer lumakey mirror nightvision noise panorama pixelate polar repeat ripple scanlines select sepia simplex sketch split throttle tone tvglitch vibrance vignette whitebalance".split(" "),
Targets:["texture-3D","canvas"],BlendMode:"normal lighten darken multiply average add subtract divide difference negation exclusion screen overlay softlight hardlight colordodge colorburn lineardodge linearburn linearlight vividlight pinlight hardmix reflect glow phoenix hue saturation color luminosity darkercolor lightercolor".split(" "),BlendSizeMode:["bottom","top","union","intersection"],Editor:function(b){this.seriously=new Seriously;b&&(this.seriously.go(),console.log("auto"));this.size={x:322,
y:272};this.linkTest={source:-1,target:-1,sourceN:0,targetN:0};this.startOut=this.startIn=-1;this.startOutN=this.startInN=0;this.interval=null;this.current_source_node=this.root_target=this.root_source="";this.nodes=[];this.nodesDiv=[];this.count={source:0,effect:0,target:0,position:[]};this.links=[];this.current="close";this.move={name:"",element:null,down:!1,test:!1,x:0,y:0,tx:0,ty:0,mx:0,my:0};this.nset={w:40,h:40,r:10,sc1:"rgba(120,30,60,0.5)",fc1:"rgba(30,120,60,0.5)",tc1:"rgba(30,60,120,0.5)",
sc2:"rgba(120,30,60,0.8)",fc2:"rgba(30,120,60,0.8)",tc2:"rgba(30,60,120,0.8)"};this.selectID=-1;this.sels=[];this.init()}};
Serious.Editor.prototype={constructor:Serious.Editor,render:function(){this.seriously.render()},init:function(){Serious.createClass("basic","font-family:Monospace; font-size:12px; font-smooth:never; -webkit-font-smoothing:none; overflow:hidden; background:#222; color:#FCC;box-sizing:border-box; -moz-box-sizing:border-box; -webkit-box-sizing:border-box;");Serious.createClass("editor","width:42px; height:42px; position:absolute; right:10px; top:10px; border:2px solid #333; border-radius:6px; cursor:move;box-sizing:border-box; -moz-box-sizing:border-box; -webkit-box-sizing:border-box;");
Serious.createClass("def.basic.editor:hover","border:2px solid #666;box-sizing:border-box; -moz-box-sizing:border-box; -webkit-box-sizing:border-box;");Serious.createClass("S-grid","position:absolute; left:0px; top:0px; pointer-events:none; width:2000px; height:2000px; background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUAQMAAAC3R49OAAAABlBMVEVMaXFTU1OXUj8tAAAAAnRSTlMAgJsrThgAAAASSURBVHicY2BgEGCgFv7//wMANusEH0fp3IoAAAAASUVORK5CYII=)repeat;box-sizing:border-box; -moz-box-sizing:border-box; -webkit-box-sizing:border-box;");
Serious.createClass("S-icc","font-size:32px; position:absolute; left:0px; top:0px; text-align:center; width:40px; height:40px; font-weight:bold;box-sizing:border-box; -moz-box-sizing:border-box; -webkit-box-sizing:border-box;");Serious.createClass("S-grid-plus","position:absolute; left:0px; top:0px; pointer-events:none;box-sizing:border-box; -moz-box-sizing:border-box; -webkit-box-sizing:border-box;");Serious.createClass("S-menu","width:42px; height:auto; position:absolute; right:10px; top:10px; pointer-events:auto; text-align:center; background:#222; border:2px solid #333; border-radius:6px; display:none; color:#CCF;box-sizing:border-box; -moz-box-sizing:border-box; -webkit-box-sizing:border-box;");
Serious.createClass("S-source","width:"+this.nset.w+"px; height:"+this.nset.h+"px; position:absolute; background:"+this.nset.sc1+"; border-radius:"+this.nset.r+"px; cursor:default; pointer-events:auto;box-sizing:border-box; -moz-box-sizing:border-box; -webkit-box-sizing:border-box;");Serious.createClass("S-effect","width:"+this.nset.w+"px; height:"+this.nset.h+"px; position:absolute; background:"+this.nset.fc1+"; border-radius:"+this.nset.r+"px; cursor:default; pointer-events:auto;box-sizing:border-box; -moz-box-sizing:border-box; -webkit-box-sizing:border-box;");
Serious.createClass("S-target","width:"+this.nset.w+"px; height:"+this.nset.h+"px; position:absolute; background:"+this.nset.tc1+"; border-radius:"+this.nset.r+"px; cursor:default; pointer-events:auto;box-sizing:border-box; -moz-box-sizing:border-box; -webkit-box-sizing:border-box;");Serious.createClass("S-source:hover","background:"+this.nset.sc2+"; ");Serious.createClass("S-effect:hover","background:"+this.nset.fc2+"; ");Serious.createClass("S-target:hover","background:"+this.nset.tc2+"; ");Serious.createClass("S-icon",
"width:"+this.nset.w+"px; height:"+this.nset.h+"px; position:absolute; left:0px; top:0px; pointer-events:none;box-sizing:border-box; -moz-box-sizing:border-box; -webkit-box-sizing:border-box;");Serious.createClass("S-select","margin-left:-2px; margin-top:-2px; width:"+(this.nset.w+4)+"px; height:"+(this.nset.h+4)+"px; position:absolute; border:4px solid #FFF; border-radius:"+(this.nset.r+2)+"px; pointer-events:none; display:none; pointer-events:none;box-sizing:border-box; -moz-box-sizing:border-box; -webkit-box-sizing:border-box;");
Serious.createClass("S-in","width:8px; height:8px; position:absolute; left:16px; top:-4px; border:2px solid #0F0; background:#000; border-radius:8px; cursor:alias; pointer-events:auto;box-sizing:border-box; -moz-box-sizing:border-box; -webkit-box-sizing:border-box;");Serious.createClass("S-out","width:8px; height:8px; position:absolute; left:16px; bottom:-4px; border:2px solid #FF0; background:#000; border-radius:8px; cursor:alias; pointer-events:auto;box-sizing:border-box; -moz-box-sizing:border-box; -webkit-box-sizing:border-box;");
this.menu=document.createElement("div");this.menu.className="S-menu";this.content=document.createElement("div");this.content.name="root";this.content.className="def basic editor";this.grid=document.createElement("div");this.grid.className="S-grid";this.gridBottom=document.createElement("canvas");this.gridBottom.width=2E3;this.gridBottom.height=2E3;this.gridBottom.className="S-gris-plus";this.linkcontext=this.gridBottom.getContext("2d");this.select=document.createElement("div");this.select.className=
"S-select";this.gridTop=document.createElement("div");this.gridTop.className="S-grid-plus";this.icc=document.createElement("div");this.icc.className="S-icc";this.icc.innerHTML="S";document.body.appendChild(this.menu);document.body.appendChild(this.content);this.content.appendChild(this.grid);this.grid.appendChild(this.gridBottom);this.grid.appendChild(this.select);this.grid.appendChild(this.gridTop);this.content.appendChild(this.icc);this.content.oncontextmenu=function(b){this.contextmenu(b)}.bind(this);
this.content.onmouseover=function(b){this.mouseover(b)}.bind(this);this.content.onmouseout=function(b){this.mouseout(b)}.bind(this);this.content.onmouseup=function(b){this.mouseup(b)}.bind(this);this.content.onmousedown=function(b){this.mousedown(b)}.bind(this);this.content.onmousemove=function(b){this.mousemove(b)}.bind(this);this.content.onmousewheel=function(b){this.mousewheel(b)}.bind(this);this.content.addEventListener("DOMMouseScroll",function(b){this.onmousewheel(b)}.bind(this),!1)},add:function(b,
a){a=a||{};var c,d;switch(b){case "camera":d="source";c=this.seriously.source("camera");break;case "texture":d="source";c=this.seriously.source(a.texture,null,{});break;case "video":d="source";c=document.createElement("video");c.autoPlay=!0;c.loop=!0;c.play();c.url=a.src;break;case "image":d="source";c=document.createElement("img");c.url=a.src;break;case "texture-3D":d="target";c=this.seriously.target(a.texture,{canvas:a.canvas});break;case "canvas-3D":d="target";c=this.seriously.target(a.canvas);
break;case "reformat":d="effect";c=this.seriously.transform("reformat");break;default:d="effect",c=this.seriously.effect(b)}for(var e in a)"texture"!==e&&"canvas"!==e&&"id"!==e&&e in c&&(c[e]=a[e]);void 0!==a.id?(e=a.id,c.name=d+"_"+e+"."+b,this.nodes[e]&&this.nodes[e].destroy(),this.nodes[e]=c):(e=this.nodes.length,c.name=d+"_"+e+"."+b,this.nodes.push(c));return c},refresh:function(){this.clear();var b,a;for(a=this.nodes.length;a--;)b=this.nodes[a].name,b=b.substring(0,b.lastIndexOf("_")),this.count[b]++,
this.count.position.push(new Serious.Point);for(a=this.nodes.length;a--;)this.show(this.nodes[a].name)},close:function(){this.current="close";this.content.style.width="42px";this.content.style.height="42px";this.icc.style.display="block";this.clear()},clear:function(){for(var b,a=this.nodes.length;a--;)for(b=this.nodes[a];b.firstChild;)b.removeChild(b.firstChild);for(;this.gridTop.firstChild;)this.gridTop.removeChild(this.gridTop.firstChild);this.nodesDiv=[]},getPrefix:function(b){return b.substring(0,
b.lastIndexOf("_"))},getID:function(b){return 1*b.substring(b.lastIndexOf("_")+1,b.lastIndexOf("."))},getType:function(b){return b.substring(b.lastIndexOf(".")+1,b.length)},destroy:function(b){this.byID(b).destroy()},byNAME:function(b){for(var a,c=this.nodes.length;c--;)if(a=this.nodes[c],a.name==b)return a},byID:function(b){for(var a,c,d=this.nodes.length;d--;)if(a=this.nodes[d],c=a.name,c=this.getID(c),b==c)return a},show:function(b){var a=!1,c=!1,d=!1,e,f=b.substring(0,b.lastIndexOf("_")),k=this.getID(b),
g=this.getType(b),l=20+60*k,m=20,h=document.createElement("div");h.className="S-"+f;this.gridTop.appendChild(h);h.name=b;this.nodesDiv[k]=h;b=document.createElement("div");b.className="S-icon";b.innerHTML=Serious.Icon(g);h.appendChild(b);switch(f){case "source":c=!0;break;case "effect":l-=60*this.count.source;m=100;c=a=!0;if("blend"==g||"split"==g)d=!0;break;case "target":l-=60*this.count.source+60*this.count.effect,m=180,a=!0}a&&(e=document.createElement("div"),e.className="S-in",e.name="blend"==
g||"split"==g?"I1_"+k+"."+g:"I0_"+k+"."+g,h.appendChild(e));c&&(a=document.createElement("div"),a.className="S-out",a.name="O0_"+k+"."+g,h.appendChild(a));d&&(d=document.createElement("div"),d.className="S-in",d.name="I2_"+k+"."+g,d.style.left="24px",e.style.left="6px",h.appendChild(d));0==this.count.position[k].x&&0==this.count.position[k].y&&(this.count.position[k].x=l,this.count.position[k].y=m);h.style.left=this.count.position[k].x+"px";h.style.top=this.count.position[k].y+"px"},switchIndex:function(b){for(var a,
c,d=this.nodesDiv.length;d--;)a=this.nodesDiv[d],c=a.name,a.style.zIndex=b==c?1:0},testLink:function(){var b=this.linkTest;-1!==b.source&&-1!==b.target&&(this.testIfExist(),this.createLink(this.linkTest),this.move.test=!1,this.linkTest={source:-1,target:-1,sourceN:0,targetN:0})},createLink:function(b){b=new Serious.Link(this,b);b.apply();this.links.push(b);this.updateLink()},removeLink:function(b){this.links[b]&&(this.links[b].clear(),this.links.splice(b,1))},updateLink:function(){this.linkcontext.clearRect(0,
0,2E3,2E3);for(var b,a=this.links.length;a--;)b=this.links[a],b.draw()},testIfExist:function(b,a){for(var c=this.linkTest,d=[],e,f,k,g=!1,l=!1,m=this.links.length;m--;){l=g=!1;e=this.links[m].obj;e.source==c.source&&e.sourceN==c.sourceN&&(f=m,g=!0);e.target==c.target&&e.targetN==c.targetN&&(k=m,l=!0);for(e=d.length;e--;)f==d[e]&&(g=!1),k==d[e]&&(l=!1);g&&d.push(f);l&&d.push(k)}d.sort();for(m=d.length;m--;)this.removeLink(d[m])},selector:function(b){this.clearSelector();if("root"==b)this.selectID=
-1,this.select.style.display="none",this.menu.style.height="auto",this.showRootMenu();else{var a=this.getID(b);this.select.style.display="block";this.select.style.left=this.count.position[a].x+"px";this.select.style.top=this.count.position[a].y+"px";this.selectID=a;this.menu.style.height="auto";this.showSelector(b)}},showRootMenu:function(){this.addTitle("","SERIOUSLY ROOT","");this.addOption(0,"source",Serious.Sources);this.addOption(1,"effect",Serious.Effects);this.addOption(2,"target",Serious.Targets)},
showSelector:function(b){var a=this.getID(b),c=this.getPrefix(b);b=this.getType(b);this.addTitle(a,b,c);switch(b){case "image":case "video":this.addURL(a);break;case "accumulator":this.addSlide(a,"opacity",0,1,2);this.addList(a,"blendMode",Serious.BlendMode);this.addBool(a,"clear");break;case "ascii":this.addColor(a,"background");break;case "bleach-bypass":this.addSlide(a,"amount",0,1,2);break;case "blend":this.addSlide(a,"opacity",0,1,2);this.addList(a,"mode",Serious.BlendMode);this.addList(a,"sizeMode",
Serious.BlendSizeMode);break;case "blur":this.addSlide(a,"amount",0,1,2);break;case "brightness-contrast":this.addSlide(a,"brightness",0,1,2);this.addSlide(a,"contrast",0,1,2);break;case "checkerboard":this.addV2(a,"anchor");this.addV2(a,"size");this.addColor(a,"color1");this.addColor(a,"color2");this.addNumber(a,"width");this.addNumber(a,"height");break;case "chroma":this.addColor(a,"screen");this.addNumber(a,"weight");this.addSlide(a,"balance",0,1,2);this.addSlide(a,"clipBlack",0,1,2);this.addSlide(a,
"clipWhite",0,1,2);this.addBool(a,"mask");break;case "color":this.addColor(a,"color");this.addNumber(a,"width");this.addNumber(a,"height");break;case "colorcomplements":this.addSlide(a,"amount",0,1,2);this.addSlide(a,"concentration",0.1,4,2);this.addSlide(a,"correlation",0,1,2);this.addColor(a,"guideColor");break;case "color-select":this.addNumber(a,"hueMin");this.addNumber(a,"hueMax");this.addNumber(a,"hueMinFalloff",0);this.addNumber(a,"hueMaxFalloff",0);this.addSlide(a,"saturationMin",0,1,2);this.addSlide(a,
"saturationMax",0,1,2);this.addNumber(a,"saturationMinFalloff",0);this.addNumber(a,"saturationMaxFalloff",0);this.addSlide(a,"lightnessMin",0,1,2);this.addSlide(a,"lightnessMax",0,1,2);this.addNumber(a,"lightnessMinFalloff",0);this.addNumber(a,"lightnessMaxFalloff",0);this.addBool(a,"mask");break;case "crop":this.addNumber(a,"top",0,1);this.addNumber(a,"left",0,1);this.addNumber(a,"bottom",0,1);this.addNumber(a,"right",0,1);break;case "daltonize":this.addList(a,"type",["0.0","0.2","0.6","0.8"]);break;
case "directionblur":this.addSlide(a,"amount",0,1,2);this.addSlide(a,"angle",0,360,0);break;case "edge":this.addList(a,"mode",["sobel","frei-chen"]);break;case "emboss":this.addSlide(a,"amount",-85,85,0);break;case "exposure":this.addSlide(a,"exposure",-8,8,1);break;case "expression":this.addNumber(a,"a",0);this.addNumber(a,"b",0);this.addNumber(a,"c",0);this.addNumber(a,"d",0);this.addString(a,"rgb");this.addString(a,"red");this.addString(a,"green");this.addString(a,"blue");this.addString(a,"alpha");
break;case "fader":this.addColor(a,"color");this.addSlide(a,"amount",0,1,2);break;case "falsecolor":this.addColor(a,"black");this.addColor(a,"white");break;case "filmgrain":this.addNumber(a,"time");this.addSlide(a,"amount",0,1,2);this.addBool(a,"colored");break;case "freeze":this.addBool(a,"frozen");break;case "gradientwipe":this.addImage(a,"gradient");this.addNumber(a,"transition");this.addBool(a,"invert");this.addSlide(a,"smoothness",0,1,2);break;case "hex":this.addSlide(a,"size",0,0.4,2);this.addV2(a,
"center");break;case "highlights-shadows":this.addSlide(a,"highlights",0,1,2);this.addSlide(a,"shadows",0,1,2);break;case "hue-saturation":this.addSlide(a,"hue",-1,1,2);this.addSlide(a,"saturation",-1,1,2);break;case "kaleidoscope":this.addNumber(a,"segments");this.addNumber(a,"offset");break;case "lumakey":this.addSlide(a,"clipBlack",0,1,2);this.addSlide(a,"clipWhite",0,1,2);this.addBool(a,"invert");break;case "nightvision":this.addNumber(a,"timer");this.addSlide(a,"luminanceThreshold",0,1,2);this.addNumber(a,
"amplification",0);this.addColor(a,"color");break;case "noise":this.addBool(a,"overlay");this.addSlide(a,"amount",0,1,2);this.addNumber(a,"timer",NaN,1);break;case "panorama":this.addNumber(a,"width",0,1);this.addNumber(a,"height",0,1);this.addSlide(a,"yaw",0,360,0);this.addSlide(a,"fov",0,180,0);this.addSlide(a,"pitch",-90,90,0);break;case "pixelate":this.addV2(a,"pixelSize",0);break;case "polar":this.addSlide(a,"angle",0,360,0);break;case "repeat":this.addNumber(a,"repeat",0,1);this.addNumber(a,
"width",0,1);this.addNumber(a,"height",0,1);break;case "ripple":this.addNumber(a,"wave",0,1);this.addNumber(a,"distortion",0,1);this.addV2(a,"center");break;case "scanlines":this.addNumber(a,"lines");this.addSlide(a,"size",0,1,2);this.addSlide(a,"intensity",0,1,2);break;case "select":this.addSlide(a,"active",0,3,0);this.addList(a,"sizeMode",["union","intersection","active"]);break;case "simplex":this.addV2(a,"noiseScale");this.addV2(a,"noiseOffset");this.addSlide(a,"octaves",1,8,0);this.addSlide(a,
"persistence",0,0.5,2);this.addSlide(a,"amount",0,1,2);this.addNumber(a,"time");this.addNumber(a,"width");this.addNumber(a,"height");this.addColor(a,"black");this.addColor(a,"white");break;case "split":this.addList(a,"sizeMode",["a","b","union","intersection"]);this.addSlide(a,"split",0,1,2);this.addNumber(a,"angle");this.addSlide(a,"fuzzy",0,1,2);break;case "throttle":this.addNumber(a,"opacity",0);break;case "tone":this.addColor(a,"light");this.addColor(a,"dark");this.addSlide(a,"toned",0,1,2);this.addSlide(a,
"desat",0,1,2);break;case "tvglitch":this.addSlide(a,"distortion",0,1,2);this.addSlide(a,"verticalSync",0,1,2);this.addSlide(a,"lineSync",0,1,2);this.addSlide(a,"scanlines",0,1,2);this.addSlide(a,"bars",0,1,2);this.addSlide(a,"frameShape",0,2,2);this.addSlide(a,"frameLimit",-1,1,2);this.addSlide(a,"frameSharpness",0,40,1);this.addColor(a,"frameColor");break;case "vignette":this.addSlide(a,"amount",0,1,2);break;case "vibrance":this.addSlide(a,"amount",-1,1,2);break;case "whitebalance":this.addColor(a,
"white"),this.addBool(a,"auto")}},clearSelector:function(){for(var b=this.sels.length;b--;)this.sels[b].clear(),this.sels.pop()},addOption:function(b,a,c){b=function(a){}.bind(this);this.sels.push(new UI.List(this.menu,a,b,a,c))},addImage:function(b,a){},addTitle:function(b,a,c){b=new UI.Title(this.menu,b,a,c);switch(c){case "source":b.content.style.background=this.nset.sc2;break;case "effect":b.content.style.background=this.nset.fc2;break;case "target":b.content.style.background=this.nset.tc2}this.sels.push(b)},
addString:function(b,a){(function(c){this.nodes[b][a]=c}).bind(this)},addNumber:function(b,a,c,d){c=function(c){this.nodes[b][a]=c}.bind(this);this.sels.push(new UI.Number(this.menu,a,c,this.nodes[b][a]))},addV2:function(b,a,c){c=function(c){this.nodes[b][a]=c}.bind(this);this.sels.push(new UI.V2(this.menu,a,c,this.nodes[b][a]))},addColor:function(b,a){var c=function(c){this.nodes[b][a]=c}.bind(this);this.sels.push(new UI.Color(this.menu,a,c,this.nodes[b][a]))},addBool:function(b,a){var c=function(c){this.nodes[b][a]=
c}.bind(this);this.sels.push(new UI.Bool(this.menu,a,c,this.nodes[b][a]))},addList:function(b,a,c){var d=function(c){this.nodes[b][a]=c}.bind(this);this.sels.push(new UI.List(this.menu,a,d,this.nodes[b][a],c))},addSlide:function(b,a,c,d,e){var f=function(c){this.nodes[b][a]=c}.bind(this);this.sels.push(new UI.Slide(this.menu,a,f,this.nodes[b][a],c,d,e))},addURL:function(b){var a=function(a){console.log(a);this.nodes[b].src=a}.bind(this),a=new UI.Url(this.menu,"src",a,this.nodes[b].url);a.content.style.background=
this.nset.sc1;this.sels.push(a)},contextmenu:function(b){b.preventDefault()},mouseover:function(b){"close"==this.current&&(this.current="open",this.content.style.width=this.size.x+"px",this.content.style.height=this.size.y+"px",this.icc.style.display="none",this.menu.style.width=this.size.x+"px",this.menu.style.top=this.size.y+"px",this.menu.style.height="30px",this.menu.style.display="block",this.refresh())},mouseout:function(b){},mouseup:function(b){this.linkTest={source:-1,target:-1,sourceN:0,
targetN:0};this.move.test=!1;this.move.down=!1;this.move.element=null;this.move.name="";b.preventDefault()},mousedown:function(b){var a=this.linkTest,c=b.target,d=c.name,e=d.substring(0,1),f=this.getID(d);"O"==e?(a.target=f,a.targetN=1*d.substring(1,2),this.move.test=!0):"I"==e?(a.source=f,a.sourceN=1*d.substring(1,2),this.move.test=!0):(this.move.name=d,this.move.x=b.pageX,this.move.y=b.pageY,this.move.element="root"==d?this.grid:c,null!==this.move.element&&(this.selector(d),a=this.move.element.getBoundingClientRect(),
c=this.grid.getBoundingClientRect(),"root"==d?c=this.content.getBoundingClientRect():this.switchIndex(this.move.name),this.move.tx=a.left-c.left,this.move.ty=a.top-c.top,this.move.down=!0),b.preventDefault())},mousemove:function(b){var a=b.target.name,c=b.pageX,d=b.pageY,e,f;if(this.move.test){e=this.linkTest;f=this.getID(a);var k=a.substring(0,1),a=1*a.substring(1,2);-1!==e.source&&f!==e.source&&"O"==k&&(e.target=f,e.targetN=a);-1!==e.target&&f!==e.target&&"I"==k&&(e.source=f,e.sourceN=a);this.testLink()}this.move.down&&
(a=this.move.name,f=this.getID(a),this.move.mx=this.move.tx+c-this.move.x,this.move.my=this.move.ty+d-this.move.y,"root"==a?(0<this.move.mx&&(this.move.mx=0),0<this.move.my&&(this.move.my=0),this.move.mx<-(2E3+this.size.x)&&(this.move.mx=-(2E3+this.size.x)),this.move.my<-(2E3+this.size.y)&&(this.move.my=-(2E3+this.size.y))):(this.move.mx=20*(0.05*this.move.mx).toFixed(0),this.move.my=20*(0.05*this.move.my).toFixed(0),this.count.position[f].x=this.move.mx,this.count.position[f].y=this.move.my,this.select.style.left=
this.count.position[f].x+"px",this.select.style.top=this.count.position[f].y+"px",this.updateLink()),null!==this.move.element&&(this.move.element.style.left=this.move.mx+"px",this.move.element.style.top=this.move.my+"px"));b.preventDefault()},mousewheel:function(b){b.preventDefault()},getMousePosition:function(b){}};Serious.Point=function(b,a){this.x=b||0;this.y=a||0};Serious.Link=function(b,a){this.start=new Serious.Point;this.end=new Serious.Point;this.root=b;this.obj=a};
Serious.Link.prototype={constructor:Serious.Link,clear:function(){this.root.getType(this.root.nodes[this.obj.source].name)},apply:function(){var b=this.root.nodes[this.obj.source],a=this.root.nodes[this.obj.target],c=this.root.getType(b.name);""!==this.root.root_source&&a.name==this.root.root_source&&(this.root.current_source_node=b.name);0==this.obj.sourceN&&(b.source=a);1==this.obj.sourceN&&("blend"==c&&(b.bottom=a),"split"==c&&(b.sourceA=a));2==this.obj.sourceN&&("blend"==c&&(b.top=a),"split"==
c&&(b.sourceB=a));a.parent=b.name},draw:function(){var b=0;1==this.obj.sourceN&&(b=-8);2==this.obj.sourceN&&(b=8);this.start.x=this.root.count.position[this.obj.source].x+20+b;this.start.y=this.root.count.position[this.obj.source].y;this.end.x=this.root.count.position[this.obj.target].x+20+0;this.end.y=this.root.count.position[this.obj.target].y+40;b=this.root.linkcontext;b.beginPath();b.moveTo(this.start.x,this.start.y);b.bezierCurveTo(this.start.x,this.start.y-20,this.end.x,this.end.y+20,this.end.x,
this.end.y);b.lineWidth=2;b.strokeStyle="white";b.stroke()}};Serious.createClass=function(b,a){var c=".";"*"==b&&(c="");var d=document.createElement("style");d.type="text/css";document.getElementsByTagName("head")[0].appendChild(d);(d.sheet||{}).insertRule?d.sheet.insertRule(c+b+"{"+a+"}",0):(d.styleSheet||d.sheet).addRule(c+b,a)};
Serious.Icon=function(b){var a=["<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' preserveAspectRatio='none' x='0px' y='0px' width='40px' height='40px' viewBox='0 0 40 40';'><g>"];switch(b){case "image":a[1]="<path fill='#FFF' d='M 16 30 L 20 34 24 30 16 30 M 16 27 L 16 29 24 29 24 27 16 27 M 27 23 L 27 20 Q 25.2 17.15 23 20 21.4 22.1 18 20 15.7 18.75 13 20 L 13 22 Q 16.32 21.27 19 22.7 21.73 24.17 23.7 21.55 25.65 18.96 27 23 M 30 11 L 29 10 11 10 10 11 10 29 11 30 14 30 14 28 12 28 12 12 28 12 28 28 26 28 26 30 29 30 30 29 30 11 Z'/>";
break;case "video":a[1]="<path fill='#FFF' d='M 16 30 L 20 34 24 30 16 30 M 16 27 L 16 29 24 29 24 27 16 27 M 30 11 L 30 10 10 10 10 30 14 30 14 29 13 29 13 28 14 28 14 27 11 27 11 13 29 13 29 27 26 27 26 30 30 30 30 29 29 29 29 28 30 28 30 12 29 12 29 11 30 11 M 21 12 L 21 11 22 11 22 12 21 12 M 23 12 L 23 11 24 11 24 12 23 12 M 25 12 L 25 11 26 11 26 12 25 12 M 27 12 L 27 11 28 11 28 12 27 12 M 11 11 L 12 11 12 12 11 12 11 11 M 15 12 L 15 11 16 11 16 12 15 12 M 13 11 L 14 11 14 12 13 12 13 11 M 17 12 L 17 11 18 11 18 12 17 12 M 19 11 L 20 11 20 12 19 12 19 11 M 12 29 L 11 29 11 28 12 28 12 29 M 27 29 L 27 28 28 28 28 29 27 29 Z'/>";
break;case "camera":a[1]="<path fill='#FFF' d='M 16 30 L 20 34 24 30 16 30 M 16 27 L 16 29 24 29 24 27 16 27 M 29 12 L 23 12 23 10 17 10 17 12 11 12 10 13 10 28 11 29 14 29 14 27 12 27 12 14 18 14 18 11 22 11 22 14 28 14 28 27 26 27 26 29 29 29 30 28 30 13 29 12 M 21 14 L 21 12 19 12 19 14 21 14 M 23.5 23.5 Q 25 22.05 25 20 25 17.95 23.5 16.45 22.05 15 20 15 17.95 15 16.45 16.45 15 17.95 15 20 15 22.05 16.45 23.5 17.95 25 20 25 22.05 25 23.5 23.5 M 22.8 17.15 Q 24 18.35 24 20 24 21.65 22.8 22.8 21.65 24 20 24 18.35 24 17.15 22.8 16 21.65 16 20 16 18.35 17.15 17.15 18.35 16 20 16 21.65 16 22.8 17.15 M 22.1 22.1 Q 23 21.25 23 20 23 18.75 22.1 17.85 21.25 17 20 17 18.75 17 17.85 17.85 17 18.75 17 20 17 21.25 17.85 22.1 18.75 23 20 23 21.25 23 22.1 22.1 Z'/>";
break;case "texture":a[1]="<path fill='#FFF' d='M 27.9 15.8 L 28 24.5 26 25.5 26 27.6 30 26 30 14 21 10 20 10 10 14 10 26 14 27.75 14 25.5 12 24.5 12 15.9 19 19 19 25 20 25 20 19 27.9 15.8 M 21 12 L 27.75 14.9 20 18 19 18 12.15 14.95 20 12 21 12 M 16 30 L 20 34 24 30 16 30 M 16 27 L 16 29 24 29 24 27 16 27 Z'/>";break;case "texture-3D":a[1]="<path fill='#FFF' d='M 30 10 L 25 10 20 15 15 10 10 10 10 30 30 30 30 10 M 24 12 L 26 12 26 14 28 14 28 17 27 17 27 18 28 18 28 28 18 28 18 27 17 27 17 28 14 28 14 26 12 26 12 24 14 24 14 22 16 22 16 20 18 20 18 18 20 18 20 16 22 16 22 14 24 14 24 12 M 20 25 L 19 25 19 26 20 26 20 25 M 25 19 L 25 20 26 20 26 19 25 19 M 24 21 L 23 21 23 22 24 22 24 21 M 22 23 L 21 23 21 24 22 24 22 23 M 16 24 L 14 24 14 26 16 26 16 24 M 16 22 L 16 24 18 24 18 22 16 22 M 20 20 L 18 20 18 22 20 22 20 20 M 22 20 L 22 18 20 18 20 20 22 20 M 22 16 L 22 18 24 18 24 16 22 16 M 26 16 L 26 14 24 14 24 16 26 16 M 24 8 L 24 6 16 6 16 8 24 8 M 16 9 L 20 13 24 9 16 9 Z'/>";
break;case "canvas-3D":a[1]="<path fill='#FFF' d='M 25 18 L 25 16 23 14 18 14 15 17 15 23 18 26 23 26 25 24 25 22 24 22 22 24 20 24 18 22 18 18 20 16 22 16 24 18 25 18 M 16 9 L 20 13 24 9 16 9 M 24 8 L 24 6 16 6 16 8 24 8 M 30 10 L 25 10 22 13 25 13 26 12 28 12 28 28 12 28 12 12 14 12 15 13 18 13 15 10 10 10 10 30 30 30 30 10 Z'/>";break;case 18:a[1]="<path fill='#FFF' d='M 16 11 L 14 11 14 14 11 14 11 16 14 16 14 19 16 19 16 16 19 16 19 14 16 14 16 11 Z'/>";break;default:a[1]="<path fill='#FFF' d='M 21 20 Q 24.4 17 23 13 22.5 11.6 20.9 10 L 18.9 10 Q 20.4 11.5 20.95 13 22.4 16.95 19 20 15.35 23.4 16.45 27 16.9 28.2 17.85 29.1 18.35 29.55 19 30 L 21 30 Q 19.1 28.3 18.5 27 17.05 23.65 21 20 M 20.2 14 Q 20.14 13.51 20 13 L 19.55 12 10 12 10 28 16.05 28 15.5 27 Q 15.28 26.50 15.15 26 L 12 26 12 14 20.2 14 M 21.9 10 Q 23.3 11.4 23.6 12 L 28 12 28 28 20.05 28 Q 20.4 28.5 20.9 29 21.4 29.5 22 30 L 30 30 30 10 21.9 10 Z'/>"}a[2]=
"</g></svg>";return a.join("\n")};
